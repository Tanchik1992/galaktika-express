/*
╔═══════════════════════════════════════════════════════════════════════════╗
║                     (c) 1994,97 корпорация ГАЛАКТИКА                      ║
║ Проект        : ГАЛАКТИКА                                                 ║
║ Система       : Оперативный контур                                        ║
║ Версия        : 5.20                                                      ║
║ Назначение    : Печать счетов-фактур (бланки СФ)                          ║
║ Ответственный : Володько Анатолий Владимирович (Anatoly)                  ║
║ Параметры     : нет                                                       ║
╚═══════════════════════════════════════════════════════════════════════════╝
*/
#doc
Счет-фактура (c 25.02.2000, формат A4)
#end
.linkform 'Schfrees_N0' prototype is 'Schfrees'
.NameInList 'Счет-фактура (c 25.02.2000, формат A4)'
.Group 'Бланки счетов-фактур'
!-------------------------------------------------------------------
.create view vSpSchf
from
 SpSchf  ,
 KatParty 
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
 rNDS, rSumNoNDS,
 rAkcis, rSumma: double;
 StrPrim : String;
.endvar
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact,'"DD" Mon YYYY г.'), '')

  If (Direct=1,MyOrgName,OrgName)
  If (Direct=1,MyOrgAddr,OrgAddr)
  If (Direct=1,MyOrgTel,OrgTel)
  If (Direct=1,MyOrgINN,OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat)<>0, DateToStr(PlatDat,'"DD" Mon YYYY г.'), '')

  If (Direct<>1,MyOrgName,OrgName)
  If (Direct<>1,MyOrgAddr,OrgAddr)
  If (Direct<>1,MyOrgTel,OrgTel)
  If (Direct<>1,MyOrgINN,OrgINN)
.endfields

 И                 Счет-фактура N  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Поставщик  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер поставщика (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу N  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
 И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌─────────────────────┬──────────┬────────┬─────────┬──────────┬─────────────┬───────────┬─────────────┬───────────┬──────┬────────────┬─────────────┐ Ш
 Ш│ Наименование товара │  Страна  │ Номер  │ Единица │Количество│    Цена     │В том числе│    Сумма    │В том числе│Ставка│ Сумма НДС  │ Всего с НДС │ Ш
 Ш│                     │ происхож-│грузовой│измерения│          │             │   акциз   │             │   акциз   │ НДС  │            │             │ Ш
 Ш│                     │  дения   │таможен-│         │          │             │           │             │           │      │            │             │ Ш
 Ш│                     │          │ ной де-│         │          │             │           │             │           │      │            │             │ Ш
 Ш│                     │          │кларации│         │          │             │           │             │           │      │            │             │ Ш
 Ш├─────────────────────┼──────────┼────────┼─────────┼──────────┼─────────────┼───────────┼─────────────┼───────────┼──────┼────────────┼─────────────┤ Ш
 Ш│          1          │    2     │    3   │    4    │    5     │      6      │     7     │      8      │     9     │  10  │     11     │     12      │ Ш
 Ш├─────────────────────┼──────────┼────────┼─────────┼──────────┼─────────────┼───────────┼─────────────┼───────────┼──────┼────────────┼─────────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{ table 'vSpSchf.SpSchf'
.fields
  SpName                 GTDCountry GTDNomer If(SpPrMC=3,'',SpOtpEd) If(SpPrMC=3,'0.0',string(SpKol, 0, Kol_Pr)) If(SpPrMC=3,0.0,SpSumNoNDS/SpKol) If(SpPrMC=3,0.0,SpAkciz/spKol) SpSumNoNDS SpAkciz SpPerc SpNDS SpSumma
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│@@@@@@@@@@│@~@@@@@@│@~@@@@@@@│@#@@@@@@@@│&#&&&&&&&&.&&│&#&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?Internal;(SubTip>=16)
.fields
   PlatNazn                                                                            s1  SAkciz If(Abs(s3)>=0.01,String(Stav1,3,0)+' %','') s2   s3
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│          │        │         │          │             │           │&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.}
.{?Internal;((Abs(S6)>0.01)AND(SubTip>=16))
.fields
                                                                                              s4      String(Stav2,3,0)+' %'        s5         s6
.endfields
 Ш│                     │          │        │         │          │             │           │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.}
.{?Internal;((Abs(S7)>0.01)AND(SubTip>=16))
.fields
                                                                                                s7                                               s7
.endfields
 Ш│                     │          │        │         │          │             │           │&#&&&&&&&&.&&│           │      │            │&#&&&&&&&&.&&│ Ш
.}
.fields
   if (bSumEqual, rSumNoNDS, S1+S4+S7)
   if (bSumEqual, rAkcis, SAkciz)
   if (bSumEqual, rNDS, S2+S5)
   if (bSumEqual, rSumma, S)
.endfields
 Ш├─────────────────────┴──────────┴────────┴─────────┴──────────┴─────────────┴───────────┴─────────────┴───────────┼──────┼────────────┼─────────────┤ Ш
 Ш│  Всего к оплате                                                                         &#&&&&&&&&.&& &#&&&&&&.&&│      │&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
 Ш└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘      └────────────┴─────────────┘ Ш
.fields
    Director Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Гл. бухгалтер                                                   ^

       М.П.

       Выдал
       (подпись ответственного лица от поставщика)
        Ш
.begin
  StrPrim := 'Без печати недействительно.';
  // Для России
  if (wCountry = 0)
    StrPrim := ' ';
end.
.fields
   StrPrim
.endfields
        БПримечание. Б ^
       Первый экземпляр (оригинал) - покупателю.
       Второй экземпляр (копия) - продавцу.

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------
#doc
Счет-фактура (c 25.02.2000, формат A3)
#end
.linkform 'Schfrees_N1' prototype is 'Schfrees'
.NameInList 'Счет-фактура (c 25.02.2000, формат A3)'
.Group 'Бланки счетов-фактур'
!-------------------------------------------------------------------
.create view vSpSchf
from
 SpSchf  ,
 KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
 rNDS, rSumNoNDS,
 rAkcis, rSumma: double;
 StrPrim : String;
.endvar
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact,'"DD" Mon YYYY г.'), '')

  If (Direct=1,MyOrgName,OrgName)
  If (Direct=1,MyOrgAddr,OrgAddr)
  If (Direct=1,MyOrgTel,OrgTel)
  If (Direct=1,MyOrgINN,OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat)<>0, DateToStr(PlatDat,'"DD" Mon YYYY г.'), '')

  If (Direct<>1,MyOrgName,OrgName)
  If (Direct<>1,MyOrgAddr,OrgAddr)
  If (Direct<>1,MyOrgTel,OrgTel)
  If (Direct<>1,MyOrgINN,OrgINN)
.endfields

                 Счет-фактура N  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д

 Поставщик  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Идентификационный номер поставщика (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 К платежно-расчетному документу N  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Р┌────────────────────────┬──────────┬────────┬─────────┬────────────┬────────────────┬───────────────┬─────────────────┬───────────────┬──────┬────────────────┬─────────────────┐ Р
 Р│  Наименование товара   │ Страна   │ Номер  │ Единица │ Количество │      Цена      │  В том числе  │      Сумма      │  В том числе  │Ставка│   Сумма НДС    │   Всего с НДС   │ Р
 Р│                        │происхож- │грузовой│измерения│            │                │     акциз     │                 │     акциз     │ НДС  │                │                 │ Р
 Р│                        │  дения   │таможен-│         │            │                │               │                 │               │      │                │                 │ Р
 Р│                        │          │ ной де-│         │            │                │               │                 │               │      │                │                 │ Р
 Р│                        │          │кларации│         │            │                │               │                 │               │      │                │                 │ Р
 Р├────────────────────────┼──────────┼────────┼─────────┼────────────┼────────────────┼───────────────┼─────────────────┼───────────────┼──────┼────────────────┼─────────────────┤ Р
 Р│           1            │     2    │    3   │    4    │      5     │       6        │        7      │        8        │       9       │  10  │       11       │        12       │ Р
 Р├────────────────────────┼──────────┼────────┼─────────┼────────────┼────────────────┼───────────────┼─────────────────┼───────────────┼──────┼────────────────┼─────────────────┤ Р
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{ table 'vSpSchf.SpSchf'
.fields
  SpName                   GTDCountry GTDNomer If(SpPrMC=3,'',SpOtpEd) If(SpPrMC=3,'0.0',string(SpKol, 0, Kol_Pr)) If(SpPrMC=3,0.0,SpSumNoNDS/SpKol) If(SpPrMC=3,0.0,SpAkciz/spKol) SpSumNoNDS SpAkciz SpPerc SpNDS SpSumma
.endfields
 Р│@@@@@@@@@@@@@@@@@@@@@@@@│@@@@@@@@@@│@~@@@@@@│@~@@@@@@@│@#@@@@@@@@@@│&'#&&&&&&&&&&.&&│&'#&&&&&&&&&.&&│&'#&&&&&&&&&&&.&&│&'#&&&&&&&&&.&&│@~#@@@│&'#&&&&&&&&&&.&&│&'#&&&&&&&&&&&.&&│ Р
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?Internal;(SubTip>=16)
.fields
   PlatNazn                                                                            s1  SAkciz If(Abs(s3)>=0.01,String(Stav1,3,0)+' %','') s2   s3
.endfields
 Р│@@@@@@@@@@@@@@@@@@@@@@@@│          │        │         │            │                │               │&'#&&&&&&&&&&&.&&│&'#&&&&&&&&&.&&│@~#@@@│&'#&&&&&&&&&&.&&│&'#&&&&&&&&&&&.&&│ Р
.}
.{?Internal;((Abs(S6)>0.01)AND(SubTip>=16))
.fields
                                                                                              s4      String(Stav2,3,0)+' %'        s5         s6
.endfields
 Р│                        │          │        │         │            │                │               │&'#&&&&&&&&&&&.&&│               │@~#@@@│&'#&&&&&&&&&&.&&│&'#&&&&&&&&&&&.&&│ Р
.}
.{?Internal;((Abs(S7)>0.01)AND(SubTip>=16))
.fields
                                                                                                s7                                               s7
.endfields
 Р│                        │          │        │         │            │                │               │&'#&&&&&&&&&&&.&&│               │      │                │&'#&&&&&&&&&&&.&&│ Р
.}
.fields
   if (bSumEqual, rSumNoNDS, S1+S4+S7)
   if (bSumEqual, rAkcis, SAkciz)
   if (bSumEqual, rNDS, S2+S5)
   if (bSumEqual, rSumma, S)
.endfields
 Р├────────────────────────┴──────────┴────────┴─────────┴────────────┴────────────────┴───────────────┴─────────────────┴───────────────┼──────┼────────────────┼─────────────────┤ Р
 Р│  Всего к оплате                                                                                     &'#&&&&&&&&&&&.&& &'#&&&&&&&&&.&&│      │&'#&&&&&&&&&&.&&│&'#&&&&&&&&&&&.&&│ Р
 Р└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘      └────────────────┴─────────────────┘ Р
.fields
    Director Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Гл. бухгалтер                                                   ^

       М.П.

       Выдал
       (подпись ответственного лица от поставщика)
        Ш
.begin
  StrPrim := 'Без печати недействительно.';
  // Для России
  if (wCountry = 0)
    StrPrim := ' ';
end.
.fields
   StrPrim
.endfields
        БПримечание. Б ^
       Первый экземпляр (оригинал) - покупателю.
       Второй экземпляр (копия) - продавцу.

.} // Schf
.endform

!-------------------------------------------------------------------------------------
#doc
Счет-фактура с номерами вагонов (c 25.02.2000, формат A4)
#end
.linkform 'Schfrees_N2' prototype is 'Schfrees'
.NameInList 'Счет-фактура с номерами вагонов (c 25.02.2000, формат A4)'
.Group 'Бланки счетов-фактур'
!-------------------------------------------------------------------
.create view vSpSchf
var
  SchFactNRec : comp;
as select
  SpSchf.*
from
  SpSchf  ,
  KatParty 
 where
((
      SchFactNRec == SpSchf.cSchFact
))
;
!-------------------------------------------------------------------
.var
  NumVagon: array[1..3] of string;
  sNumVagon : string;
  i, k, j : integer;
  rNDS, rSumNoNDS,
  rAkcis, rSumma: double;
  StrPrim : String;
.endvar
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  i := 1; NumVagon[1] := '';
  vSpSchf.SchFactNRec := nSchFact;
  if (vSpSchf.GetFirst SpSchf = 0) then
    do {
      if (Length(NumVagon[i])+Length(vSpSchf.SpSchf.ss[2])) > 255 then {
        i := i + 1;
        NumVagon[i] := '';
      };
      if (InStr(vSpSchf.SpSchf.ss[2], NumVagon[i]) > 0) then
         sNumVagon := NumVagon[i];
      else
        if (i > 1) then
          for(j := i - 1; j >= i - 1; j := j - 1)
            {
              if (InStr(vSpSchf.SpSchf.ss[2], NumVagon[j]) > 0) then
                 sNumVagon := NumVagon[j];
            }
        else
          sNumVagon := NumVagon[i] + vSpSchf.SpSchf.ss[2] + ' ';
      NumVagon[i] := sNumVagon;
//      NumVagon[i] := NumVagon[i] + vSpSchf.SpSchf.ss[2] + ' ';
    } while (vSpSchf.GetNext SpSchf = 0 and i<=3)
  if (vSpSchf.GetFirst SpSchf = 0 ) {};
end.
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact,'"DD" Mon YYYY г.'), '')

  If (Direct=1,MyOrgName,OrgName)
  If (Direct=1,MyOrgAddr,OrgAddr)
  If (Direct=1,MyOrgTel,OrgTel)
  If (Direct=1,MyOrgINN,OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat)<>0, DateToStr(PlatDat,'"DD" Mon YYYY г.'), '')

  If (Direct<>1,MyOrgName,OrgName)
  If (Direct<>1,MyOrgAddr,OrgAddr)
  If (Direct<>1,MyOrgTel,OrgTel)
  If (Direct<>1,MyOrgINN,OrgINN)
.endfields

 И                 Счет-фактура N  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Поставщик  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер поставщика (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу N  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
 И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.end
.fields
  'Номера вагонов, учтенных в данной СФ'
  NumVagon[1] NumVagon[2] NumVagon[3]
.endfields
 И @@@@@@@@@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И                          Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И                          Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌─────────────────────┬──────────┬────────┬─────────┬──────────┬─────────────┬───────────┬─────────────┬───────────┬──────┬────────────┬─────────────┐ Ш
 Ш│ Наименование товара │  Страна  │ Номер  │ Единица │Количество│    Цена     │В том числе│    Сумма    │В том числе│Ставка│ Сумма НДС  │ Всего с НДС │ Ш
 Ш│                     │ происхож-│грузовой│измерения│          │             │   акциз   │             │   акциз   │ НДС  │            │             │ Ш
 Ш│                     │  дения   │таможен-│         │          │             │           │             │           │      │            │             │ Ш
 Ш│                     │          │ ной де-│         │          │             │           │             │           │      │            │             │ Ш
 Ш│                     │          │кларации│         │          │             │           │             │           │      │            │             │ Ш
 Ш├─────────────────────┼──────────┼────────┼─────────┼──────────┼─────────────┼───────────┼─────────────┼───────────┼──────┼────────────┼─────────────┤ Ш
 Ш│          1          │     2    │    3   │    4    │    5     │      6      │     7     │      8      │     9     │  10  │     11     │     12      │ Ш
 Ш├─────────────────────┼──────────┼────────┼─────────┼──────────┼─────────────┼───────────┼─────────────┼───────────┼──────┼────────────┼─────────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.fields
  SpName                GTDCountry  GTDNomer If(SpPrMC=3,'',SpOtpEd) If(SpPrMC=3,'0.0',string(SpKol, 0, Kol_Pr)) If(SpPrMC=3,0.0,SpSumNoNDS/SpKol) If(SpPrMC=3,0.0,SpAkciz/spKol) SpSumNoNDS SpAkciz SpPerc SpNDS SpSumma
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│@@@@@@@@@@│@~@@@@@@│@~@@@@@@@│@#@@@@@@@@│&#&&&&&&&&.&&│&#&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?Internal;(SubTip>=16)
.fields
   PlatNazn                                                                            s1  SAkciz If(Abs(s3)>=0.01,String(Stav1,3,0)+' %','') s2   s3
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│          │        │         │          │             │           │&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.}
.{?Internal;((Abs(S6)>0.01)AND(SubTip>=16))
.fields
                                                                                              s4      String(Stav2,3,0)+' %'        s5         s6
.endfields
 Ш│                     │          │        │         │          │             │           │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.}
.{?Internal;((Abs(S7)>0.01)AND(SubTip>=16))
.fields
                                                                                                s7                                               s7
.endfields
 Ш│                     │          │        │         │          │             │           │&#&&&&&&&&.&&│           │      │            │&#&&&&&&&&.&&│ Ш
.}
.fields
   if (bSumEqual, rSumNoNDS, S1+S4+S7)
   if (bSumEqual, rAkcis, SAkciz)
   if (bSumEqual, rNDS, S2+S5)
   if (bSumEqual, rSumma, S)
.endfields
 Ш├─────────────────────┴──────────┴────────┴─────────┴──────────┴─────────────┴───────────┴─────────────┴───────────┼──────┼────────────┼─────────────┤ Ш
 Ш│  Всего к оплате                                                                         &#&&&&&&&&.&& &#&&&&&&.&&│      │&#&&&&&&&.&&│&#&&&&&&&&.&&│ Ш
 Ш└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘      └────────────┴─────────────┘ Ш
.fields
    Director Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Гл. бухгалтер                                                   ^

       М.П.

       Выдал
       (подпись ответственного лица от поставщика)
        Ш
.begin
  StrPrim := 'Без печати недействительно.';
  // Для России
  if (wCountry = 0)
    StrPrim := ' ';
end.
.fields
   StrPrim
.endfields
        БПримечание. Б ^
       Первый экземпляр (оригинал) - покупателю.
       Второй экземпляр (копия) - продавцу.

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------

#doc
Счет-фактура (с дополнительным налогом) (c 25.02.2000, формат A4)
#end
.linkform 'Schfrees_N3' prototype is 'Schfrees'
.NameInList 'Счет-фактура (с дополнительным налогом) (c 25.02.2000, формат A4)'
.Group 'Бланки счетов-фактур'
.p 80
.defo portrait
!-------------------------------------------------------------------
.create view vSpSchf
from
 SpSchf  ,
 KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  SrcCountry,          // Новые графы СФ "Страна происхождения"
  GTDNumber : string;  //                "Номер ГТД"
  rNDS, rAkcis, rDrNal: double;
  rSumNoNDS: double
  rSumma: double
  Nalog2_1: string
  Nalog2_2: string
  Nalog2_Len: longint
  StrPrim : String;
.endvar
.begin
  var i: longint;
  Nalog2_Len := 11;
  i := Pos(' ', trim(Nalog2));
  if (i>0 and i<=Nalog2_Len) then {
    Nalog2_1 := SubStr(trim(Nalog2), 1, i - 1);
    Nalog2_2 := SubStr(trim(Nalog2), i + 1, 255);
  } else {
    Nalog2_1 := SubStr(trim(Nalog2), 1, Nalog2_Len);
    Nalog2_2 := ltrim(SubStr(trim(Nalog2), Nalog2_Len + 1, 255));
  };
end.
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact,'"DD" Mon YYYY г.'), '')

  If (Direct=1,MyOrgName,OrgName)
  If (Direct=1,MyOrgAddr,OrgAddr)
  If (Direct=1,MyOrgTel,OrgTel)
  If (Direct=1,MyOrgINN,OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat)<>0, DateToStr(PlatDat,'"DD" Mon YYYY г.'), '')

  If (Direct<>1,MyOrgName,OrgName)
  If (Direct<>1,MyOrgAddr,OrgAddr)
  If (Direct<>1,MyOrgTel,OrgTel)
  If (Direct<>1,MyOrgINN,OrgINN)
!  Nalog2
.endfields

 И                 Счет-фактура N  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Поставщик  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер поставщика (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу N  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
 И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.fields
  Nalog2_1
  Nalog2_2
.endfields

 Ш┌──────────────┬─────────┬────────┬───────┬─────────┬─────────────┬───────────┬─────────────┬───────────┬───────────┬──────┬───────────┬─────────────┐ Ш
 Ш│ Наименование │ Страна  │ Номер  │Единица│ Коли-   │    Цена     │В том числе│    Сумма    │В том числе│@~@@@@@@@@@│Ставка│ Сумма НДС │ Всего с НДС │ Ш
 Ш│   товара     │происхож-│грузовой│ изме- │ чество  │             │   акциз   │             │   акциз   │@~@@@@@@@@@│ НДС  │           │             │ Ш
 Ш│              │ дения   │таможен-│ рения │         │             │           │             │           │           │      │           │             │ Ш
 Ш│              │         │ ной де-│       │         │             │           │             │           │           │      │           │             │ Ш
 Ш│              │         │кларации│       │         │             │           │             │           │           │      │           │             │ Ш
 Ш├──────────────┼─────────┼────────┼───────┼─────────┼─────────────┼───────────┼─────────────┼───────────┼───────────┼──────┼───────────┼─────────────┤ Ш
 Ш│       1      │    2    │   3    │   4   │    5    │      6      │     7     │      8      │     9     │    9a     │  10  │     11    │     12      │ Ш
 Ш├──────────────┼─────────┼────────┼───────┼─────────┼─────────────┼───────────┼─────────────┼───────────┼───────────┼──────┼───────────┼─────────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSumma := 0;
  rDrNal := 0;
end.
.{CheckEnter SpSchf      
.{ table 'vSpSchf.SpSchf'
.fields
  SpName         GTDCountry GTDNomer If(SpPrMC=3,'',SpOtpEd) If(SpPrMC=3,'0.0',string(SpKol, 0, Kol_Pr)) If(SpPrMC=3,0.0,SpSumNoNDS/SpKol) If(SpPrMC=3,0.0,SpAkciz/spKol) SpSumNoNDS SpAkciz SpDrNal SpPerc SpNDS SpSumma
.endfields
 Ш│@@@@@@@@@@@@@@│@@@@@@@@@│@~@@@@@@│@~@@@@@│@#@@@@@@@│&#&&&&&&&&.&&│&#&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSumma := rSumma + round(SpSumma, 2);
  rDrNal := rDrNal + round(SpDrNal, 2);
end.
.} //table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?Internal;(SubTip>=16)
.fields
   PlatNazn                                                                            s1  SAkciz s10 If(Abs(s3)>=0.01,String(Stav1,3,0)+' %','') s2   s3
.endfields
 Ш│@@@@@@@@@@@@@@│         │        │       │         │             │           │&#&&&&&&&&.&&│&#&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.}
.{?Internal;((Abs(S6)>0.01)AND(SubTip>=16))
.fields
                                                                                              s4      String(Stav2,3,0)+' %'        s5         s6
.endfields
 Ш│              │         │        │       │         │             │           │&#&&&&&&&&.&&│           │           │@~#@@@│&#&&&&&&.&&│&#&&&&&&&&.&&│ Ш
.}
.{?Internal;((Abs(S7)>0.01)AND(SubTip>=16))
.fields
                                                                                              s7                                                           s7
.endfields
 Ш│              │         │        │       │         │             │           │&#&&&&&&&&.&&│           │           │      │           │&#&&&&&&&&.&&│ Ш
.}
.fields
   if (bSumEqual, rSumNoNDS, S1+S4+S7)
   if (bSumEqual, rAkcis, SAkciz)
   if (bSumEqual, rDrNal, S10)
   if (bSumEqual, rNDS, S2+S5)
   if (bSumEqual, rSumma, S)
.endfields
 Ш├──────────────┴─────────┴────────┴───────┴─────────┴─────────────┴───────────┴─────────────┴───────────┴───────────┼──────┼───────────┼─────────────┤ Ш
 Ш│  Всего к оплате                                                              &#&&&&&&&&.&& &#&&&&&&.&& &#&&&&&&.&&│      │&#&&&&&&.&&│&#&&&&&&&&.&&│ Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘      └───────────┴─────────────┘ Ш
.fields
    Director Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Гл. бухгалтер                                                   ^

       М.П.

       Выдал
       (подпись ответственного лица от поставщика)
        Ш
.begin
  StrPrim := 'Без печати недействительно.';
  // Для России
  if (wCountry = 0)
    StrPrim := ' ';
end.
.fields
   StrPrim
.endfields
        БПримечание. Б ^
       Первый экземпляр (оригинал) - покупателю.
       Второй экземпляр (копия) - продавцу.

.} // Schf
.endform
