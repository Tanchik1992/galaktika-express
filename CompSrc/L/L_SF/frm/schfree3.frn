/*
╔═══════════════════════════════════════════════════════════════════════════╗
║                     (c) 1994,97 корпорация ГАЛАКТИКА                      ║
║ Проект        : ГАЛАКТИКА                                                 ║
║ Система       : Оперативный контур                                        ║
║ Версия        : 5.73                                                      ║
║ Назначение    : Печать счетов-фактур (реестры СФ для Казахстана)          ║
║ Ответственный : Полежай Алексей Геннадьевич                               ║
║ Параметры     : нет                                                       ║
╚═══════════════════════════════════════════════════════════════════════════╝
*/

#doc
Журнал регистрации счетов-фактур (Казахстан)
#end
.linkform 'Schfrees_52' prototype is 'Schfrees'
.NameInList 'Журнал регистрации счетов-фактур (Казахстан)'
.Group 'Реестры счетов-фактур'
.create view vKazRee
var
  wSubTip: word;
  wMonth, wYear: word;
  strMonth: string;
  mrkPrim, mrkPrimDop: longint;
  nRecSchFact: comp; 
from
  SchFact  (ReadOnly),
  synonym SchFact SchFact1,
  BookPrZk (ReadOnly)
where
((
  nRecSchFact        == SchFact.nRec      and
  SchFact.nRec       == BookPrZk.cSchFact and
  (wSubTip = BookPrZk.SubTip)             and
  BookPrZk.cSchFactS == SchFact1.nRec
))
;
.var
 npp: longint
 nst: longint 
 iS1: double
 iS2: double
 iS4: double
 iS5: double
 iS7: double
 iAkciz: double
 iSS: double
 IsKontrGroup: boolean
 isAvans: boolean
 str: string
 i: longint
.endvar
.fields
  CFH
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')

  CFH
.endfields
.p 55
.defo landscape
.[h SKIP
 Б^ Б
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист @NP@ Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬─────────────────────────────────────────────────────────────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┐ Ш
 Ш│(1) │     (2)     │     (3)    │                               (4)                                   │     (5)    │       (6)      │      (7)     │   (8)   │      (9)     │      (10)         │  (11)   │     (12)     │ Ш
 Ш├────┼─────────────┼────────────┼─────────────────────────────────────────────────────────────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.]h
.begin
   npp := 0;
   nst := 0;
   iS1 := 0.0;
   iS2 := 0.0;
   iS4 := 0.0;
   iS5 := 0.0;
   iS7 := 0.0;
   iAkciz := 0.0;
   iSS := 0.0;
   wSubTip := if (Direct = 2, 4, 3)
   vKazRee.mrkPrim := InitMarker('', 8, 100, 20);
   vKazRee.mrkPrimDop := InitMarker('', 8, 100, 20);
   wYear := Year(dBeg);
   wMonth := Month(dBeg);
   strMonth := DateToStr(dBeg, 'MONTH');
   if (Months_Between(dBeg, dEnd) > 1) {
     case (wMonth) of
     1, 2, 3: wMonth := 1;
     4, 5, 6: wMonth := 2;
     7, 8, 9: wMonth := 3;
     10, 11, 12: wMonth := 4;
     end;
     strMonth := string(wMonth);
   }
end.
 Б^ Б

 Б                        ЖУРНАЛ РЕГИСТРАЦИИ СЧЕТОВ-ФАКТУР Б

.if SetDateRange
.fields
  strMonth
  wYear
  MyOrgName
.endfields
 Б за @@@@@@@@@ месяц (квартал) @@@@@ г. по поставщику  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д Б
                                                       полное наименование юридического  
                                                       лица или его подразделения,       
                                                       физического лица                  
.end
.fields
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')
.endfields
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист    1 Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬─────────────────────────────────────────────────────────────────────┬────────────┬────────────────┬──────────────┬────────────────────────┬───────────────────┬────────────────────────┐ Ш
 Ш│ N  │   Номер     │Дата выписки│ Наименование, адрес покупателя                                      │    РНН     │ Номер и дата   │  Стоимость   │                        │   Всего стоимость │                        │ Ш
 Ш│п/п │счета-фактуры│  счета-    │                                                                     │ покупателя │   договора     │ поставки без │          НДС           │     реализации    │         Акциз          │ Ш
 Ш│    │ поставщика  │ фактуры    │                                                                     │            │  (контракта)   │     НДС      │                        │                   │                        │ Ш
 Ш│    │             │            │                                                                     │            │  на поставку   │              ├─────────┬──────────────┼───────────────────┼─────────┬──────────────┤ Ш
 Ш│    │             │            │                                                                     │            │    товаров     │              │         │              │                   │         │              │ Ш 
 Ш│    │             │            │                                                                     │            │ (работ, услуг) │              │ Ставка  │    Сумма     │                   │ Ставка  │    Сумма     │ Ш
 Ш│    │             │            │                                                                     │            │                │              │         │              │                   │         │              │ Ш
 Ш│    │             │            │                                                                     │            │                │              │         │              │                   │         │              │ Ш
 Ш├────┼─────────────┼────────────┼─────────────────────────────────────────────────────────────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
 Ш│(1) │     (2)     │     (3)    │                          (4)                                        │     (5)    │       (6)      │      (7)     │   (8)   │      (9)     │        (10)       │   (11)  │     (12)     │ Ш
 Ш├────┼─────────────┼────────────┼─────────────────────────────────────────────────────────────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.{CheckEnter Schf
.begin
   npp := npp + 1;
   nst := 0; 
   vKazRee.nRecSchFact := nSchFact;

   isAvans := False;
   if ( (Direct = 2) and (SubTip = 17) ) isAvans := True;
   if ( (Direct = 1) and (SubTip = 16) ) isAvans := True;

   if (not isAvans) and (not skipInReestr)
   {
     iS1 := iS1 + S1;
     iS2 := iS2 + S2;
     iS4 := iS4 + S4;
     iS5 := iS5 + S5;
     iS7 := iS7 + S7;
     iAkciz := iAkciz + SAkciz;
     iSS := iSS + S;
   }
end.
.if HeaderGroup
.fields
  Upcase(NameGroup)
.endfields
.begin
  IsKontrGroup := KontrGroup;
end.
 Ш├────┴─────────────┴────────────┴─────────────────────────────────────────────────────────────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┤ Ш
 Ш│    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                            │ Ш
 Ш├────┬─────────────┬────────────┬─────────────────────────────────────────────────────────────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┤ Ш
.end
.if Dopol
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.{CheckEnter SpSchf
.} // SpSchf
.{CheckEnter KazSt; (not skipInReestr)
.fields
  npp
  if (nst = 0, NSF, '')
  if (nst = 0,
        if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' ),
        ''
     )
  if (nst = 0,
        if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
           ),
        ''
     )
  if (nst = 0, if (IsKontrGroup, '', OrgINN),
               ''
     )
  if (nst = 0,
        DogovorDO_NoDoc +
        if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
           ),
        ''
     )

  KzNoNDS - KzAkciz
  KzStNDS
  KzNDS
  if (nst = 0, S, 0)
  
  KzStAkc
  KzAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│&#&&&&.&&│&#&&&&&&&&&.&&│ &#&&&&&&&&&.&&    │&#&&&&.&&│&#&&&&&&&&&.&&│ Ш
.begin                                                                                                                                                                                                                     
  nst := nst + 1;
end.
.} // KazSt
.{?internal; ((nst = 0) and not skipInReestr);
.fields
  npp NSF
  if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' )
  if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
     )
  if (IsKontrGroup, '', OrgINN)

  DogovorDO_NoDoc +
  if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
     )

  S1 + S4 + S7 - SAkciz
  S2 + S5
  S
  SAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│         │&#&&&&&&&&&.&&│  &#&&&&&&&&&.&&   │         │&#&&&&&&&&&.&&│ Ш
.} // internal (nst = 0)                                                                                                                                                                                                   
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.fields
   FooterGroup
   GrS1 + GrS4 + GrS7 - GrSAkciz
   GrS2 + GrS5
   GrS
   GrSAkciz
.endfields                                                                                                                                                                                              
 Ш├────┴─────────────┴────────────┴─────────────────────────────────────────────────────────────────────┴────────────┴────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
 Ш│    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                            │&'&&&&&&&&&.&&│    X    │&'&&&&&&&&&.&&│  &'&&&&&&&&&.&&   │    X    │&'&&&&&&&&&.&&│ Ш
 Ш├────┬─────────────┬────────────┬─────────────────────────────────────────────────────────────────────┬────────────┬────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.end
.{ table 'vKazRee.SchFact'
.{ table 'vKazRee.BookPrZk'
.begin
  if (vKazRee.GetFirst SchFact1 = 0)
    InsertMarker(vKazRee.mrkPrim, vKazRee.SchFact1.nRec)
end.
.} // table
.} // table
.begin
  if (SubTip = 32)
    InsertMarker(vKazRee.mrkPrimDop, nSchFact)
end.
.[f
 Ш└────┴─────────────┴────────────┴─────────────────────────────────────────────────────────────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┘ Ш
.]f
.} // Schf
.fields
   iS1 + iS4 + iS7 - iAkciz
   iS2 + iS5
   iSS
   iAkciz
.endfields
 Ш┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┐ Ш
 Ш│  Итого:                                                                                                                           │&'&&&&&&&&&.&&│    X    │&'&&&&&&&&&.&&│  &'&&&&&&&&&.&&   │    X    │&'&&&&&&&&&.&&│ Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┘ Ш

 И  ПРИМЕЧАНИЕ: И
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrim) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrim, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Авансовый СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrimDop) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrimDop, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Дополнительный СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.fields
  if (Direct = 1, Director, '')
  if (Direct = 1, Main_Buh, '')
.endfields
 И  Руководитель организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)                И
 И                                    М.П. И

 И  Главный бухгалтер организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)  И
.begin
  DoneMarker(vKazRee.mrkPrim, '');
  DoneMarker(vKazRee.mrkPrimDop, '');
end.
.endform

!--------------------------------------------------------------------------------------------------------------------

#doc
Журнал регистрации счетов-фактур (Казахстан)
#end
.linkform 'Schfrees_53' prototype is 'Schfrees'
.NameInList 'Журнал регистрации счетов-фактур (Казахстан)'
.Group 'Реестры счетов-фактур (по всем валютам)'
.create view vKazRee
var
  wSubTip: word;
  mrkPrim, mrkPrimDop: longint;
  wMonth, wYear: word;
  strMonth: string;
  nRecSchFact: longint;
from
  SchFact  (ReadOnly),
  synonym SchFact SchFact1,
  BookPrZk (ReadOnly)
where
((
  nRecSchFact        == SchFact.nRec      and
  SchFact.nRec       == BookPrZk.cSchFact and
  (wSubTip = BookPrZk.SubTip)             and
  BookPrZk.cSchFactS == SchFact1.nRec
))
;
.var
 npp: longint
 nst: longint 
 iS1: double
 iS2: double
 iS4: double
 iS5: double
 iS7: double
 iAkciz: double
 iSS: double
 IsKontrGroup: boolean
 isAvans: boolean
 str: string
 i: longint
.endvar
.fields
  CFH
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')

  CFH
.endfields
.p 55
.defo landscape
.[h SKIP
 Б^ Б
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист @NP@ Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬─────────────────────────────────────────────────────────────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┐ Ш
 Ш│(1) │     (2)     │     (3)    │                               (4)                                   │     (5)    │       (6)      │      (7)     │   (8)   │      (9)     │       (10)        │  (11)   │     (12)     │ Ш
 Ш├────┼─────────────┼────────────┼─────────────────────────────────────────────────────────────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.]h
.begin
   npp := 0;
   nst := 0;
   iS1 := 0.0;
   iS2 := 0.0;
   iS4 := 0.0;
   iS5 := 0.0;
   iS7 := 0.0;
   iAkciz := 0.0;
   iSS := 0.0;
   wSubTip := if (Direct = 2, 4, 3)
   vKazRee.mrkPrim := InitMarker('', 8, 100, 20);
   vKazRee.mrkPrimDop := InitMarker('', 8, 100, 20);
   wYear := Year(dBeg);
   wMonth := Month(dBeg);
   strMonth := DateToStr(dBeg, 'MONTH');
   if (Months_Between(dBeg, dEnd) > 1) {
     case (wMonth) of
     1, 2, 3: wMonth := 1;
     4, 5, 6: wMonth := 2;
     7, 8, 9: wMonth := 3;
     10, 11, 12: wMonth := 4;
     end;
     strMonth := string(wMonth);
   }
end.
 Б^ Б

 Б                        ЖУРНАЛ РЕГИСТРАЦИИ СЧЕТОВ-ФАКТУР Б
 Б                               ПО ВАЛЮТАМ ВСЕХ ВИДОВ   Б

.if SetDateRange
.fields
  strMonth
  wYear
  MyOrgName
.endfields
 Б за @@@@@@@@@ месяц (квартал) @@@@@ г. по поставщику  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д Б
                                                       полное наименование юридического  
                                                       лица или его подразделения,       
                                                       физического лица                  
.end
.fields
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')
.endfields
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист    1 Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬─────────────────────────────────────────────────────────────────────┬────────────┬────────────────┬──────────────┬────────────────────────┬───────────────────┬────────────────────────┐ Ш
 Ш│ N  │   Номер     │Дата выписки│ Наименование, адрес покупателя                                      │    РНН     │ Номер и дата   │  Стоимость   │                        │   Всего стоимость │                        │ Ш
 Ш│п/п │счета-фактуры│  счета-    │                                                                     │ покупателя │   договора     │ поставки без │          НДС           │      реализации   │         Акциз          │ Ш
 Ш│    │ поставщика  │ фактуры    │                                                                     │            │  (контракта)   │    НДС       │                        │                   │                        │ Ш
 Ш│    │             │            │                                                                     │            │  на поставку   │              ├─────────┬──────────────┤                   ├─────────┬──────────────┤ Ш
 Ш│    │             │            │                                                                     │            │    товаров     │              │         │              │                   │         │              │ Ш 
 Ш│    │             │            │                                                                     │            │ (работ, услуг) │              │ Ставка  │    Сумма     │                   │ Ставка  │    Сумма     │ Ш
 Ш│    │             │            │                                                                     │            │                │              │         │              │                   │         │              │ Ш
 Ш│    │             │            │                                                                     │            │                │              │         │              │                   │         │              │ Ш
 Ш├────┼─────────────┼────────────┼─────────────────────────────────────────────────────────────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
 Ш│(1) │     (2)     │     (3)    │                          (4)                                        │     (5)    │       (6)      │      (7)     │   (8)   │      (9)     │        (10)       │   (11)  │     (12)     │ Ш
 Ш├────┼─────────────┼────────────┼─────────────────────────────────────────────────────────────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.{CheckEnter Schf
.begin
   npp := npp + 1;
   nst := 0; 
   vKazRee.nRecSchFact := nSchFact;

   isAvans := False;
   if ( (Direct = 2) and (SubTip = 17) ) isAvans := True;
   if ( (Direct = 1) and (SubTip = 16) ) isAvans := True;

   if (not isAvans) and (not skipInReestr)
   {
     iS1 := iS1 + S1;
     iS2 := iS2 + S2;
     iS4 := iS4 + S4;
     iS5 := iS5 + S5;
     iS7 := iS7 + S7;
     iAkciz := iAkciz + SAkciz;
     iSS := iSS + S;
   }
end.
.if HeaderGroup
.fields
  Upcase(NameGroup)
.endfields
.begin
  IsKontrGroup := KontrGroup;
end.
 Ш├────┴─────────────┴────────────┴─────────────────────────────────────────────────────────────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┤ Ш
 Ш│    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                            │ Ш
 Ш├────┬─────────────┬────────────┬─────────────────────────────────────────────────────────────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┤ Ш
.end
.if Dopol
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.{CheckEnter SpSchf
.} // SpSchf
.{CheckEnter KazSt;(not skipInReestr)
.fields
  npp
  if (nst = 0, NSF, '')
  if (nst = 0,
        if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' ),
        ''
     )
  if (nst = 0,
        if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
           ),
        ''
     )
  if (nst = 0, if (IsKontrGroup, '', OrgINN),
               ''
     )
  if (nst = 0,
        DogovorDO_NoDoc +
        if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
           ),
        ''
     )

  KzNoNDS - KzAkciz
  KzStNDS
  KzNDS
  if (nst = 0, S, 0)
  
  KzStAkc
  KzAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│&#&&&&.&&│&#&&&&&&&&&.&&│  &#&&&&&&&&&.&&   │&#&&&&.&&│&#&&&&&&&&&.&&│ Ш
.begin                                                                                                                                                                                                                     
  nst := nst + 1;
end.
.} // KazSt
.{?internal; ((nst = 0) and not skipInReestr);
.fields
  npp NSF
  if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' )
  if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
     )
  if (IsKontrGroup, '', OrgINN)

  DogovorDO_NoDoc +
  if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
     )

  S1 + S4 + S7 - SAkciz
  S2 + S5
  S
  SAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│         │&#&&&&&&&&&.&&│  &#&&&&&&&&&.&&   │         │&#&&&&&&&&&.&&│ Ш
.} // internal (nst = 0)                                                                                                                                                                                                   
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{ table 'vKazRee.SchFact'
.{ table 'vKazRee.BookPrZk'
.begin
  if (vKazRee.GetFirst SchFact1 = 0)
    InsertMarker(vKazRee.mrkPrim, vKazRee.SchFact1.nRec)
end.
.} // table
.} // table
.begin
  if (SubTip = 32)
    InsertMarker(vKazRee.mrkPrimDop, nSchFact)
end.
.[f
 Ш└────┴─────────────┴────────────┴─────────────────────────────────────────────────────────────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┘ Ш
.]f
.} // Schf

 И  ПРИМЕЧАНИЕ: И
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrim) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrim, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Авансовый СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrimDop) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrimDop, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Дополнительный СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.fields
  if (Direct = 1, Director, '')
  if (Direct = 1, Main_Buh, '')
.endfields
 И  Руководитель организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)                И
 И                                    М.П. И

 И  Главный бухгалтер организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)  И
.begin
  DoneMarker(vKazRee.mrkPrim, '');
  DoneMarker(vKazRee.mrkPrimDop, '');
end.
.endform

!--------------------------------------------------------------------------------------------------------------------
#doc
Журнал регистрации счетов-фактур (Казахстан, со свидетельством)
#end
.linkform 'Schfrees_54' prototype is 'Schfrees'
.NameInList 'Журнал регистрации счетов-фактур (Казахстан, со свидетельством)'
.Group 'Реестры счетов-фактур'
.create view vKazRee
var
  wSubTip: word;
  wMonth, wYear: word;
  strMonth: string;
  mrkPrim, mrkPrimDop: longint;
  nRecSchFact: comp; 
from
  SchFact  (ReadOnly),
  synonym SchFact SchFact1,
  BookPrZk (ReadOnly)
where
((
  nRecSchFact        == SchFact.nRec      and
  SchFact.nRec       == BookPrZk.cSchFact and
  (wSubTip = BookPrZk.SubTip)             and
  BookPrZk.cSchFactS == SchFact1.nRec
))
;
.var
 npp: longint
 nst: longint 
 iS1: double
 iS2: double
 iS4: double
 iS5: double
 iS7: double
 iAkciz: double
 iSS: double
 IsKontrGroup: boolean
 isAvans: boolean
 str: string
 i: longint
.endvar
.fields
  CFH
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')

  CFH
.endfields
.p 55
.defo landscape
.[h SKIP
 Б^ Б
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист @NP@ Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬────────────────────────────────────────────────────────┬────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┐ Ш
 Ш│(1) │     (2)     │     (3)    │                          (4)                           │     (5)    │     (6)    │       (7)      │      (8)     │   (9)   │      (10)    │        (11)       │   (12)  │     (13)     │ Ш
 Ш├────┼─────────────┼────────────┼────────────────────────────────────────────────────────┼────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.]h
.begin
   npp := 0;
   nst := 0;
   iS1 := 0.0;
   iS2 := 0.0;
   iS4 := 0.0;
   iS5 := 0.0;
   iS7 := 0.0;
   iAkciz := 0.0;
   iSS := 0.0;
   wSubTip := if (Direct = 2, 4, 3)
   vKazRee.mrkPrim := InitMarker('', 8, 100, 20);
   vKazRee.mrkPrimDop := InitMarker('', 8, 100, 20);
   wYear := Year(dBeg);
   wMonth := Month(dBeg);
   strMonth := DateToStr(dBeg, 'MONTH');
   if (Months_Between(dBeg, dEnd) > 1) {
     case (wMonth) of
     1, 2, 3: wMonth := 1;
     4, 5, 6: wMonth := 2;
     7, 8, 9: wMonth := 3;
     10, 11, 12: wMonth := 4;
     end;
     strMonth := string(wMonth);
   }
end.
 Б^ Б

 Б                        ЖУРНАЛ РЕГИСТРАЦИИ СЧЕТОВ-ФАКТУР Б

.if SetDateRange
.fields
  strMonth
  wYear
  MyOrgName
.endfields
 Б за @@@@@@@@@ месяц (квартал) @@@@@ г. по поставщику  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д Б
                                                       полное наименование юридического  
                                                       лица или его подразделения,       
                                                       физического лица                  
.end
.fields
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')
.endfields
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист    1 Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬────────────────────────────────────────────────────────┬────────────┬────────────┬────────────────┬──────────────┬────────────────────────┬───────────────────┬────────────────────────┐ Ш
 Ш│ N  │   Номер     │Дата выписки│ Наименование, адрес покупателя                         │    РНН     │   Серия    │ Номер и дата   │  Стоимость   │                        │   Всего стоимость │                        │ Ш
 Ш│п/п │счета-фактуры│  счета-    │                                                        │ покупателя │  и номер   │   договора     │ поставки без │          НДС           │     реализации    │         Акциз          │ Ш
 Ш│    │ поставщика  │ фактуры    │                                                        │            │ свидетель- │  (контракта)   │     НДС      │                        │                   │                        │ Ш
 Ш│    │             │            │                                                        │            │    ства    │  на поставку   │              ├─────────┬──────────────┼───────────────────┼─────────┬──────────────┤ Ш
 Ш│    │             │            │                                                        │            │            │    товаров     │              │         │              │                   │         │              │ Ш 
 Ш│    │             │            │                                                        │            │            │ (работ, услуг) │              │ Ставка  │    Сумма     │                   │ Ставка  │    Сумма     │ Ш
 Ш│    │             │            │                                                        │            │            │                │              │         │              │                   │         │              │ Ш
 Ш│    │             │            │                                                        │            │            │                │              │         │              │                   │         │              │ Ш
 Ш├────┼─────────────┼────────────┼────────────────────────────────────────────────────────┼────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
 Ш│(1) │     (2)     │     (3)    │                          (4)                           │     (5)    │     (6)    │       (7)      │      (8)     │   (9)   │      (10)    │        (11)       │   (12)  │     (13)     │ Ш
 Ш├────┼─────────────┼────────────┼────────────────────────────────────────────────────────┼────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.{CheckEnter Schf
.begin
   npp := npp + 1;
   nst := 0; 
   vKazRee.nRecSchFact := nSchFact;

   isAvans := False;
   if ( (Direct = 2) and (SubTip = 17) ) isAvans := True;
   if ( (Direct = 1) and (SubTip = 16) ) isAvans := True;

   if (not isAvans) and (not skipInReestr)
   {
     iS1 := iS1 + S1;
     iS2 := iS2 + S2;
     iS4 := iS4 + S4;
     iS5 := iS5 + S5;
     iS7 := iS7 + S7;
     iAkciz := iAkciz + SAkciz;
     iSS := iSS + S;
   }
end.
.if HeaderGroup
.fields
  Upcase(NameGroup)
.endfields
.begin
  IsKontrGroup := KontrGroup;
end.
 Ш├────┴─────────────┴────────────┴────────────────────────────────────────────────────────┴────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┤ Ш
 Ш│    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                            │ Ш
 Ш├────┬─────────────┬────────────┬────────────────────────────────────────────────────────┬────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┤ Ш
.end
.if Dopol
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.{CheckEnter SpSchf
.} // SpSchf
.{CheckEnter KazSt;(not skipInReestr)
.fields
  npp
  if (nst = 0, NSF, '')
  if (nst = 0,
        if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' ),
        ''
     )
  if (nst = 0,
        if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
           ),
        ''
     )
  if (nst = 0, if (IsKontrGroup, '', OrgINN),
               ''
     )
  if (nst = 0, trim(sertSerial + ' ' + sertNumber),
               ''
     )
  if (nst = 0,
        DogovorDO_NoDoc +
        if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
           ),
        ''
     )

  KzNoNDS - KzAkciz
  KzStNDS
  KzNDS
  if (nst = 0, S, 0)
  
  KzStAkc
  KzAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│&#&&&&.&&│&#&&&&&&&&&.&&│ &#&&&&&&&&&.&&    │&#&&&&.&&│&#&&&&&&&&&.&&│ Ш
.begin                                                                                                                                                                                                                     
  nst := nst + 1;
end.
.} // KazSt
.{?internal; ((nst = 0) and not skipInReestr);
.fields
  npp NSF
  if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' )
  if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
     )
  if (IsKontrGroup, '', OrgINN)
  trim(sertSerial + ' ' + sertNumber)
  DogovorDO_NoDoc +
  if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
     )

  S1 + S4 + S7 - SAkciz
  S2 + S5
  S
  SAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│         │&#&&&&&&&&&.&&│  &#&&&&&&&&&.&&   │         │&#&&&&&&&&&.&&│ Ш
.} // internal (nst = 0)                                                                                                                                                                                                   
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.fields
   FooterGroup
   GrS1 + GrS4 + GrS7 - GrSAkciz
   GrS2 + GrS5
   GrS
   GrSAkciz
.endfields                                                                                                                                                                                              
 Ш├────┴─────────────┴────────────┴────────────────────────────────────────────────────────┴────────────┴────────────┴────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
 Ш│    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                            │&'&&&&&&&&&.&&│    X    │&'&&&&&&&&&.&&│  &'&&&&&&&&&.&&   │    X    │&'&&&&&&&&&.&&│ Ш
 Ш├────┬─────────────┬────────────┬────────────────────────────────────────────────────────┬────────────┬────────────┬────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.end
.{ table 'vKazRee.SchFact'
.{ table 'vKazRee.BookPrZk'
.begin
  if (vKazRee.GetFirst SchFact1 = 0)
    InsertMarker(vKazRee.mrkPrim, vKazRee.SchFact1.nRec)
end.
.} // table
.} // table
.begin
  if (SubTip = 32)
    InsertMarker(vKazRee.mrkPrimDop, nSchFact)
end.
.[f
 Ш└────┴─────────────┴────────────┴────────────────────────────────────────────────────────┴────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┘ Ш
.]f
.} // Schf
.fields
   iS1 + iS4 + iS7 - iAkciz
   iS2 + iS5
   iSS
   iAkciz
.endfields
 Ш┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┐ Ш
 Ш│  Итого:                                                                                                                           │&'&&&&&&&&&.&&│    X    │&'&&&&&&&&&.&&│  &'&&&&&&&&&.&&   │    X    │&'&&&&&&&&&.&&│ Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┘ Ш

 И  ПРИМЕЧАНИЕ: И
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrim) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrim, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Авансовый СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrimDop) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrimDop, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Дополнительный СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.fields
  if (Direct = 1, Director, '')
  if (Direct = 1, Main_Buh, '')
.endfields
 И  Руководитель организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)                И
 И                                    М.П. И

 И  Главный бухгалтер организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)  И
.begin
  DoneMarker(vKazRee.mrkPrim, '');
  DoneMarker(vKazRee.mrkPrimDop, '');
end.
.endform

!--------------------------------------------------------------------------------------------------------------------
#doc
Журнал регистрации счетов-фактур (Казахстан, со свидетельством)
#end
.linkform 'Schfrees_55' prototype is 'Schfrees'
.NameInList 'Журнал регистрации счетов-фактур (Казахстан, со свидетельством)'
.Group 'Реестры счетов-фактур (по всем валютам)'
.create view vKazRee
var
  wSubTip: word;
  mrkPrim, mrkPrimDop: longint;
  wMonth, wYear: word;
  strMonth: string;
  nRecSchFact: longint;
from
  SchFact  (ReadOnly),
  synonym SchFact SchFact1,
  BookPrZk (ReadOnly)
where
((
  nRecSchFact        == SchFact.nRec      and
  SchFact.nRec       == BookPrZk.cSchFact and
  (wSubTip = BookPrZk.SubTip)             and
  BookPrZk.cSchFactS == SchFact1.nRec
))
;
.var
 npp: longint
 nst: longint 
 iS1: double
 iS2: double
 iS4: double
 iS5: double
 iS7: double
 iAkciz: double
 iSS: double
 IsKontrGroup: boolean
 isAvans: boolean
 str: string
 i: longint
.endvar
.fields
  CFH
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')

  CFH
.endfields
.p 55
.defo landscape
.[h SKIP
 Б^ Б
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист @NP@ Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬────────────────────────────────────────────────────────┬────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┐ Ш
 Ш│(1) │     (2)     │     (3)    │                          (4)                           │     (5)    │     (6)    │       (7)      │      (8)     │   (9)   │      (10)    │        (11)       │   (12)  │     (13)     │ Ш
 Ш├────┼─────────────┼────────────┼────────────────────────────────────────────────────────┼────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.]h
.begin
   npp := 0;
   nst := 0;
   iS1 := 0.0;
   iS2 := 0.0;
   iS4 := 0.0;
   iS5 := 0.0;
   iS7 := 0.0;
   iAkciz := 0.0;
   iSS := 0.0;
   wSubTip := if (Direct = 2, 4, 3)
   vKazRee.mrkPrim := InitMarker('', 8, 100, 20);
   vKazRee.mrkPrimDop := InitMarker('', 8, 100, 20);
   wYear := Year(dBeg);
   wMonth := Month(dBeg);
   strMonth := DateToStr(dBeg, 'MONTH');
   if (Months_Between(dBeg, dEnd) > 1) {
     case (wMonth) of
     1, 2, 3: wMonth := 1;
     4, 5, 6: wMonth := 2;
     7, 8, 9: wMonth := 3;
     10, 11, 12: wMonth := 4;
     end;
     strMonth := string(wMonth);
   }
end.
 Б^ Б

 Б                        ЖУРНАЛ РЕГИСТРАЦИИ СЧЕТОВ-ФАКТУР Б
 Б                               ПО ВАЛЮТАМ ВСЕХ ВИДОВ   Б

.if SetDateRange
.fields
  strMonth
  wYear
  MyOrgName
.endfields
 Б за @@@@@@@@@ месяц (квартал) @@@@@ г. по поставщику  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д Б
                                                       полное наименование юридического  
                                                       лица или его подразделения,       
                                                       физического лица                  
.end
.fields
  if (AllKontr = 0, '', 'по выбранным контрагентам ')+
  if (pBou = 0 and pDoc = 0, '', 'установлен фильтр по')+
  if (pBou = 0, '', ' состоянию')+
  if (pDoc = 0 or pBou = 0, '', ' и')+
  if (pDoc = 0, '', ' типу')+
  if (pBou = 0 and pDoc = 0, '', ' документов')
.endfields
 Й  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Й Б  Лист    1 Всего листов______ Б
 Ш┌────┬─────────────┬────────────┬────────────────────────────────────────────────────────┬────────────┬────────────┬────────────────┬──────────────┬────────────────────────┬───────────────────┬────────────────────────┐ Ш
 Ш│ N  │   Номер     │Дата выписки│ Наименование, адрес покупателя                         │    РНН     │   Серия    │ Номер и дата   │  Стоимость   │                        │   Всего стоимость │                        │ Ш
 Ш│п/п │счета-фактуры│  счета-    │                                                        │ покупателя │  и номер   │   договора     │ поставки без │          НДС           │     реализации    │         Акциз          │ Ш
 Ш│    │ поставщика  │ фактуры    │                                                        │            │ свидетель- │  (контракта)   │     НДС      │                        │                   │                        │ Ш
 Ш│    │             │            │                                                        │            │    ства    │  на поставку   │              ├─────────┬──────────────┼───────────────────┼─────────┬──────────────┤ Ш
 Ш│    │             │            │                                                        │            │            │    товаров     │              │         │              │                   │         │              │ Ш 
 Ш│    │             │            │                                                        │            │            │ (работ, услуг) │              │ Ставка  │    Сумма     │                   │ Ставка  │    Сумма     │ Ш
 Ш│    │             │            │                                                        │            │            │                │              │         │              │                   │         │              │ Ш
 Ш│    │             │            │                                                        │            │            │                │              │         │              │                   │         │              │ Ш
 Ш├────┼─────────────┼────────────┼────────────────────────────────────────────────────────┼────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
 Ш│(1) │     (2)     │     (3)    │                          (4)                           │     (5)    │     (6)    │       (7)      │      (8)     │   (9)   │      (10)    │        (11)       │   (12)  │     (13)     │ Ш
 Ш├────┼─────────────┼────────────┼────────────────────────────────────────────────────────┼────────────┼────────────┼────────────────┼──────────────┼─────────┼──────────────┼───────────────────┼─────────┼──────────────┤ Ш
.{CheckEnter Schf
.begin
   npp := npp + 1;
   nst := 0; 
   vKazRee.nRecSchFact := nSchFact;

   isAvans := False;
   if ( (Direct = 2) and (SubTip = 17) ) isAvans := True;
   if ( (Direct = 1) and (SubTip = 16) ) isAvans := True;

   if (not isAvans) and (not skipInReestr)
   {
     iS1 := iS1 + S1;
     iS2 := iS2 + S2;
     iS4 := iS4 + S4;
     iS5 := iS5 + S5;
     iS7 := iS7 + S7;
     iAkciz := iAkciz + SAkciz;
     iSS := iSS + S;
   }
end.
.if HeaderGroup
.fields
  Upcase(NameGroup)
.endfields
.begin
  IsKontrGroup := KontrGroup;
end.
 Ш├────┴─────────────┴────────────┴────────────────────────────────────────────────────────┴────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┤ Ш
 Ш│    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                            │ Ш
 Ш├────┬─────────────┬────────────┬────────────────────────────────────────────────────────┬────────────┬────────────┬────────────────┬──────────────┬─────────┬──────────────┬───────────────────┬─────────┬──────────────┤ Ш
.end
.if Dopol
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.{CheckEnter SpSchf
.} // SpSchf
.{CheckEnter KazSt;(not skipInReestr)
.fields
  npp
  if (nst = 0, NSF, '')
  if (nst = 0,
        if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' ),
        ''
     )
  if (nst = 0,
        if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
           ),
        ''
     )
  if (nst = 0, if (IsKontrGroup, '', OrgINN),
               ''
     )
  if (nst = 0, if (IsKontrGroup, '', trim(sertSerial + ' ' + sertNumber)),
               ''
     )
  if (nst = 0,
        DogovorDO_NoDoc +
        if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
           ),
        ''
     )

  KzNoNDS - KzAkciz
  KzStNDS
  KzNDS
  if (nst = 0, S, 0)
  
  KzStAkc
  KzAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│&#&&&&.&&│&#&&&&&&&&&.&&│  &#&&&&&&&&&.&&   │&#&&&&.&&│&#&&&&&&&&&.&&│ Ш
.begin                                                                                                                                                                                                                     
  nst := nst + 1;
end.
.} // KazSt
.{?internal; ((nst = 0) and not skipInReestr);
.fields
  npp NSF
  if ( longint(dFact) <> 0, DateToStr(dFact,'DD/MM/YYYY'), '' )
  if (IsKontrGroup, if (Direct = 1, GruzTo, GruzFrom),
                          if (OrgAddr = '', OrgName, OrgName + ', ' + OrgAddr)
     )
  if (IsKontrGroup, '', OrgINN)
  if (IsKontrGroup, '', trim(sertSerial + ' ' + sertNumber))
  DogovorDO_NoDoc +
  if ( longint(DogovorDO_dDoc) <> 0,
               ' от ' + DateToStr(DogovorDO_dDoc, 'DD/MM/YYYY'),
               '' 
     )

  S1 + S4 + S7 - SAkciz
  S2 + S5
  S
  SAkciz
.endfields
 Ш│@@@@│@@@@@@@@@@@@@│@@@@@@@@@@@@│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@│@~@@@@@@@@@@@@@@│&#&&&&&&&&&.&&│         │&#&&&&&&&&&.&&│  &#&&&&&&&&&.&&   │         │&#&&&&&&&&&.&&│ Ш
.} // internal (nst = 0)                                                                                                                                                                                                   
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{ table 'vKazRee.SchFact'
.{ table 'vKazRee.BookPrZk'
.begin
  if (vKazRee.GetFirst SchFact1 = 0)
    InsertMarker(vKazRee.mrkPrim, vKazRee.SchFact1.nRec)
end.
.} // table
.} // table
.begin
  if (SubTip = 32)
    InsertMarker(vKazRee.mrkPrimDop, nSchFact)
end.
.[f
 Ш└────┴─────────────┴────────────┴────────────────────────────────────────────────────────┴────────────┴────────────┴────────────────┴──────────────┴─────────┴──────────────┴───────────────────┴─────────┴──────────────┘ Ш
.]f
.} // Schf

 И  ПРИМЕЧАНИЕ: И
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrim) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrim, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Авансовый СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.begin
  i := 0;
end.
.{while ( i < GetMarkerCount(vKazRee.mrkPrimDop) );
.begin
  var nnn: comp;
  GetMarker(vKazRee.mrkPrimDop, i, nnn);
  vKazRee.nRecSchFact := nnn

  if (vKazRee.GetFirst SchFact = 0) {};
  str := 'Дополнительный СФ N' + vKazRee.SchFact.Num + 
         if (longint(vKazRee.SchFact.dFact) <> 0, ' от ' +
            string(vKazRee.SchFact.dFact), '') + 
         if (trim(vKazRee.SchFact.Nazn) <> '', ' (' + vKazRee.SchFact.Nazn + ')', '');
  i := i + 1;
end.
.fields
  str
.endfields
 И               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ И
.} // while
.fields
  if (Direct = 1, Director, '')
  if (Direct = 1, Main_Buh, '')
.endfields
 И  Руководитель организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)                И
 И                                    М.П. И

 И  Главный бухгалтер организации И
 И  ^ И
 И  ____________________________________________  И
 И               (Ф.И.О., подпись)  И
.begin
  DoneMarker(vKazRee.mrkPrim, '');
  DoneMarker(vKazRee.mrkPrimDop, '');
end.
.endform

!--------------------------------------------------------------------------------------------------------------------
