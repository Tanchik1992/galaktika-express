//********************************************************************************
//                                                        (c) корпорация Галактика
// Галактика 7.12 - _
// _
//********************************************************************************

//╔══════════════════════════════════════════════════════════════════════╗
//║ Запрет на редакт. полей капстроя (предупреждение для других полей)   ║
//║ в позиции накладной(акта) при наличии распределения платежа          ║
//╚══════════════════════════════════════════════════════════════════════╝

IF CurTable = tnSpSopr
  IF (isEditSoprVisible or TW = 1) //ЕСТЬ ОКНО РЕДАКТИРОВАНИЯ
    If GetFirst SpSopHoz where ((SpSopr.NRec == SpSopHoz.cSpSopr)) = tsOk
    {
      OtkatToOldState := FALSE;
      if (CurField = #AddSumTune.Name) or
      #ifdef _AKT111_VIP
         (CurField = #KatStroy2.Name)
      #else
         (CurField = #KatStroy.Name)
      #end

        {
          if mess
            Message('Поле нельзя редактировать, т.к. по позиции есть платеж!' +
                     ''#13#3'Cумма платежа: '+ string(round(SpSopHoz.Summa, 2)));
          Exit;
        }
      else
        if SpSopr.NRec <> CurrSpSoprNRec
          {
            if mess
              if Message('По позиции есть распределенный платеж!'#13#3+
                        'Cумма платежа: '+ string(round(SpSopHoz.Summa, 2)) +
                        ''#13#3'Отменить '+ if (CurCommand = cmPick, 'выбор?', 'редактирование?'),
                           YesNo + Confirmation) = cmNo
             {
               CurrSpSoprNRec := SpSopr.NRec;
               OtkatToOldState := TRUE;
               Exit;
             }
           Exit;
          }
    }
