//********************************************************************************
//                                                        (c) ชฎเฏฎเๆจ๏ ซชโจช
// ซชโจช 7.12 - _
// _
//********************************************************************************

!ษอออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป
!บ งญ็ฅญจฅ    : คซ๏ ซ.็.                                               บ
!ศอออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ
//ฏญฅซ์ แชเจญ ฏฎ Ctrl+Enter
cmInit: //คซ๏ ซ.็.
  if boGetTune('Oper.NalUch') = TRUE AND CurTable = #SpSopr
    {
      sumNalUch_s := 'ใฌฌ คซ๏ ';   //strNDE := s_SimvRub;
      RunInterface(ViewNalUch, SpSopr.nRec, sumNalUch, sumNalUchUsl, FALSE);
      set SpSopr.priceN := sumNalUch/SpSopr.kolFact;
      set SpSopr.vPriceN := sumNalUchUsl/SpSopr.kolFact;
      set sumNalUch := SpSopr.priceN*SpSopr.kolFact;

      SetFieldState(#sumNalUch_s, sfVisible);
      SetFieldState(#sumNalUch, sfVisible);
    }
  else
    {
      ClearFieldState(#sumNalUch_s, sfVisible);
      ClearFieldState(#sumNalUch, sfVisible);
    }


cmOpenSearch: //คซ๏ ซ.็.
  {
    if CurField<>#sumNalUch or CurTable<>#SpSopr
      Exit;
    var getSum: double;  getSum := SpSopr.priceN*SpSopr.kolFact;
    if RunDialog('GetSumTov', getSum) = cmCancel
      Exit;
    SpSopr.priceN := getSum/SpSopr.kolFact;
    SpSopr.vPriceN := 0;
    set sumNalUch := SpSopr.priceN*SpSopr.kolFact;
    set SpSopr.manualNalUch := 1;
    Abort;
  }

cmPick:  //คซ๏ ซ.็.
  {
    if CurField<>#sumNalUch or CurTable<>#SpSopr
      Exit;
    if not IsValid(#SpSopr)
      Exit;
    if SpSopr.manualNalUch = 1
      if Message('ซฎฃฎข๏ แใฌฌ ฏฎ คญญฎฉ ฏฎงจๆจจ ญชซคญฎฉ - เใ็ญ๏. '+
                 'งฌฅญจโ์ ญ เแ็ฅโญใ๎?', YesNo) <>cmYes
        Exit;
    SpSopr.manualNalUch := 0;
    update current SpSopr;
    RunInterface(ViewNalUch, SpSopr.nRec, sumNalUch, sumNalUchUsl, TRUE);
    SpSopr.priceN := sumNalUch/SpSopr.kolFact;
    set SpSopr.vPriceN := sumNalUchUsl;
    set sumNalUch := SpSopr.priceN * SpSopr.kolFact;
    Abort;
  }
