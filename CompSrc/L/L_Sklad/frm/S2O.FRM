! ╔═════════════════════════════════════════════════════════════════════════╗
! ║  Разработал:  Александр Крахотко                                        ║
! ║  Назначение:  пакетное списание накладных                               ║
! ╚═════════════════════════════════════════════════════════════════════════╝

#include predefs.inc

#doc
Пакетное списание накладных
#end
.Set Name = 'sopr2order'
.hide
.fields
  Название_ведомости
  дата_опр : date
  склад_опр
  мол_опр
  номер_накл
  дата_накл : date
  орг_накл
!.{
  ном_орд
  вид_орд : word // SklOrder.VidOrder = 0 - приходный, 1 - расходный
  дата_орд : date
  мол_орд
  склад_орд
!.{
#ifdef GAL5_80
  SpOrder_nrec : comp
#end
  назван_тов ед_измер кол цена_нац цена_баз партия
!.}
!.}
.endfields
 ^
.if Not600
Not600 ^ ^ ^
.end
.{
  номер_накл ^
  дата_накл  ^
  орг_накл   ^

.{
  ном_орд    ^
  вид_орд    ^
  дата_орд   ^
  мол_орд    ^
  склад_орд  ^

.{
#ifdef GAL5_80
  SpOrder_nrec ^
#end
  назван_тов ^
  ед_измер   ^
  кол        ^
  цена_нац   ^
  цена_баз   ^
  партия     ^

.}
.}
.}
.endform

#doc
Список сформированных ордеров
#end
.linkform 'sopr2order_02' prototype is 'sopr2order'
.nameInList 'Список сформированных ордеров'
.fields
  CommonFormHeader
  Название_ведомости
  DateToStr(дата_опр,'DD/MM/YYYY')
  склад_опр
  мол_опр

  DateToStr(дата_накл,'DD/MM/YYYY')
  номер_накл орг_накл

  if (вид_орд = 0,'приходный','расходный')
  DateToStr(дата_орд,'DD/MM/YYYY')
  ном_орд
  if (вид_орд = 0,'на склад  ','со склада  ') + склад_орд
  мол_орд

  назван_тов ед_измер кол цена_нац цена_баз партия

.endfields
 Ш^ Ш

 Б ПАКЕТНОЕ ФОРМИРОВАНИЕ ОРДЕРОВ ПО ^ Б

.if Not600
 Параметры формирования складских ордеров
   БДата Б  ^
   БОбщий для всех Склад Б ^
   БОбщий для всех МОЛ   Б ^

.end
  БСформированы следующие складские ордера: Б
 Р─────────────────────────────────┬─────────┬──────────────┬─────────────────────────────┬──────────────────────────────
                                 │ Единица │              │           Ц Е Н А           │
    МЦ                           │измерения│  Количество  ├──────────────┬──────────────┤   Партия
                                 │         │              │ в нац.валюте │ в баз.валюте │
─────────────────────────────────┴─────────┴──────────────┴──────────────┴──────────────┴────────────────────────────── Р
.{
 БПо накладной от  Б@@@@@@@@@@  Бномер Б ^  Бконтрагент Б  Р^ Р
.{
 Бсформирован @@@@@@@@@ ордер от Б @@@@@@@@@@  Бномер Б ^
   ^
   МОЛ  ^
.{
 Р  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@ &&&&&&&&&&.&&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
.}
.}
 Р ...................................................................................................................... Р
.}
.endform





#ifdef GAL5_80
#doc
Список сформированных ордеров, с распределением по ячейкам
#end
.linkform 'sopr2order_03' prototype is 'sopr2order'
.nameInList 'Список сформированных ордеров, с распределением по ячейкам'
.create view s2o_Box
  from
      SpBox
    , SaldoBox
    , KatBox
  where
    ((
          SpOrder_nRec          ==      SpBox.cSpOrder
      and SpBox.cSaldoBox       ==      SaldoBox.nRec
      and SaldoBox.cBox         ==      KatBox.nRec
    ))
;
.fields
  CommonFormHeader
  Название_ведомости
  DateToStr(дата_опр,'DD/MM/YYYY')
  склад_опр
  мол_опр
  DateToStr(дата_накл,'DD/MM/YYYY')
  номер_накл орг_накл

  if (вид_орд = 0,'приходный','расходный')
  DateToStr(дата_орд,'DD/MM/YYYY')
  ном_орд
  if (вид_орд = 0,'на склад  ','со склада  ') + склад_орд
  мол_орд

  назван_тов ед_измер кол цена_нац цена_баз партия

.endfields
 Ш^ Ш

 Б ПАКЕТНОЕ ФОРМИРОВАНИЕ ОРДЕРОВ ПО ^ Б

.if Not600
 Параметры формирования складских ордеров
   БДата Б  ^
   БОбщий для всех Склад Б ^
   БОбщий для всех МОЛ   Б ^

.end
  БСформированы следующие складские ордера: Б
 Р
─────────────────────────────────┬─────────┬──────────────┬─────────────────────────────┬────────────────────────────────┬─────────────────────────────────────────────────────
                                 │ Единица │              │           Ц Е Н А           │                                │                    Ячейка хранения
    МЦ                           │измерения│  Количество  ├──────────────┬──────────────┤   Партия                       ├─────────────────────┬─────────────┬─────────────────
                                 │         │              │ в нац.валюте │ в баз.валюте │                                │ Наименование        │ Код         │ Количество
─────────────────────────────────┴─────────┴──────────────┴──────────────┴──────────────┴────────────────────────────────┴─────────────────────┴─────────────┴─────────────────
 Р
.{
 БПо накладной от  Б@@@@@@@@@@  Бномер Б ^  Бконтрагент Б  Р^ Р
.{
 Бсформирован @@@@@@@@@ ордер от Б @@@@@@@@@@  Бномер Б ^
   ^
   МОЛ  ^
.{
 Р  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@ &&&&&&&&&&.&&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
.{margin table 's2o_Box.SpBox'
.fields
   s2o_Box.KatBox.Name
   s2o_Box.KatBox.Kod
   s2o_Box.SpBox.Kol
.endfields
 Р @@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@ &&&&&&&&&&&.&&&& Р
.}
.}
.}

.}
.endform
#end
