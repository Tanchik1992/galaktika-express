!╔═══════════════════════════════════════════════════════════════════════════╗
!║                     (c) 1994,99 корпорация ГАЛАКТИКА                      ║
!║ Проект        : ГАЛАКТИКА                                                 ║
!║ Система       : Отдел разработки контура логистики                        ║
!║ Версия        : 5.71                                                      ║
!║ Назначение    : Форма для иерархических реестров ДО                       ║
!║ Ответственный : Сорока Валерий Васильевич                                 ║
!╚═══════════════════════════════════════════════════════════════════════════╝
!-----------------------------------------------------------------------------
#include predefs.inc
!-----------------------------------------------------------------------------
#doc
Форма для иерархических реестров ДО
#end
.form 'BDOCRST'
.hide
.fields
 wPrintForm    : word    //01
 strReestrName : string  //01a
 boGrpDOActive : boolean //02
 pVidDoc       : word    //03
 MyOrg         : string  //04
 MyInn         : string  //05
 Currency      : string  //06
 KontrAgent    : string  //07
 dBegin        //: date    //08
 dEnd          //: date    //09
 Descr         : string  //10
 GrDescr       : string  //10a
 Sost          : string  //11
#ifdef __CentrOtv__
 OtvPodr       : string  //11a
#end
 GroupDO       : string
 flgFilters    : word    //12 - UserDeskRep.ResWord[20]
 wFiltOnExecDoc: word    //13
 flgRepStyles  : word    //14
 wFiltPaidDoc  : word    //15
 ValNDE        : string  //16
 ValTar        : string  //17
.endfields
           1
 1a23456789.0a1б234567
 ^^^^^^^^^^ ^^^^^^^^^^
#ifdef __CentrOtv__
 ^
#end
.{ //main cycle
.{ CheckEnter GroupHeader
.fields
 GroupHeaderName : string  //18
 GroupSum2       : double  //19
 GroupSumV2      : double  //20
 GroupPercentNDE : double  //21
.endfields
 1  2
 89.01
 ^^ ^^
.} // CheckEnter GroupHeader
.fields
  ccBaseDoc : comp
  CurrencyDO : string      //37
!  sumPaidNDE : double      //38
 .endfields
  ccBaseDoc - ^
  CurrencyDO - ^
!  sumPaidNDE - ^
.if PrnBDocSpec
.end //if
.fields
  DocIt     : double        //49
  DocItV    : double        //50
  DocSum    : double        //51
  DocBez20  : double        //52
  DocNDS20  : double        //53
  DocBez10  : double        //54
  DocNDS10  : double        //55
  DocNetNDS : double        //56
  DocPaidNDE: double        //56a
  DocBez18  : double        //56b
  DocNDS18  : double        //56c
 .endfields
  4.5
  9.0123456abc
  ^ ^^^^^^^^^^
.{ CheckEnter GroupTotal
.fields
  GroupTotalName : string  //57
  GroupSum       : double  //58
  GroupSumV      : double  //59
  GroupDocSum    : double  //60
  GroupDocBez20  : double  //61
  GroupDocNDS20  : double  //62
  GroupDocBez10  : double  //63
  GroupDocNDS10  : double  //64
  GroupDocNetNDS : double  //65
  GroupDocPaidNDE: double  //66
  GroupDocBez18  : double  //66a
  GroupDocNDS18  : double  //66b
.endfields
 5   6
 789.0123456ab
 ^^^ ^^^^^^^^^
.} // CheckEnter GroupTotal
.} // end of main cycle
.if PrintAllSums
.fields
  sAllTotalsHeader : string //67
.endfields
67
 ^
.end //if
.endform
!
!
!
#doc
РЕЕСТР ДОКУМЕНТОВ-ОСНОВАНИЙ
#end
.linkform 'BDOCRST_Reestr01' prototype is 'BDOCRST'
!реестры ДО с pVidDoc = 201, 211, 510 (СО СПЕЦИФИКАЦИЕЙ)
.group 'РЕЕСТР ДО'
.p 55
.defo landscape
.NameInList 'РЕЕСТР ДОКУМЕНТОВ-ОСНОВАНИЙ'
! ----------------------------------------------------------------------
#include vBDReest.frn
! ----------------------------------------------------------------------
.var
  boIsFilter    : Boolean;       //флаг установленных фильтров
  strMustPaid   : string;
  strKolRes     : string;
  strReeItV     : string;
  strGroupSumV  : string;
!----- итоговые суммы реестра---
  ReeIt, ReeItV : double;
!-------------------------------
  strWarning    : string;
  strNameDoc    : string;
  strRekvKontr  : string;
  strCurrencyDO : string;
  boNeedSpecif,
  boCalcInValOtch  : boolean;
#ifdef GAL6_0
!для печати свойств МЦ
  ccDocClass     : Comp;
  boPrintLoop    : Boolean;       //флаг печати итерации цикла
  IDPtr          : Word;          //внутренний указатель для позиционирования
  ClassName  ,                    //название аналитики
  SpClassName,                    //название множества значений
  SpClassVal     : String;        //значение
#end //GAL6_0
.endvar
.begin
 boNeedSpecif := ((flgRepStyles and 1 ) <> 0);
 boCalcInValOtch := ((flgRepStyles and 2) <> 0);
!----- инициализация итоговых сумм реестра---
 ReeIt     := 0;
 ReeItV    := 0;
!--------------------------------------------
 strWarning := if( wPrintForm = 1, '***** ВНИМАНИЕ! РЕЕСТР ПОЛУЧЕН, НАЧИНАЯ С ТЕКУЩЕГО УРОВНЯ ДЕРЕВА ***** ДЛЯ ПОЛУЧЕНИЯ ПОЛНОГО РЕЕСТРА ВОСПОЛЬЗУЙТЕСЬ <CTRL>+<P> *****', '');
end.
.fields
 CommonFormHeader
 strWarning
.endfields
 ^   ^
.{ ?internal; (pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510);
.fields
 strReestrName
.endfields
 Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}// .{ ?internal; (pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510);
.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510);
.fields
 strReestrName
.endfields
 Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}// .{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510);
.{ ?INTERNAL; ((flgFilters and word(32)) = 32);
.fields
 Sost
.endfields
       Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}
!------------------------------------------------------------------------
.{ ?INTERNAL; ((flgFilters and word(4)) = 4);
.Fields
 dBegin
 dEnd
.EndFields
      за период с  Б^ Б  по   Б^ Б
.}
!------------------------------------------------------------------------
.begin
 if ( ((flgFilters and  word(1))  =  1)
   OR ((flgFilters and  word(2))  =  2)
   OR ((flgFilters and  word(8))  =  8)
   OR ((flgFilters and word(16))  = 16)
#ifdef __CentrOtv__
   OR ((flgFilters and word(64))  = 64)
#end
    ) boIsFilter := True
 else boIsFilter := False;
end.
.{ ?INTERNAL; boIsFilter;
      Используются фильтры:
!------------------------------------------------------------------------
.{ ?INTERNAL; ((flgFilters and word(1) ) = 1));
.Fields
 Currency
.EndFields
       Б^ Б
.}
!------------------------------------------------------------------------
.{ ?INTERNAL; ((flgFilters and word(2) ) = 2));
.Fields
 KontrAgent
.EndFields
       Б^ Б
.}
!------------------------------------------------------------------------
.{ ?INTERNAL; ((flgFilters and word(8) ) = 8));
.Fields
 Descr
.EndFields
      по дескриптору -  Б^ Б
.}
!------------------------------------------------------------------------
.{ ?INTERNAL; ((flgFilters and word(16) ) = 16));
.Fields
 GrDescr
.EndFields
      по группе дескрипторов -  Б^ Б
.}
#ifdef __CentrOtv__
!------------------------------------------------------------------------
.{ ?INTERNAL; ((flgFilters and word(64) ) = 64));
.Fields
 OtvPodr
.EndFields
       Б^ Б
.}
#end
.{ ?INTERNAL; ((flgFilters and word(128) ) = 128));
.Fields
 GroupDO
.EndFields
       Б^ Б
.}
.} // ?INTERNAL; ( (flgFilters and word(11)) > 0 );
.{ ?internal; (not boNeedSpecif) and boCalcInValOtch;
.fields ValNDE ValTar .endfields
 ───────────────────────┬──────────────────────────────────┬─────────┬───────────┬───────────────────────────────────────
      Дата и номер      │                                  │  Срок   │ Необходимо│                 Итого
       документа-       │            Контрагент            │действия,│оплатить до│───────────────────┬───────────────────
       основания        │                                  │  дней   │           │     в @@@@@@      │     в @~@@@@@@@@
 ───────────────────────┴──────────────────────────────────┴─────────┴───────────┴───────────────────┴───────────────────
.} //.{ ?internal; (not boNeedSpecif) and boCalcInValOtch;
.{ ?internal; (not boNeedSpecif) and (not boCalcInValOtch);
.fields ValNDE ValTar .endfields
 ───────────────────────┬──────────────────────────────────┬─────────┬───────────┬───────────────────────────────────────┬─────────────
      Дата и номер      │                                  │  Срок   │ Необходимо│                 Итого                 │
       документа-       │            Контрагент            │действия,│оплатить до│───────────────────┬───────────────────│  Валюта ДО
       основания        │                                  │  дней   │           │     в @@@@@@      │     в @~@@@@@@@@  │
 ───────────────────────┴──────────────────────────────────┴─────────┴───────────┴───────────────────┴───────────────────┴─────────────
.} //.{ ?internal; (not boNeedSpecif) and (not boCalcInValOtch);
!------------------------------------------------------------------------
.{ //MAIN CYCLE ON BASEDOC's
!------------------------------------------------------------------------
.[h SKIP
.{ ?internal; (pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510);
.fields
 CommonFormHeader
 strReestrName
.endfields

 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Лист N @Np@

.} //.{ ?internal; (pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510);
.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510);
.fields
 CommonFormHeader
 strReestrName
.endfields

 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Лист N @Np@

.} //.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510);
.]h //HEADER end
!------------------------------------------------------------------------
.{ CheckEnter GroupHeader; ((flgRepStyles and word(4)) = 4);
.Fields GroupHeaderName:'T:-' .EndFields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}//CheckEnter GroupHeader; ((flgRepStyles and word(4)) = 4);
.{ table 'vBaseDocRee.BaseDoc'
.begin
  strMustPaid := if(  ( longint(StepDoc.dOplMax) = 0)
                     , ''
                     , ', оплатить до ' + DateToStr( StepDoc.dOplMax, 'DD/MM/YYYY' )
                    );
   strRekvKontr := if( boNeedSpecif, ', контрагент: ', '' ) + KatOrg.Name + if( Trim( KatOrg.Tel ) <> '' , ', т/ф.' + KatOrg.Tel, '' );
   strCurrencyDO := if( boCalcInValOtch, '', ', валюта ДО: ' + CurrencyDO );
end.
.{ ?internal; boNeedSpecif;
.fields
!  DecNo
   PrintNumber( vBaseDocRee.BaseDoc.Descr, vBaseDocRee.BaseDoc.nodoc )
!  dDoc
   BaseDoc.dDoc
!  Koldn
   BaseDoc.KolDn
   strMustPaid
   strRekvKontr
   strCurrencyDO
 .endfields
 ДО N Б ^ Б от Б ^ Б, действителен Б ^ Б дн.^^^
.} //.{ ?internal; boNeedSpecif;
.{ ?internal; (not boNeedSpecif) and boCalcInValOtch;
.fields
!   dDoc
   BaseDoc.dDoc
!   DecNo
   PrintNumber( vBaseDocRee.BaseDoc.Descr, vBaseDocRee.BaseDoc.nodoc )
   strRekvKontr
!   Koldn
   BaseDoc.Koldn
   StepDoc.dOplMax
   DocIt
   DocItV
.endfields
 @@@@@@@@@@ @@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ @~@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&&
.} //.{ ?internal; (not boNeedSpecif) and boCalcInValOtch;
.{ ?internal; (not boNeedSpecif) and (not boCalcInValOtch);
.fields
!   dDoc
   BaseDoc.dDoc
!   DecNo
   PrintNumber( vBaseDocRee.BaseDoc.Descr, vBaseDocRee.BaseDoc.nodoc )
   strRekvKontr
!   Koldn
   BaseDoc.Koldn
   StepDoc.dOplMax
   DocIt
   DocItV
   CurrencyDO
.endfields
 @@@@@@@@@@ @@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ @~@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& @~@@@@@@@@@@@
.} //.{ ?internal; (not boNeedSpecif) and boCalcInValOtch;
.{ ?internal; ((pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510) and boNeedSpecif);
.fields
  ValNDE
  ValTar
.endfields
                   ──────────────────────────┬──────────────┬──────┬──────────────┬────────────────────────────────────┬────────────────────────────────────┬──────────────┬───────────
                        Наименование         │Номенклатурный│ Ед.  │  Количество  │            В @@@@@@                │              В @~@@@@@@@@          │  Количество  │   Срок
                       товара/услуги         │    номер     │ изм. │              ├────────────────┬───────────────────┼────────────────┬───────────────────┤   резерва    │ действия
                                             │              │      │              │      Цена      │   Стоимость       │      Цена      │   Стоимость       │              │  резерва
                   ──────────────────────────┴──────────────┴──────┴──────────────┴────────────────┴───────────────────┴────────────────┴───────────────────┴──────────────┴───────────
.} //.{ ?internal; ((pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510) and boNeedSpecif);
.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510 and boNeedSpecif);
.fields
  ValNDE
  ValTar
.endfields
                   ──────────────────────────┬──────────────┬──────┬──────────────┬────────────────────────────────────┬────────────────────────────────────
                          Наименование       │Номенклатурный│ Ед.  │  Количество  │            В @@@@@@                │             В @~@@@@@@@@
                         товара/услуги       │    номер     │ изм. │              ├────────────────┬───────────────────┼────────────────┬───────────────────
                                             │              │      │              │      Цена      │   Стоимость       │      Цена      │   Стоимость
                   ──────────────────────────┴──────────────┴──────┴──────────────┴────────────────┴───────────────────┴────────────────┴───────────────────
.} //.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510 and boNeedSpecif);
.if PrnBDocSpec
.{ table 'vBaseDocRee.SpStep'
.begin
#include vBDProc.frn
end.
.{ ?internal; (pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510);
.fields
!   NameMC
    if( SpStep.PrMC = 1, KatMC.Name, KatUsl.Name )
!   Nomenkl
    if( SpStep.PrMC = 1, KatMC.BarKod, KatUsl.Kod )
!   Ed
!    KatOtpEd.Name
    KatOtpEd.Abbr
!   Kol
    SpStep.Kol
!   Price
    dblPriceNDE
!   Summa
    dblSumNDE
!   VPrice
    dblPriceVal
!   VSumma
    dblSumVal
.endfields
.fields
!   strKolRes
    SpStep.Reserv
!   SrokRes
    SpStep.SrokRes
.endfields
                   @@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@ @~@@@@ &'&&&&&&&&.&&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&.&&& @@@@@@@@@@@
#ifdef GAL6_0
.{ table 'vBaseDocRee.SpDopEd'
.fields
  vBaseDocRee.KatDopEd.ShortName
  vBaseDocRee.SpDopEd.Kol
.endfields
                                                             @~@@@@ &'&&&&&&&&.&&&
! ---------------------------------------------------------------------
#include VBDMZPrn.frn
! ---------------------------------------------------------------------
.} //.table 'vBaseDocRee.SpDopEd'
#end //GAL6_0
.} //.{ ?internal; (pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510);
.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510);
.fields
!   NameMC
    if( SpStep.PrMC = 1, KatMC.Name, KatUsl.Name )
!   Nomenkl
    if( SpStep.PrMC = 1, KatMC.BarKod, KatUsl.Kod )
!   Ed
    KatOtpEd.Abbr
!   Kol
    SpStep.Kol
!   Price
    dblPriceNDE
!   Summa
    dblSumNDE
!   VPrice
    dblPriceVal
!   VSumma
    dblSumVal
.endfields
                   @@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@ @~@@@@ &'&&&&&&&&.&&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&&
#ifdef GAL6_0
.{ table 'vBaseDocRee.SpDopEd'
.fields
  vBaseDocRee.KatDopEd.ShortName
  vBaseDocRee.SpDopEd.Kol
.endfields
                                                             @~@@@@ &'&&&&&&&&.&&&
! ---------------------------------------------------------------------
#include VBDMZPrn.frn
! ---------------------------------------------------------------------
.} //.table 'vBaseDocRee.SpDopEd'
#end //GAL6_0
.} //.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510);
.} //table
.end //if
.} //table BaseDoc
.begin
  ReeIt     := ReeIt  + DocIt;
  ReeItV    := ReeItV + DocItV;
end.
.{ ?internal; boNeedSpecif;
                   ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
.fields
  DocIt
  DocItV
.endfields
                 Б   Итого по документу-основанию:                                                    &'&&&&&&&&&&&&&&.&&                  &'&&&&&&&&&&&&&&.&& Б
.} //.{ ?internal; boNeedSpecif;
.{ CheckEnter GroupTotal; ((flgRepStyles and 4) = 4);
.begin
  strGroupSumV := if( boCalcInValOtch, DoubleToStr( GroupSumV, '\2p[|-]36`666`666`666`666`666.88' ),'');
end.
.{ ?internal; boNeedSpecif;
.fields
  GroupTotalName:'T:-'
  GroupSum
  strGroupSumV
.endfields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&&                  &'&&&&&&&&&&&&&&.&& Б
.} //.{ ?internal; boNeedSpecif;
.{ ?internal; not boNeedSpecif;
.fields
  GroupTotalName:'T:-'
  GroupSum
  strGroupSumV
.endfields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& Б
.} //.{ ?internal; not boNeedSpecif;
.} //CheckEnter GroupTotal; ((flgRepStyles and 4) = 4);
.} //MAIN CYCLE ON BASEDOC's
.begin
  strReeItV := if(((flgRepStyles and 2 )=2), DoubleToStr( ReeItV, '\2p[|-]36`666`666`666`666`666.88' ),'');
end.
.if PrintAllSums
.{ ?internal; boNeedSpecif;
.{ ?internal; ((pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510) and boNeedSpecif);
 ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
.}//.{ ?internal; ((pVidDoc = 201 or pVidDoc = 211 or pVidDoc = 510) and boNeedSpecif);
.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510 and boNeedSpecif);
 ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
.}//.{ ?internal; (pVidDoc <> 201 and pVidDoc <> 211 and pVidDoc <> 510 and boNeedSpecif);
.fields
 sAllTotalsHeader
 ReeIt
 strReeItV
.endfields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  &'&&&&&&&&&&&&&&.&&                  &'&&&&&&&&&&&&&&.&& Б
.} //.{ ?internal; boNeedSpecif;
.{ ?internal; NOT boNeedSpecif;
 ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
.fields
 sAllTotalsHeader
 ReeIt
 strReeItV
.endfields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& Б
.} //.{ ?internal; NOT boNeedSpecif;
.end//if
 
.endform
!
!
!
#doc
КНИГА ПОКУПОК/ПРОДАЖ
#end
.linkform 'BDOCRST_Book' prototype is 'BDOCRST'
.p 55
.defo landscape
.group 'КНИГИ'
.NameInList 'КНИГА ПОКУПОК/ПРОДАЖ'
! ----------------------------------------------------------------------
#include vBDReest.frn
! ----------------------------------------------------------------------
.var
       boIsFilter  : Boolean;       //флаг установленных фильтров
       strBookName : string;
       strOrgType1 : string;
       strOrgType2 : string;
       strMargin   : string;
       strMarginLine:string;
!----- итоговые суммы реестра---
       ADocSum, ADocBez20, ADocNDS20, ADocBez10, ADocNDS10,
       ADocBez18, ADocNDS18, ADocNetNDS : double;
!-------------------------------
       strWarning    : string;
       strFiltPaidDoc: string;
       boFiltPaidActive : boolean;
!-------------------------------
.endvar
.begin
!----- инициализация итоговых сумм реестра---
 boFiltPaidActive := (( flgRepStyles and word(8) ) = 8 ) and ( wFiltPaidDoc <> 0 );
 ADocSum    := 0;
 ADocBez20  := 0;
 ADocNDS20  := 0;
 ADocBez18  := 0;
 ADocNDS18  := 0;
 ADocBez10  := 0;
 ADocNDS10  := 0;
 ADocNetNDS := 0;
 strWarning := if( wPrintForm = 1, '***** ВНИМАНИЕ! РЕЕСТР ПОЛУЧЕН, НАЧИНАЯ С ТЕКУЩЕГО УРОВНЯ ДЕРЕВА ***** ДЛЯ ПОЛУЧЕНИЯ ПОЛНОГО РЕЕСТРА ВОСПОЛЬЗУЙТЕСЬ <CTRL>+<P> *****', '');
 if ( pVidDoc >= 101 ) and ( pVidDoc <= 111 )
   strBookName := 'КНИГА ПОКУПОК';
 else
   strBookName := 'КНИГА ПРОДАЖ';
 if boFiltPaidActive
 {
   strFiltPaidDoc := '';
   if ( (wFiltPaidDoc and 1) <> 0 )
     strFiltPaidDoc := 'частично оплаченные ДО';
   if ( (wFiltPaidDoc and 2) <> 0 )
     strFiltPaidDoc := if (strFiltPaidDoc <> '',
                             strFiltPaidDoc + ', ',
                             ''
                          ) + 'полностью оплаченные ДО';
   if ( (wFiltPaidDoc and 4) <> 0 )
     strFiltPaidDoc := if (strFiltPaidDoc <> '',
                             strFiltPaidDoc + ', ',
                             ''
                          )  + 'неоплаченные ДО';
 }
end.
.fields
  CommonFormHeader
  strWarning
.endfields
 ^   ^
.fields
  strBookName
.endfields
 Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.{ ?INTERNAL; ( pVidDoc >= 101 ) and ( pVidDoc <= 111 );
.fields
  MyOrg
  MyINN
.endfields
    Налогоплательщик -  покупатель  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
    Идентификационный номер налогоплательщика - покупателя  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.} //?INTERNAL; ( pVidDoc >= 101 ) and ( pVidDoc <= 111 );
.{ ?INTERNAL; ( pVidDoc >= 201 ) and ( pVidDoc <= 211 );
.fields
  MyOrg
  MyINN
.endfields
    Налогоплательщик - продавец  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
    Идентификационный номер налогоплательщика - продавца  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.} //?INTERNAL; ( pVidDoc >= 201 ) and ( pVidDoc <= 211 );
.{ ?INTERNAL; ((flgFilters and word(4)) = 4);
.fields dBegin dEnd .endfields
    Продажа за период с  Б@@@@@@@@@@@ Б г. по  Б@@@@@@@@@@@ Б г.
.}
!------------------------------------------------------------------------
.begin
 if ( ((flgFilters and  word(1))  =  1)
   OR ((flgFilters and  word(2))  =  2)
   OR ((flgFilters and  word(8))  =  8)
   OR ((flgFilters and word(16))  = 16)
#ifdef __CentrOtv__
   OR ((flgFilters and word(64))  = 64)
#end
   OR ((flgFilters and word(128))  = 128)
    ) boIsFilter := True
 else boIsFilter := False;
end.
.{ ?INTERNAL; ( ( boIsFilter ) or (((flgRepStyles and word(8) ) = 8) and ( wFiltPaidDoc <> 0 )) );
    Используются фильтры:
.{ ?INTERNAL; ((flgFilters and word(1) ) = 1);
.Fields Currency .EndFields
     Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(2) ) = 2);
.Fields KontrAgent .EndFields
     Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(8) ) = 8);
.Fields Descr .EndFields
    по дескриптору -  Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(16) ) = 16);
.Fields GrDescr .EndFields
    по группе дескрипторов -  Б^ Б
.}
#ifdef __CentrOtv__
.{ ?INTERNAL; ((flgFilters and word(64) ) = 64);
.Fields OtvPodr .EndFields
     Б^ Б
.}
#end
.{ ?INTERNAL; ((flgFilters and word(128) ) = 128);
.Fields
 GroupDO
.EndFields
     Б^ Б
.}
.{ ?INTERNAL; (boFiltPaidActive);
.Fields strFiltPaidDoc .EndFields
    по состоянию оплаченности -  Б^ Б
.} // ?INTERNAL;
.} // ?INTERNAL;
.{ ?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
   ┌──────────────────┬───────────────────┬─────────┬──────────┬────────────────┬──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
   │ Дата и номер     │ Наименование      │Идентифи-│Дата      │   Всего продаж,│                                                       В том числе                                                            │
   │ документа-       │ покупателя        │кацион-  │оплаты    │   включая НДС  │                                                                                                                              │
   │ основания        │                   │ный      │документа-│                ├───────────────────────────────────────────────────────────────────────────────────────────────┬──────────────────────────────┤
   │                  │                   │номер    │основания │                │                         продажи, облагаемые налогом                                           │        продажи, не           │
   │                  │                   │покупа-  │          │                │                                 по ставке                                                     │      облагаемые налогом      │
   │                  │                   │теля     │          │                ├───────────────────────────────┬───────────────────────────────┬───────────────────────────────┼───────────────┬──────────────┤
   │                  │                   │         │          │                │        18 процентов           │          10 процентов         │          20 процентов         │     всего     │   из них     │
   │                  │                   │         │          │                │             (5)               │                (6)            │                (7)            │               │   экспорт    │
   │                  │                   │         │          │                ├───────────────┬───────────────┼───────────────┬───────────────┼───────────────┬───────────────┼───────────────┼──────────────┤
   │                  │                   │         │          │                │   стоимость   │     сумма     │   стоимость   │     сумма     │   стоимость   │     сумма     │               │              │
   │                  │                   │         │          │                │    продаж     │      НДС      │    продаж     │      НДС      │    продаж     │      НДС      │               │              │
   │                  │                   │         │          │                │   без НДС     │               │   без НДС     │               │   без НДС     │               │               │              │
   ├──────────────────┼───────────────────┼─────────┼──────────┼────────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼───────────────┼──────────────┤
   │        (1)       │        (2)        │   (3)   │   (3а)   │       (4)      │     (5а)      │     (5б)      │     (6а)      │     (6б)      │     (7а)      │     (7б)      │      (8)      │     (8а)     │
   └──────────────────┴───────────────────┴─────────┴──────────┴────────────────┴───────────────┴───────────────┴───────────────┴───────────────┴───────────────┴───────────────┴───────────────┴──────────────┘
.}
.{ ?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));
   ┌──────────────────┬──────────┬──────────┬──────────┬───────────────────┬─────────┬────────────────┬──────────────────────────────────────────────────────────────────────────────────────────────────────────┐
   │ Дата и номер     │Дата      │Дата      │Дата      │ Наименование      │Идентифи-│ Всего покупок, │                                               В том числе                                                │
   │ документа-       │поступле- │оплаты    │оприходо- │ поставщика        │кацион-  │  включая НДС   │                                                                                                          │
   │ основания        │ления     │документа-│вания     │                   │ный номер│                ├─────────────────────────────────────────────────────────────────────────────────────────┬────────────────┤
   │                  │документа-│основания │накладной │                   │поставщи-│                │                                 покупки, облагаемые налогом                             │покупки, не об- │
   │                  │основания │          │          │                   │ка       │                │                                         по ставке                                       │лагаемые налогом│
   │                  │поставщика│          │          │                   │         │                ├─────────────────────────────┬─────────────────────────────┬─────────────────────────────┼────────────────┤
   │                  │          │          │          │                   │         │                │         18 процентов        │        10 процентов         │        20 процентов         │     всего      │
   │                  │          │          │          │                   │         │                │             (7)             │             (8)             │             (9)             │                │
   │                  │          │          │          │                   │         │                ├──────────────┬──────────────┼──────────────┬──────────────┼──────────────┬──────────────┼────────────────┤
   │                  │          │          │          │                   │         │                │   стоимость  │    сумма     │   стоимость  │     сумма    │   стоимость  │     сумма    │                │
   │                  │          │          │          │                   │         │                │    покупок   │     НДС      │    покупок   │      НДС     │    покупок   │      НДС     │                │
   │                  │          │          │          │                   │         │                │    без НДС   │              │    без НДС   │              │    без НДС   │              │                │
   ├──────────────────┼──────────┼──────────┼──────────┼───────────────────┼─────────┼────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────────┤
   │        (1)       │   (2)    │    (3)   │   (3а)   │        (4)        │   (5)   │      (6)       │      (7а)    │     (7б)     │     (8а)     │     (8б)     │     (9а)     │     (9б)     │      (10)      │
   └──────────────────┴──────────┴──────────┴──────────┴───────────────────┴─────────┴────────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴────────────────┘
.}
.{
.[H SKIP
.fields CommonFormHeader strBookName .endfields
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Лист N @Np@
.{ ?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
   ┌──────────────────┬───────────────────┬─────────┬──────────┬────────────────┬───────────────┬───────────────┬───────────────┬───────────────┬───────────────┬───────────────┬───────────────┬──────────────┐
   │        (1)       │        (2)        │   (3)   │   (3а)   │       (4)      │     (5а)      │     (5б)      │     (6а)      │     (6б)      │     (7а)      │     (7б)      │      (8)      │     (8а)     │
   └──────────────────┴───────────────────┴─────────┴──────────┴────────────────┴───────────────┴───────────────┴───────────────┴───────────────┴───────────────┴───────────────┴───────────────┴──────────────┘
.} //?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
.{ ?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));
   ┌──────────────────┬──────────┬──────────┬──────────┬───────────────────┬─────────┬────────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬────────────────┐
   │        (1)       │   (2)    │    (3)   │   (3а)   │        (4)        │   (5)   │      (6)       │      (7а)    │     (7б)     │     (8а)     │     (8б)     │     (9а)     │     (9б)     │      (10)      │
   └──────────────────┴──────────┴──────────┴──────────┴───────────────────┴─────────┴────────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴────────────────┘
.} //?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));
.]H
.{ CheckEnter GroupHeader; ((flgRepStyles and word(4)) = 4)
.Fields GroupHeaderName:'T:-' .EndFields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}
.{ table 'vBaseDocRee.BaseDoc'
.{ ?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
.fields
     BaseDoc.dDoc
     BaseDoc.NoDoc
     KatOrg.Name
     KatOrg.Unn
     BaseFin.dDoc

     DocSum
     DocBez18
     DocNDS18
     DocBez10
     DocNDS10
     DocBez20
     DocNDS20
     DocNetNDS
.endfields
    @@@@@@@@@@@ @@@@@@ @@@@@@@@@@@@@@@@@@@ @@@@@@@@@ @@@@@@@@@@ &'&&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&&
.}
.{ ?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));
.fields
  BaseDoc.dDoc
  BaseDoc.NoDoc
  BaseDoc.dDoc
  BaseFin.dDoc
  KatSopr.dOpr
  KatOrg.Name
  KatOrg.Unn

  DocSum
  DocBez18
  DocNDS18
  DocBez10
  DocNDS10
  DocBez20
  DocNDS20
  DocNetNDS
.endfields
    @@@@@@@@@@@ @@@@@@ @@@@@@@@@@ @@@@@@@@@@ @@@@@@@@@@ @@@@@@@@@@@@@@@@@@@ @@@@@@@@@ &'&&&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&&&.&&
.}
.if PrnBDocSpec
.end //if
.begin
!----------------- суммирование ---------------------------
  ADocSum    := ADocSum    + DocSum;
  ADocBez20  := ADocBez20  + DocBez20;
  ADocNDS20  := ADocNDS20  + DocNDS20;
  ADocBez18  := ADocBez18  + DocBez18;
  ADocNDS18  := ADocNDS18  + DocNDS18;
  ADocBez10  := ADocBez10  + DocBez10;
  ADocNDS10  := ADocNDS10  + DocNDS10;
  ADocNetNDS := ADocNetNDS + DocNetNDS;
end.
.} //table
.{ CheckEnter GroupTotal; ((flgRepStyles and word(4)) = 4);
.fields
        GroupTotalName:'T:-'
.endfields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.{ ?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
.fields
        GroupDocSum
        GroupDocBez18
        GroupDocNDS18
        GroupDocBez10
        GroupDocNDS10
        GroupDocBez20
        GroupDocNDS20
        GroupDocNetNDS
.endfields
 Б                                                                &'&&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& Б
.} //?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
.{ ?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));
.fields
        GroupDocSum
        GroupDocBez18
        GroupDocNDS18
        GroupDocBez10
        GroupDocNDS10
        GroupDocBez20
        GroupDocNDS20
        GroupDocNetNDS
.endfields
 Б                                                                                      &'&&&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&&&.&& Б
.} //?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));
.} //CheckEnter GroupTotal;
.}
.if PrintAllSums
.{ ?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
.fields
   sAllTotalsHeader
   ADocSum
   ADocBez18
   ADocNDS18
   ADocBez10
   ADocNDS10
   ADocBez20
   ADocNDS20
   ADocNetNDS
.endfields
  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  &'&&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& &'&&&&&&&&&&.&& Б
.} //?INTERNAL; ((pVidDoc >= 201) and (pVidDoc <= 211));
.{ ?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));
.fields
   sAllTotalsHeader
   ADocSum
   ADocBez18
   ADocNDS18
   ADocBez10
   ADocNDS10
   ADocBez20
   ADocNDS20
   ADocNetNDS
.endfields
  ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                        &'&&&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&.&& &'&&&&&&&&&&&.&& Б
.} //?INTERNAL; ((pVidDoc >= 101) and (pVidDoc <= 111));

                                                     Б Главный бухгалтер Б 
.end //if
.endform
!
!
!
#doc
ИТОГОВЫЙ РЕЕСТР
#end
.linkform 'BDOCRST_Reestr07' prototype is 'BDOCRST'
.group 'ИТОГОВЫЙ РЕЕСТР'
.p 55
.defo landscape
.NameInList 'ИТОГОВЫЙ РЕЕСТР ДОКУМЕНТОВ-ОСНОВАНИЙ'
! ----------------------------------------------------------------------
#include vBDReest.frn
! ----------------------------------------------------------------------
.var
    strReeItV     : string;
    strGroupSumV  : string;
!----- итоговые суммы реестра---
    ReeIt, ReeItV : double;
    strWarning    : string;
    strRekvKontr  : string;
    i             : word;
.endvar
.begin
!----- инициализация итоговых сумм реестра---
 ReeIt  := 0;
 ReeItV := 0;
 i := 0; //счетчик кол-ва строк в форме
end.
.fields
 CommonFormHeader
.endfields
 ^
.fields
 strReestrName
.endfields
 Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.{ ?INTERNAL; ((flgFilters and word(32)) = 32);
.Fields Sost .EndFields
       Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}
.{ ?INTERNAL; ((flgFilters and word(4)) = 4);
.Fields dBegin dEnd .EndFields
      за период с  Б^ Б  по   Б^ Б
.}
.{ ?INTERNAL; ( (flgFilters and word(27)) > 0 );
      Используются фильтры:
.{ ?INTERNAL; ((flgFilters and word(1) ) = 1);
.Fields Currency .EndFields
       Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(2) ) = 2);
.Fields KontrAgent .EndFields
       Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(8) ) = 8);
.Fields Descr .EndFields
      по дескриптору -  Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(16) ) = 16);
.Fields GrDescr .EndFields
      по группе дескрипторов -  Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(128) ) = 128);
.Fields
 GroupDO
.EndFields
     Б^ Б
.}
.} // ?INTERNAL; ( (flgFilters and word(11)) > 0 );
.fields ValNDE ValTar .endfields
 ────────────────────────────────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────┬──────────
                                                                                                         │                 Итого                 │    В %
                                 Наименование уровня группировки                                         ├───────────────────┬───────────────────┤ к общему
                                                                                                         │     в @@@@@@      │    в @~@@@@@@@@   │   итогу
 ────────────────────────────────────────────────────────────────────────────────────────────────────────┴───────────────────┴───────────────────┴──────────
.{ //MAIN CYCLE ON BASEDOC's
.[h SKIP

.fields CommonFormHeader strReestrName .endfields
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Лист N @Np@

.]h //HEADER end
.{ CheckEnter GroupHeader; ((flgRepStyles and word(4)) = 4);
.Fields                              GroupHeaderName:'T:-'                                                  GroupSum2            GroupSumV2    GroupPercentNDE .EndFields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&&  &&&.&& Б
.{ ?INTERNAL; ( i = 0 );
  ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
.} //
.begin
  i := i + 1;
end.
.}//CheckEnter GroupHeader; ((flgRepStyles and word(4)) = 4);
.if PrnBDocSpec
!.{ table 'vBaseDocRee.SpStep'
!.} //table SpStep
.end //if
.{ CheckEnter GroupTotal; ((flgRepStyles and 4) = 4);
.} //CheckEnter GroupTotal; ((flgRepStyles and 4) = 4);
.} //MAIN CYCLE ON BASEDOC's
.if PrintAllSums
.end //if
 
.endform
!
!
!
#doc
РЕЕСТР ОПЛАЧЕННОСТИ ДО
#end
.linkform 'BDOCRST_Reestr04' prototype is 'BDOCRST'
!реестры по оплаченности ДО
.group 'РЕЕСТР ОПЛАЧЕННОСТИ ДО'
.p 55
.defo landscape
.NameInList 'РЕЕСТР ОПЛАЧЕННОСТИ ДОКУМЕНТОВ-ОСНОВАНИЙ'
! ----------------------------------------------------------------------
#include vBDReest.frn
! ----------------------------------------------------------------------
.var
    strReeItV     : string;
    strGroupSumV  : string;
!----- итоговые суммы реестра---
    ReeIt, ReeItV : double;
    dblDocPaidIt  : double;
!-------------------------------
    strWarning    : string;
    strRekvKontr  : string;
    strFiltPaidDoc: string;
    boFiltPaidActive : boolean;
    boNeedSpecif,                    //shaf
    boCalcInValOtch  : boolean;
.endvar
.begin
 boNeedSpecif := ((flgRepStyles and 1 ) <> 0);     //shaf
 boCalcInValOtch := ((flgRepStyles and 2) <> 0);
!----- инициализация итоговых сумм реестра---
 ReeIt     := 0;
 ReeItV    := 0;
 dblDocPaidIt := 0;
!--------------------------------------------
 strWarning := if( wPrintForm = 1, '***** ВНИМАНИЕ! РЕЕСТР ПОЛУЧЕН, НАЧИНАЯ С ТЕКУЩЕГО УРОВНЯ ДЕРЕВА ***** ДЛЯ ПОЛУЧЕНИЯ ПОЛНОГО РЕЕСТРА ВОСПОЛЬЗУЙТЕСЬ <CTRL>+<P> *****', '');
 boFiltPaidActive := ( ( flgRepStyles and word(8) ) = 8 ) and ( wFiltPaidDoc <> 0 );
 if boFiltPaidActive
 {
   strFiltPaidDoc := '';
   if ( (wFiltPaidDoc and 1) <> 0 )
     strFiltPaidDoc := 'частично оплаченные ДО';
   if ( (wFiltPaidDoc and 2) <> 0 )
     strFiltPaidDoc := if (strFiltPaidDoc <> '',
                             strFiltPaidDoc + ', ',
                             ''
                          ) + 'полностью оплаченные ДО';
   if ( (wFiltPaidDoc and 4) <> 0 )
     strFiltPaidDoc := if (strFiltPaidDoc <> '',
                             strFiltPaidDoc + ', ',
                             ''
                          )  + 'неоплаченные ДО';
 }
end.
.fields
 CommonFormHeader strWarning
.endfields
 ^   ^
.fields
 strReestrName
.endfields
 Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.{ ?INTERNAL; ((flgFilters and word(32)) = 32);
.Fields Sost .EndFields
       Б@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}
.{ ?INTERNAL; ((flgFilters and word(4)) = 4);
.Fields dBegin dEnd .EndFields
      за период с  Б^ Б  по   Б^ Б
.}
.{ ?INTERNAL; ( ( (flgFilters and word(27)) > 0 ) or (((flgRepStyles and word(8) ) = 8) and ( wFiltPaidDoc <> 0 )) );
      Используются фильтры:
.{ ?INTERNAL; ((flgFilters and word(1) ) = 1);
.Fields Currency .EndFields
       Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(2) ) = 2);
.Fields KontrAgent .EndFields
       Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(8) ) = 8);
.Fields Descr .EndFields
      по дескриптору -  Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(16) ) = 16);
.Fields GrDescr .EndFields
      по группе дескрипторов -  Б^ Б
.}
.{ ?INTERNAL; ((flgFilters and word(128) ) = 128);
.Fields
 GroupDO
.EndFields
       Б^ Б
.}
.{ ?INTERNAL; (boFiltPaidActive);
.Fields strFiltPaidDoc .EndFields
      по состоянию оплаченности -  Б^ Б
.} // ?INTERNAL;
.} // ?INTERNAL; ( (flgFilters and word(11)) > 0 );
.{ ?internal; boCalcInValOtch;
.fields
  ValNDE
  ValTar
  ValNDE
.endfields
 ───────────────────────┬──────────────────────────────────┬─────────┬───────────┬───────────────────────────────────────┬───────────────────
      Дата и номер      │                                  │  Срок   │ Необходимо│                 Итого                 │     Cумма оплат
       документа-       │            Контрагент            │действия,│оплатить до│───────────────────┬───────────────────│    по данному ДО
       основания        │                                  │  дней   │           │     в @@@@@@      │     в @~@@@@@@@   │     в @@@@@@@@
 ───────────────────────┴──────────────────────────────────┴─────────┴───────────┴───────────────────┴───────────────────┴───────────────────
.} //.{ ?internal; boCalcInValOtch;
.{ ?internal; (not boCalcInValOtch);
.fields
  ValNDE
  ValTar
  ValNDE
.endfields
 ───────────────────────┬──────────────────────────────────┬─────────┬───────────┬───────────────────────────────────────┬───────────────────┬─────────────
      Дата и номер      │                                  │  Срок   │ Необходимо│                 Итого                 │     Cумма оплат   │
       документа-       │            Контрагент            │действия,│оплатить до│───────────────────┬───────────────────│    по данному ДО  │   Валюта ДО
       основания        │                                  │  дней   │           │     в @@@@@@      │     в @~@@@@@@@   │     в @@@@@@@@@   │
 ───────────────────────┴──────────────────────────────────┴─────────┴───────────┴───────────────────┴───────────────────┴───────────────────┴─────────────
.} //.{ ?internal; (not boCalcInValOtch);
.{ //MAIN CYCLE ON BASEDOC's
.[h SKIP
.{ ?internal; boCalcInValOtch;
.fields
 CommonFormHeader
 strReestrName
.endfields

 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Лист N @Np@

.} //.{ ?internal; boCalcInValOtch;
.{ ?internal; (not boCalcInValOtch);
.fields
 CommonFormHeader
 strReestrName
.endfields

 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Лист N @Np@

.} //.{ ?internal; (not boCalcInValOtch);
.]h //HEADER end
.{ CheckEnter GroupHeader; ((flgRepStyles and word(4)) = 4);
.Fields
 GroupHeaderName:'T:-'
.EndFields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б
.}//CheckEnter GroupHeader; ((flgRepStyles and word(4)) = 4);
.{ table 'vBaseDocRee.BaseDoc'
.begin
!----------------- суммирование ---------------------------
   ReeIt     := ReeIt  + DocIt;
   ReeItV    := ReeItV + DocItV;
   dblDocPaidIt := dblDocPaidIt + DocPaidNDE;
   strRekvKontr := KatOrg.Name + if( Trim( KatOrg.Tel ) <> '', ', т/ф. ' + KatOrg.Tel, '' )
!   strDocItV := if( boCalcInValOtch, DoubleToStr( DocItV, '\2p[|-]36`666`666`666`666`666.88' ),'' );
end.
.{ ?internal; boCalcInValOtch;
.fields
  BaseDoc.dDoc
  PrintNumber( vBaseDocRee.BaseDoc.Descr, vBaseDocRee.BaseDoc.nodoc )
  strRekvKontr
  BaseDoc.Koldn
  StepDoc.dOplMax
  DocIt
  DocItV
  DocPaidNDE
.endfields
 @@@@@@@@@@ @@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ @~@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&&
.} //.{ ?internal; boCalcInValOtch;
.{ ?internal; not boCalcInValOtch;
.fields
  BaseDoc.dDoc
  PrintNumber( vBaseDocRee.BaseDoc.Descr, vBaseDocRee.BaseDoc.nodoc )
  strRekvKontr
  BaseDoc.Koldn
  StepDoc.dOplMax
  DocIt
  DocItV
  DocPaidNDE
  CurrencyDO
 .endfields
 @@@@@@@@@@ @@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ @~@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& @~@@@@@@@@@@@
.} //.{ ?internal; not boCalcInValOtch;
.{ ?internal; boNeedSpecif;
.fields
  ValNDE
  ValTar
.endfields
  ┌─────────────────────────┬──────────────┬──────┬──────────────┬────────────────────────────────────┬────────────────────────────────────┐
  │      Наименование       │Номенклатурный│ Ед.  │  Количество  │            В @@@@@@                │             В @~@@@@@@@@           │
  │     товара/услуги       │    номер     │ изм. │              ├────────────────┬───────────────────┼────────────────┬───────────────────┤
  │                         │              │      │              │      Цена      │   Стоимость       │      Цена      │   Стоимость       │
  ├─────────────────────────┴──────────────┴──────┴──────────────┴────────────────┴───────────────────┴────────────────┴───────────────────┤
.} //?internal; boNeedSpecif;
.if PrnBDocSpec
.{ table 'vBaseDocRee.SpStep'
.begin
#include vBDProc.frn
end.
.fields
!   NameMC
    if( SpStep.PrMC = 1, KatMC.Name, KatUsl.Name )
!   Nomenkl
    if( SpStep.PrMC = 1, KatMC.BarKod, KatUsl.Kod )
!   Ed
    KatOtpEd.Abbr
!   Kol
    SpStep.Kol
!   Price
    dblPriceNDE
!   Summa
    dblSumNDE
!   VPrice
    dblPriceVal
!   VSumma
    dblSumVal
.endfields
  │@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@ @~@@@@ &'&&&&&&&&.&&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&&│
#ifdef GAL6_0
.{ table 'vBaseDocRee.SpDopEd'
.fields
  vBaseDocRee.KatDopEd.ShortName
  vBaseDocRee.SpDopEd.Kol
.endfields
                                                             @~@@@@ &'&&&&&&&&.&&&
! ---------------------------------------------------------------------
#include VBDMZPrn.frn
! ---------------------------------------------------------------------
.} //.table 'vBaseDocRee.SpDopEd'
#end //GAL6_0
.} //table
.end //if
.} //table
.{ ?internal; boNeedSpecif;
  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

.} //.{ ?internal; boNeedSpecif;
.{ CheckEnter GroupTotal; ((flgRepStyles and 4) <> 0);
.begin
  strGroupSumV := if( boCalcInValOtch, DoubleToStr( GroupSumV, '\2p[|-]36`666`666`666`666`666.88' ),'');
end.
.fields
  GroupTotalName:'T:-'
  GroupSum
  strGroupSumV
  GroupDocPaidNDE
.endfields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& Б
.} //CheckEnter GroupTotal; ((flgRepStyles and 4) = 4);
.} //MAIN CYCLE ON BASEDOC's
.begin
  strReeItV := if( boCalcInValOtch, DoubleToStr( ReeItV, '\2p[|-]36`666`666`666`666`666.88' ),'');
end.
.if PrintAllSums
.{?internal; (boCalcInValOtch);
 ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
.} //.{ ?internal; (boCalcInValOtch);
.{?internal; (not boCalcInValOtch);
 ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
.} //.{ ?internal; (not boCalcInValOtch);
.fields
  sAllTotalsHeader
  ReeIt
  strReeItV
  dblDocPaidIt
.endfields
 Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&.&& Б
.end //if
 
.endform
