/*
 ╔═══════════════════════════════════════════════════════════════════════════╗
 ║                     (c) 1994,97 корпорация ГАЛАКТИКА                      ║
 ║ Проект        : ГАЛАКТИКА                                                 ║
 ║ Система       : Оперативный контур                                        ║
 ║ Версия        : 5.70                                                      ║
 ║ Назначение    : Функциии регистрации наряд-заказа в SoprHoz               ║
 ║               : на отдельной логической таблице                           ║
 ║ Ответственный : Сидоров Владимир Геннадьевич (Volod)                      ║
 ║ Параметры     :                                                           ║
 ╚═══════════════════════════════════════════════════════════════════════════╝
*/

create view loSoprHoz
var
  wTip  : word;
  pRec  : comp;
from
  SoprHoz (Normal)
where
((
  pRec  ==  SoprHoz.cSoprDoc and
  wTip  ==  SoprHoz.TipDoc
))
;

//-- Регистрация НЗ в SoprHoz
function InsDocInSoprHoz(pNRec:comp;pDog:comp;pAppDog:comp;
                        wTipDoc:word;dDat:date;sNoDoc:string;
                        sDescr:string;sDesGr:string
                       ):word;
var ret : word;
{

  loSoprHoz.ClearBuffer(loSoprHoz.tnSoprHoz);
!  if (pAppDog = 0)
    set loSoprHoz.SoprHoz.cDogovor := pDog
!  else
    set loSoprHoz.SoprHoz.cAppDogovor := pAppDog;
  set loSoprHoz.SoprHoz.DatOb      := dDat;
  set loSoprHoz.SoprHoz.cSoprDoc   := pNRec;
  set loSoprHoz.SoprHoz.TipDoc     := wTipDoc;
  set loSoprHoz.SoprHoz.TiDkGal    := loSoprHoz.SoprHoz.TipDoc;
  set loSoprHoz.SoprHoz.NoDoc      := sNoDoc;
  set loSoprHoz.SoprHoz.Descr      := sDescr;
  set loSoprHoz.SoprHoz.DesGr      := sDesGr;
  ret := loSoprHoz.insert current SoprHoz;
  InsDocInSoprHoz := ret;
}

//-- модификация информации о наряд-заказе из SoprHoz
function MdfDocInSoprHoz(pNRec:comp;pDog:comp;pAppDog:comp;
                         wTipDoc:word;dDat:date;sNoDoc:string;
                         sDescr:string;sDesGr:string
                        ):word;
var ret : word;
{
  ret := 0;
  MdfDocinSoprHoz := ret;
  loSoprHoz.pRec := pNRec;
  loSoprHoz.wTip := wTipDoc;
  ret := loSoprHoz.GetFirst SoprHoz where
                               ((wTipDoc == SoprHoz.TipDoc and
                                 pNRec == SoprHoz.cSoprDoc
                               ));
  if (ret<>tsOk)
    loSoprHoz.ClearBuffer(loSoprHoz.tnSoprHoz);

  set loSoprHoz.SoprHoz.cDogovor := pDog
  set loSoprHoz.SoprHoz.cAppDogovor := pAppDog;
  set loSoprHoz.SoprHoz.DatOb      := dDat;
  set loSoprHoz.SoprHoz.cSoprDoc   := pNRec;
  set loSoprHoz.SoprHoz.TipDoc     := wTipDoc;
  set loSoprHoz.SoprHoz.TiDkGal    := loSoprHoz.SoprHoz.TipDoc;
  set loSoprHoz.SoprHoz.NoDoc      := sNoDoc;
  set loSoprHoz.SoprHoz.Descr      := sDescr;
  set loSoprHoz.SoprHoz.DesGr      := sDesGr;
  if (ret<>tsOk)
    ret := loSoprHoz.insert current SoprHoz
  else
    ret := loSoprHoz.update current SoprHoz;
}
//-- Удаление информации о наряд-заказе из SoprHoz
function DelDocInSoprHoz(wTipDoc:word;pNZRec:comp):word;
var ret:word;
{
  DelDocinSoprHoz := 0;
  loSoprHoz.pRec := pNZRec;
  loSoprHoz.wTip := wTipDoc;
  ret := loSoprHoz.GetFirst SoprHoz where
                               ((wTipDoc == SoprHoz.TipDoc and
                                 pNZRec == SoprHoz.cSoprDoc
                               ));
  if (ret = tsOk)
   {
    ret := loSoprHoz.delete current SoprHoz;
    DelDocinSoprHoz := ret;
   }
}

