/*
 ╔═══════════════════════════════════════════════════════════════════════════╗
 ║                     (c) 1994,98 корпорация ГАЛАКТИКА                      ║
 ║ Проект        : Галактика                                                 ║
 ║ Версия        : 5.70                                                      ║
 ║ Назначение    : Печать наряд-заказов                                      ║
 ║ Ответственный : Сидоров В.Г.                                              ║
 ║ Параметры     :                                                           ║
 ╚═══════════════════════════════════════════════════════════════════════════╝
*/

procedure PrintDocument;
{
  ReadMyDsk(VidReport,'VidReport_nzakaz',False);

  if (VidReport = 0)
  {
  //--Назначение
    frmNZakaz.Write(KatNazna.NRec);
    frmNZakaz.Write(KatNazna.Name);
  //-- Контрагент
    frmNZakaz.Write(KatOrg.Name);
    frmNZakaz.Write(KatOrg.UNN);
    frmNZakaz.Write(KatOrg.OKPO);
    frmNZakaz.Write(KatOrg.Addr);
    frmNZakaz.Write(KatOrg.Tel);
  //-- Контрагент 2
    frmNZakaz.Write(Contr2.Name);
    frmNZakaz.Write(Contr2.UNN);
    frmNZakaz.Write(Contr2.OKPO);
    frmNZakaz.Write(Contr2.Addr);
    frmNZakaz.Write(Contr2.Tel);
  //-- Заявитель
    frmNZakaz.Write(Contributor.Name);
    frmNZakaz.Write(Contributor.UNN);
    frmNZakaz.Write(Contributor.OKPO);
    frmNZakaz.Write(Contributor.Addr);
    frmNZakaz.Write(Contributor.Tel);
  //-- Договор
    frmNZakaz.Write(Dogovor.NRec);
    frmNZakaz.Write(Dogovor.NoDoc);
    frmNZakaz.Write(DateToStr(Dogovor.dDoc,'DD/MM/YYYY'));
    frmNZakaz.Write(DateToStr(Dogovor.dBeg,'DD/MM/YYYY'));
    frmNZakaz.Write(DateToStr(Dogovor.dEnd,'DD/MM/YYYY'));
    frmNZakaz.Write(Dogovor.VidDog);
    frmNZakaz.Write(Dogovor.Status);
  //-- Приложение к договору
    frmNZakaz.Write(AppDogovor.NRec);
    frmNZakaz.Write(AppDogovor.NoDoc);
    frmNZakaz.Write(DateToStr(AppDogovor.dDoc,'DD/MM/YYYY'));
    frmNZakaz.Write(DateToStr(AppDogovor.dBeg,'DD/MM/YYYY'));
    frmNZakaz.Write(DateToStr(AppDogovor.dEnd,'DD/MM/YYYY'));
    frmNZakaz.Write(AppDogovor.VidDog);
    frmNZakaz.Write(AppDogovor.Status);
    //-- Календарный план
    frmNZakaz.Write(CalPlan.NRec);
  //-- Наряд-заказ
    frmNZakaz.Write(NZakaz.NRec);
    frmNZakaz.Write(NZakaz.DesGr);
    frmNZakaz.Write(NZakaz.Descr);
    frmNZakaz.Write(NZakaz.NoDoc);
    frmNZakaz.Write(DateToStr(NZakaz.dDoc,'DD/MM/YYYY'));
    frmNZakaz.Write(DateToStr(NZakaz.dBeg,'DD/MM/YYYY'));
    frmNZakaz.Write(DateToStr(NZakaz.dEnd,'DD/MM/YYYY'));
    frmNZakaz.Write(NZakaz.Status);
    frmNZakaz.Write(NZakaz.TypeDoc);
    frmNZakaz.Write(NZakaz.Prior);
    frmNZakaz.Write(DateToStr(NZakaz.dInput,'DD/MM/YYYY'));
    frmNZakaz.Write(MyPodr.Name);
    frmNZakaz.Write(NZakaz.Sign_Post);
    frmNZakaz.Write(NZakaz.Sign_Fio);
    frmNZakaz.SkipFormat(1);
    frmNZakaz.Write(NZakaz.Sign_Osn);
    frmNZakaz.SkipFormat(1);
    frmNZakaz.Write(NZakaz.Otv_Post);
    frmNZakaz.Write(NZakaz.Otv_Fio);
    //-- Грузоотправитель
    frmNZakaz.Write(GrOtp.Name);
    frmNZakaz.Write(GrOtpState.Name);
    frmNZakaz.Write(GrOtpCity.Name);
    frmNZakaz.Write(GrOtp.Addr);
    frmNZakaz.Write(GrOtp.Tel);
//      frmNZakaz.Write(GrOtpPunkt.Kod);
    frmNZakaz.SkipFormat(1);
    frmNZakaz.Write(GrOtpPunkt.Name);
    //-- Грузополучатель
    frmNZakaz.Write(GrPol.Name);
    frmNZakaz.Write(GrPolState.Name);
    frmNZakaz.Write(GrPolCity.Name);
    frmNZakaz.Write(GrPol.Addr);
    frmNZakaz.Write(GrPol.Tel);
//      frmNZakaz.Write(GrPolPunkt.Kod);
    frmNZakaz.SkipFormat(1);
    frmNZakaz.Write(GrPolPunkt.Name);
    //-- способ отгрузки и т.п.
    frmNZakaz.Write(Shipment.Name);
    frmNZakaz.Write(TipOtg.Name);
    frmNZakaz.Write(WayMove.Name);
    frmNZakaz.Write(NZakaz.AddTerms);
    frmNZakaz.Write(DocInfo.TextData);
  }
//-- просмотр спецификации наряд-закузки и т.п.

  PushPos(#SpDocs);             
  _loop SpDocs where((NZakaz.NRec ==SpDocs.cDoc and
                      word(440)   ==SpDocs.TiDk
                    ))          
    {                           
      if (VidReport = 0)
      {
        frmNZakaz.Write(SpDocs.Code); // номер по порядку
//          frmNZakaz.Write(GrPol.Name);  // имя грузополучателя
        frmNZakaz.Write(SpDocs.PrMC);
      }
      else
      {
        ClearBuffer(#FrNZakaz); 
        FRNZakaz.SpDocsCode := SpDocs.Code;
      }
      
      if (SpDocs.PrMC = 1)
      {
//-- Группа МЦ/услуг
        if (VidReport = 0)
        {
          frmNZakaz.Write(GroupMC.KOD);
          frmNZakaz.Write(GroupMC.Name);
//-- МЦ/услуга
          frmNZakaz.Write(KatMc.BarKod);
          frmNZakaz.Write(KatMc.Name);
        }
        else
        {
          FRNZakaz.KatMcBarKod := KatMc.BarKod;
          FRNZakaz.KatMcName   := KatMc.Name;  
        }
      }
      else
      {
//-- Группа МЦ/услуг
        if (VidReport = 0)
        {
          frmNZakaz.Write(GroupUsl.KOD);
          frmNZakaz.Write(GroupUsl.Name);
//-- МЦ/услуга
          frmNZakaz.Write(KatUSL.Kod);
          frmNZakaz.Write(KatUSL.Name);
        }
        else
        {
          FRNZakaz.KatMcBarKod := KatUSL.Kod;    
          FRNZakaz.KatMcName   := KatUSL.Name;   
        }
      }

      if (VidReport = 0)
      {
        frmNZakaz.Write(KatOtpEd.bKod);
        frmNZakaz.Write(KatOtpEd.Name);
        frmNZakaz.Write(SpDocs.Kol);

        frmNZakaz.Write(ResOtgr.Name);     // ресурс отгрузки
        frmNZakaz.Write(SpShipment.Name);  // способ отгрузки
        frmNZakaz.Write(SpTipOtg.Name);    // базис отгрузки
        frmNZakaz.Write(SpWayMove.Name);   // способ транспортировки
      }
      else
      {
        FRNZakaz.KatOtpEdName   := KatOtpEd.Name;  
        FRNZakaz.SpDocsKol      := SpDocs.Kol;     
      }

      if (VidReport = 1)
        insert current FrNZakaz; 
    }
  
  PopPos(#SpDocs);

  if (VidReport = 0)
  {
    frmNZakaz.PutEvent(feBreak);

    if (not frmNZakaz.Error)
      frmNZakaz.ShowFile('')
    else
      frmNZakaz.AbortForm;
  }

// #ifdef ATL51
  if (VidReport = 1)  
  {
    RunFReport(NZakaz,'',false);
    ResetBounds(#FrNZakaz);
    Delete ALL FrNZakaz;
    SetBounds(#FrNZakaz);
  }
 // #end

  SaveMyDsk(0,'VidReport');
}
