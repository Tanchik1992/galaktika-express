/*
 ╔════════════════════════════════════════════════════════════════════════════╗
 ║                     (c) Корпорация ГАЛАКТИКА, 2002                         ║
 ║ Проект        : ГАЛАКТИКА                                                  ║
 ║ Система       : Оперативный контур                                         ║
 ║ Версия        : 5.8x                                                       ║
 ║ Назначение    : Печать ДО с иерархическим представлением спецификации      ║
 ║ Ответственный : Жданович Юрий Геннадьевич (YurGen)                         ║
 ╚════════════════════════════════════════════════════════════════════════════╝
*/

#declare IerSpec_var
.create view loIer from SpStep, KlPrice, GrPrice;
.var
CurGrPrice, CurKlPrice, TekGrPrice, TekKlPrice: comp;
.endvar
#end

#declare IerSpec_fld
.{?INTERNAL; (TekGrPrice <> CurGrPrice);
.Fields
if (CurGrPrice = -1, 'Прайс-листы без группы', loIer.GrPrice.Name)
if (CurKlPrice = 0, 'Без привязки к прайс-листу', loIer.KlPrice.Name)
.EndFields
.}

.{?INTERNAL; (TekGrPrice = CurGrPrice) and (TekKlPrice <> CurKlPrice);
.Fields
if (CurKlPrice = 0, 'Без привязки к прайс-листу', loIer.KlPrice.Name)
.EndFields
.}
#end

#doc
Счет СТАНДАРТНЫЙ - А4 (с иерархическим представлением спецификации)
#end
.linkform 'PRBDOC_1010_Ier' prototype is 'PRBDOC'
.NameInList 'Счет СТАНДАРТНЫЙ - А4 (с иерархическим представлением спецификации)'
.group 'Продажа'
#IerSpec_var
.FIELDS
  mnd nomer ddoc
  post
.ENDFIELDS
.{?Internal;(wCountry<=1)
.fields
  sGetTune('KatOrg.FldView.UNN')
  innpost
.endfields
.}
.FIELDS
  bpost rspost mfobik mpost rspost2 mfobik mpost2 adpost telpost
  pol
.ENDFIELDS
.{?Internal;(wCountry<=1)
.fields
  sGetTune('KatOrg.FldView.UNN')
  innpol
.endfields
.}
.FIELDS
  bpol rspol mfobik mpol rspol2 mfobik mpol2 adpol telpol pname
.endfields

#IerSpec_fld

.FIELDS
  np barkod mc ed kol cena summa
  i1 i2
.ENDFIELDS
.{
 Ш^ Ш
                         БСЧЕТ № Б ^   Бот Б  ^

       БПОСТАВЩИК : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry<=1)
       Б@@@@@@@@@@: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет № Б ^ ^ ^
       БК/С Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


       БПОЛУЧАТЕЛЬ: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry<=1)
       Б@@@@@@@@@@: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет № Б ^ ^ ^
       БК/С Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

        ^
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
.begin
  CurGrPrice := 0;
end.
 Р
       ─────┬────────────────┬──────────────────────────────┬─────────┬────────────┬─────────────────┬───────────────────────
         БNo Б  │  БНоменклатурный Б │                              │  БЕдиница Б │            │                 │
         Бп/п Б │      Бномер Б      │   БНаименование, сорт, размер Б  │ Бизмерения Б│  БКоличество Б │        БЦена Б      │           БСумма Б
       ─────┴────────────────┴──────────────────────────────┴─────────┴────────────┴─────────────────┴─────────────────────── Р
.{
.begin
  loIer.GetFirst fastfirstrow SpStep where (( comp(PosNRec) == SpStep.nRec ));
  if (loIer.GetFirst fastfirstrow KlPrice
               where (( loIer.SpStep.cPriceList == KlPrice.nRec )) = tsOK)
  {
    TekKlPrice := loIer.SpStep.cPriceList;
    if (loIer.GetFirst fastfirstrow GrPrice
                 where (( loIer.KlPrice.cGrPrice == GrPrice.nRec )) = tsOK)
      TekGrPrice := loIer.KlPrice.cGrPrice
    else
      TekGrPrice := -1;
  }
  else
  {
    TekKlPrice := 0;
    TekGrPrice := -1;
  }
end.
.{?INTERNAL; (TekGrPrice <> CurGrPrice) and (CurGrPrice != 0);
 Р       └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
.{?INTERNAL; (TekGrPrice <> CurGrPrice);
.begin
  CurGrPrice := TekGrPrice;
  CurKlPrice := TekKlPrice;
end.
 Р        Е^ Е
       ├─┬─ В^ В
       │ └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
.{?INTERNAL; (TekGrPrice = CurGrPrice) and (TekKlPrice <> CurKlPrice);
.begin
  CurKlPrice := TekKlPrice;
end.
 Р       ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       ├─┬─ В^ В
       │ └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
 Р       │ &&& @@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ &'&&&&&&&&&& &'&&&&&&&&&&&&&&& &'&&&&&&&&&&&&&&&&&&.&& Р
.}
 Р       └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
 Р                                                              Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.{?Internal;(SumSkidPos>0)
.FIELDS SumSkidPos (i2-SumSkidPos) .ENDFIELDS
 Р                                                              ДСумма скидок к позициям                  &'&&&&&&&&&&&&&&&&&&.&& Ф
 Р                                                              ДИтого с учетом скидок к позициям         &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(op1<>'')
.FIELDS  op1 op2 .ENDFIELDS
 Р                                                              Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(d2>0)
.FIELDS (d1 + ' ' + StringNLZR(if(d3=' %',d2,SkRub),0,3) + ' %') if(d3=' %',SkRub,d2) .ENDFIELDS
 Р                                                              Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS  k1 sdoc .ENDFIELDS

 С                                                              ДИТОГО к оплате                           &'&&&&&&&&&&&&&&&&&&.&& Д  И^ Щ
.{?Internal;((n2>0)or(c2>0)or(p2>0))
 Р                                                                в том числе: Р
.}
.{?Internal;(n2>0)
.FIELDS n1 n2 .ENDFIELDS
 Р                                                                      Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(c2>0)
.FIELDS c1 c2 .ENDFIELDS
 Р                                                                      Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(p2>0)
.FIELDS p1 p2 .ENDFIELDS
 Р                                                                      Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS
  k3    // прописью
  k4 k5
  kDay
  TaraVoz
  Director
  Main_Buh
  page_symb
.ENDFIELDS

     БСумма прописью: Б  Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
      ^ ^
     БСчет действителен в течение Б ^  Бдней Б              ^

     БРуководитель          ___________^ Б
     БГл.(старший) бухгалтер___________^ Б
.if Delimiter
 Р----------------------------------------------------------------------------------------------------------------------------- Р
.end
^
.}
.endform
!
!===============================================================================
!
#doc
Счет ВАЛЮТНО-РУБЛЕВЫЙ  - А4 (с иерархическим представлением спецификации)
#end
.linkform 'PRBDOC_1030_Ier' prototype is 'PRBDOC'
.NameInList 'Счет ВАЛЮТНО-РУБЛЕВЫЙ  - А4 (с иерархическим представлением спецификации)'
.group 'Продажа'
#IerSpec_var
.FIELDS
  mnd nomer ddoc
  post bpost rspost mfobik mpost rspost2 mfobik mpost2 adpost telpost
  pol bpol rspol mfobik mpol rspol2 mfobik mpol2 adpol telpol pname
  sdoc srub sdoc srub
.endfields

#IerSpec_fld

.FIELDS
  np barkod mc ed kol cena cenar summa summar
  i1 i2 i2r
.ENDFIELDS
.{
 Ш^ Ш
                         БСЧЕТ № Б ^   Бот Б  ^

       БПОСТАВЩИК : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет № Б ^ ^ ^
       БК/С Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


       БПОЛУЧАТЕЛЬ: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет № Б ^ ^ ^
       БК/С Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

        ^
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
.begin
  CurGrPrice := 0;
end.

 Ш       ────┬────────────────┬──────────────────────────────┬─────────┬────────────┬────────────────────────────────┬───────────────────────────────────────── Ш
 Ш           │                │                              │         │            │                                │ Ш
 Ш         № │ Номенклатурный │                              │ Единица │            │            Цена                │                 Сумма Ш
 Ш        п/п│     номер      │  Наименование, сорт, размер  │измерения│ Количество ├──────────────┬─────────────────┼───────────────────┬───────────────────── Ш
 Ш           │                │                              │         │            │     в @@@@@@ │      в @@@@@@@@ │       в @@@@@@@   │       в @@@@@@@@ Ш
 Ш       ────┴────────────────┴──────────────────────────────┴─────────┴────────────┴──────────────┴─────────────────┴───────────────────┴───────────────────── Ш
.{
.begin
  loIer.GetFirst fastfirstrow SpStep where (( comp(PosNRec) == SpStep.nRec ));
  if (loIer.GetFirst fastfirstrow KlPrice
               where (( loIer.SpStep.cPriceList == KlPrice.nRec )) = tsOK)
  {
    TekKlPrice := loIer.SpStep.cPriceList;
    if (loIer.GetFirst fastfirstrow GrPrice
                 where (( loIer.KlPrice.cGrPrice == GrPrice.nRec )) = tsOK)
      TekGrPrice := loIer.KlPrice.cGrPrice
    else
      TekGrPrice := -1;
  }
  else
  {
    TekKlPrice := 0;
    TekGrPrice := -1;
  }
end.
.{?INTERNAL; (TekGrPrice <> CurGrPrice) and (CurGrPrice != 0);
 Ш       └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Ш
.}
.{?INTERNAL; (TekGrPrice <> CurGrPrice);
.begin
  CurGrPrice := TekGrPrice;
  CurKlPrice := TekKlPrice;
end.
 Ш        Е^ Е
       ├─┬─ В^ В
       │ └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Ш
.}
.{?INTERNAL; (TekGrPrice = CurGrPrice) and (TekKlPrice <> CurKlPrice);
.begin
  CurKlPrice := TekKlPrice;
end.
 Ш       ├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       ├─┬─ В^ В
       │ └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Ш
.}
 Ш       │&&& @@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ &'&&&&&&&&&& &'&&&&&&&&&&&& &'&&&&&&&&&&&&&&& &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ш
.}
 Ш       └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Ш
 Ш       ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Ш
 Ш                                                                               Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
.{?Internal;(SumSkidPos>0)
.FIELDS SumSkidPos SumSkidPosr (i2-SumSkidPos) (i2r-SumSkidPosr) .ENDFIELDS
 Ш                                                                               ДСумма скидок к позициям               &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
 Ш                                                                               ДИтого с учетом скидок к позициям      &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
.}
.{?Internal;(op1<>'')
.FIELDS  op1 op2 op2r .ENDFIELDS
 Ш                                                                               Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
.}
.{?Internal;(d2>0)
.FIELDS (d1 + ' ' + StringNLZR(if(d3=' %',d2,skrub),0,3) + ' %') if(d3=' %',SkRub,d2) SkNde .ENDFIELDS
 Ш                                                                               Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
.}
.FIELDS  k1 k1r .ENDFIELDS

 Ш                                                                               ЕИТОГО к оплате                        &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Э
.{?Internal;((n2>0)or(c2>0)or(p2>0)or(n2r>0)or(c2r>0)or(p2r>0))
 Ш                                                                                в том числе: Ш
.}
.{?Internal;(n2>0)or(n2r>0)
.FIELDS n1 n2 n2r .ENDFIELDS
 Ш                                                                                    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
.}
.{?Internal;(c2>0)or(c2r>0)
.FIELDS c1 c2 c2r .ENDFIELDS
 Ш                                                                                    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
.}
.{?Internal;(p2>0)or(p2r>0)
.FIELDS p1 p2 p2r .ENDFIELDS
 Ш                                                                                    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&.&& &'&&&&&&&&&&&&&&&&.&& Ь
.}
.FIELDS
  k3     // прописью
  k3r    // прописью
  k4 k5
  kDay
  TaraVoz
  Director
  Main_Buh
  page_symb
.ENDFIELDS

        БСумма прописью:  С@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
                        Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р

         ^ ^
        БСчет действителен в течение Б ^  Бдней Б        ^

        БРуководитель          ___________^ Б
        БГл.(старший) бухгалтер___________^ Б
.if Delimiter
 Р---------------------------------------------------------------------------------------------------------------------------- Р
.end
^
.}
.endform
!
!===============================================================================
!
#doc
Счет СТАНДАРТНЫЙ - А4 (с иерархическим представлением спецификации)
#end
.linkform 'PRBDOC_2010_Ier' prototype is 'PRBDOC'
.NameInList 'Счет СТАНДАРТНЫЙ - А4 (с иерархическим представлением спецификации)'
.group 'Закупка'
#IerSpec_var
.FIELDS
  mnd nomer ddoc
  post
.ENDFIELDS
.{?Internal;(wCountry<=1)
.fields
  sGetTune('KatOrg.FldView.UNN')
  innpost
.endfields
.}
.FIELDS
  bpost rspost mfobik mpost adpost telpost
  pol
.ENDFIELDS
.{?Internal;(wCountry<=1)
.fields
  sGetTune('KatOrg.FldView.UNN')
  innpol
.endfields
.}
.FIELDS
  bpol rspol mfobik mpol adpol telpol pname
.endfields

#IerSpec_fld

.FIELDS
  np barkod mc ed kol cena summa
  i1 i2
.ENDFIELDS
.{
 Ш^ Ш
                  БСЧЕТ на закупку № Б ^   Бот Б  ^

       БПОЛУЧАТЕЛЬ: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry<=1)
       Б@@@@@@@@@@: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет № Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


       БПОСТАВЩИК : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry<=1)
       Б@@@@@@@@@@: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет № Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

        ^
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
.begin
  CurGrPrice := 0;
end.
 Р
       ────┬────────────────┬──────────────────────────────┬─────────┬────────────┬─────────────────┬───────────────────────
         БNo Б │  БНоменклатурный Б │                              │  БЕдиница Б │            │                 │
         Бп/п Б│      Бномер Б      │   БНаименование, сорт, размер Б  │ Бизмерения Б│  БКоличество Б │        БЦена Б      │           БСумма Б
       ────┴────────────────┴──────────────────────────────┴─────────┴────────────┴─────────────────┴─────────────────────── Р
.{
.begin
  loIer.GetFirst fastfirstrow SpStep where (( comp(PosNRec) == SpStep.nRec ));
  if (loIer.GetFirst fastfirstrow KlPrice
               where (( loIer.SpStep.cPriceList == KlPrice.nRec )) = tsOK)
  {
    TekKlPrice := loIer.SpStep.cPriceList;
    if (loIer.GetFirst fastfirstrow GrPrice
                 where (( loIer.KlPrice.cGrPrice == GrPrice.nRec )) = tsOK)
      TekGrPrice := loIer.KlPrice.cGrPrice
    else
      TekGrPrice := -1;
  }
  else
  {
    TekKlPrice := 0;
    TekGrPrice := -1;
  }
end.
.{?INTERNAL; (TekGrPrice <> CurGrPrice) and (CurGrPrice != 0);
 Р       └──────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
.{?INTERNAL; (TekGrPrice <> CurGrPrice);
.begin
  CurGrPrice := TekGrPrice;
  CurKlPrice := TekKlPrice;
end.
 Р        Е^ Е
       ├─┬─ В^ В
       │ └────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
.{?INTERNAL; (TekGrPrice = CurGrPrice) and (TekKlPrice <> CurKlPrice);
.begin
  CurKlPrice := TekKlPrice;
end.
 Р       ├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       ├─┬─ В^ В
       │ └────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
 Р       │&&& @@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ &'&&&&&&&&&& &'&&&&&&&&&&&&&&& &'&&&&&&&&&&&&&&&&&&.&& Р
.}
 Р       └──────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
 Р       ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.{?Internal;(SumSkidPos>0)
.FIELDS SumSkidPos (i2-SumSkidPos) .ENDFIELDS
 Р                                                             ДСумма скидок к позициям                  &'&&&&&&&&&&&&&&&&&&.&& Ф
 Р                                                             ДИтого с учетом скидок к позициям         &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(op1<>'')
.FIELDS  op1 op2 .ENDFIELDS
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(d2>0)
.FIELDS (d1 + ' ' + StringNLZR(if(d3=' %',d2,SkRub),0,3) + ' %') if(d3=' %',SkRub,d2) .ENDFIELDS
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS  k1 sdoc .ENDFIELDS

 С                                                             ДИТОГО к оплате                           &'&&&&&&&&&&&&&&&&&&.&& Д  И^ Щ
.{?Internal;((n2>0)or(c2>0))
 Р                                                              в том числе: Р
.}
.{?Internal;(n2>0)
.FIELDS n1 n2 .ENDFIELDS
 Р                                                                     Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(c2>0)
.FIELDS c1 c2 .ENDFIELDS
 Р                                                                     Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS
  k3    // прописью
  k4 k5
  kDay
  page_symb
.ENDFIELDS

        БСумма прописью: Б  Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
         ^ ^
        БСчет действителен в течение Б ^  Бдней Б

        БРуководитель ___________          Гл.(старший) бухгалтер ____________ Б

.if Delimiter
 Р---------------------------------------------------------------------------------------------------------------------------- Р
.end
^
.}
.endform
!
!===============================================================================
!
#doc
Рублевый счет на закупку (для вал-руб документов с иерархическим представлением спецификации)
#end
.linkform 'PRBDOC_203_Ier' prototype is 'PRBDOC'
.NameInList 'Рублевый счет на закупку (для вал-руб документов с иерархическим представлением спецификации)'
.group 'Закупка'
#IerSpec_var
.fields
  mnd nomer ddoc
  post bpost rspost mfobik mpost adpost telpost
  pol bpol rspol mfobik mpol adpol telpol
  pname
.endfields

#IerSpec_fld

.FIELDS
  np barkod mc ed kol cenar summar
  i1 i2r op1 op2r
//  d1 d2 d3 SkNDE SNDE
  k1r srub n2r k3r k4 k5 kDay
  page_symb
.endfields
.{

          Ш^ Ш          БСЧЕТ НА ЗАКУПКУ № ^  от  ^ Б

         ПОЛУЧАТЕЛЬ : ^
         Банк      : ^
         Счет № ^ ^ ^
         Адрес : ^
         тел./факс ^


         ПОСТАВЩИК :  ^
         Банк      :  ^
         Счет № ^ ^ ^
         Адрес : ^
         тел./факс ^

        ^
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
.begin
  CurGrPrice := 0;
end.
 Р  ───┬────────────────────┬───────────────────────────────────┬─────────┬────────────┬─────────────────────┬───────────────────────
   № │    Номенклатурный  │                                   │ Единица │            │                     │
  п/п│       номер        │   Наименование, сорт, размер      │измерения│ Количество │         Цена        │          Сумма
  ───┴────────────────────┴───────────────────────────────────┴─────────┴────────────┴─────────────────────┴─────────────────────── Р
.{
.begin
  loIer.GetFirst fastfirstrow SpStep where (( comp(PosNRec) == SpStep.nRec ));
  if (loIer.GetFirst fastfirstrow KlPrice
               where (( loIer.SpStep.cPriceList == KlPrice.nRec )) = tsOK)
  {
    TekKlPrice := loIer.SpStep.cPriceList;
    if (loIer.GetFirst fastfirstrow GrPrice
                 where (( loIer.KlPrice.cGrPrice == GrPrice.nRec )) = tsOK)
      TekGrPrice := loIer.KlPrice.cGrPrice
    else
      TekGrPrice := -1;
  }
  else
  {
    TekKlPrice := 0;
    TekGrPrice := -1;
  }
end.
.{?INTERNAL; (TekGrPrice <> CurGrPrice) and (CurGrPrice != 0);
 Р └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
.{?INTERNAL; (TekGrPrice <> CurGrPrice);
.begin
  CurGrPrice := TekGrPrice;
  CurKlPrice := TekKlPrice;
end.
 Р  Е^ Е
 ├─┬─ В^ В
 │ └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
.{?INTERNAL; (TekGrPrice = CurGrPrice) and (TekKlPrice <> CurKlPrice);
.begin
  CurKlPrice := TekKlPrice;
end.
 Р ├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 ├─┬─ В^ В
 │ └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.}
 Р │&&& @@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ &'&&&&&&&&&& &'&&&&&&&&&&&&&&&&&&& &'&&&&&&&&&&&&&&&&&&.&& Р
.}
 Р └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
 Р ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 Б                                                                        &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& &'&&&&&&&&&&&&&&&&&&&&&
                                                                        &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& &'&&&&&&&&&&&&&&&&&&&&& С


     Итого к оплате: ^' ^ (НДС ^)
        прописью:     Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
         ^ ^

      БСчет действителен в течение ^ дней Б

        Руководитель ___________          Гл.(старший) бухгалтер ____________

.if Delimiter
 Р---------------------------------------------------------------------------------------------------------------------------- Р
.end
^
.}
.endform
