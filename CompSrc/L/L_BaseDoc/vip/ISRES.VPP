//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 7.12 - Логистика
// Контроль резерва документа
//******************************************************************************

// FALSE: если установлен параметр Настройки пользователя
//         Запрет выписки накладной по документу и в счете есть
//         хотя бы одна позиции с нулевым либо просроченным резервом

Function IsRes(var dOper: Date): boolean;
{
  IsRes := TRUE;
  if (wGetTune('Reserv.FormSopr') <> 1)
    Exit;

  PushPos(#SpStep);

  _LOOP SpStep where ((StepDoc.NRec == SpStep.cStepDoc AND
                       word(1)      == SpStep.PrMC ))
    if ((SpStep.SrokRes < dOper) OR (NOT f_KolIsPositive(SpStep.Reserv)))
      {
        var NeotgIsRes: double;
      
        RasNeotg(NeotgIsRes); // расчет неотгруженного

        if (NeotgIsRes <> 0)
          {
            IsRes := FALSE;
            ShowTune('Установлен запрет формирования накладной без предварительного резервирования по ДО!', 
                     'Reserv.FormSopr');
            Break;
          }
      }

  PopPos(#SpStep);
}
