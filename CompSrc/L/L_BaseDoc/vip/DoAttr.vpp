//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 7.12 - Логистика - ДО
// Выбор аттрибутов и клас.  по документу-основанию
//******************************************************************************


cmPickClass:
  {
    var boOnlySeeTmp: boolean;  boOnlySeeTmp := FALSE;

    if (not EditDOPosEnabled(true, true))
      boOnlySeeTmp := TRUE   // запрет редактирования
    else
     if (((tipDO = 101) AND boGetTune('Doc.Buy.NotEditDO'))
         or
         ((tipDO = 201) AND boGetTune('Doc.Sell.NotEditDO'))
         or
         ((tipDO = 1410) AND boGetTune('Doc.Wood.NarAkt.NotEditDO'))
         or
         ((tipDO = 1420) AND boGetTune('Doc.Wood.Schet.NotEditDO')))
       if (IsValid(tnBaseFin) OR IsValid(tnKatSopr))
         boOnlySeeTmp := TRUE

    if (IsNew)
      if (not IsModified)
        { 
          Message('Переход невозможен, так как не заполнен документ.', OkButton);
          Exit;
        }

    SaveMyDsk(boOnlySeeTmp, '_CanEditClassifier_');

    if (UpdateTable)
      case CurTable of
      //--------------
        #BaseDoc:
          if (BaseDoc.nrec <> 0)
            RunInterface(ExClassifier, word(coBaseDoc), Basedoc.Nrec);
      //--------------
        #SpStep:
          if (SpStep.nrec <> 0)
            RunInterface(ExClassifier, word(coSpStep), SpStep.Nrec);
      //--------------
       end;
  }

//******************************************************************************

cmPickAttr:
 {
   var boOnlySeeTmp: boolean;  boOnlySeeTmp := FALSE;

   if (not EditDOPosEnabled(true, true))
     boOnlySeeTmp := TRUE   // запрет редактирования
   else
     if (((tipDO = 101) AND boGetTune('Doc.Buy.NotEditDO'))
       OR 
         ((tipDO = 201) AND boGetTune('Doc.Sell.NotEditDO'))
       OR
         ((tipDO = 1410) AND boGetTune('Doc.Wood.NarAkt.NotEditDO'))
       OR
         ((tipDO = 1420) AND boGetTune('Doc.Wood.Schet.NotEditDO')))
       if (IsValid(tnBaseFin) OR IsValid(tnKatSopr))
         boOnlySeeTmp := TRUE

   if (IsNew)
     if (not IsModified)
       { 
         Message('Переход невозможен, так как не заполнен документ.', OkButton);
         Exit;
       }

   SaveMyDsk(boOnlySeeTmp, '_CanEditAttribute_');

   if (UpdateTable)
     case CurTable of
     //--------------
       #BaseDoc:
        if (BaseDoc.nrec <> 0)
          RunInterface(Attribute, word(coBaseDoc), Basedoc.Nrec);
     //--------------
      #SpStep:
        if (SpStep.nrec <> 0)
          RunInterface(Attribute, word(coSpStep), SpStep.Nrec);
     //--------------
     end;
 }

cmExClassRepl:
  if (UpdateTable)
    case CurTable of
    //--------------
      #BaseDoc:
       if (BaseDoc.nrec <> 0)
         RunInterface('ExClassRepl', word(coBaseDoc), word(15), Basedoc.nRec, longint(0));
    //--------------
    end;

//******************************************************************************
//------для запрета на пересчет суммы по ДО-----------------------------
cmInit:
  { 
    Zapret := 0;
    NeedTotalCount := FALSE;
  }

//******************************************************************************

cmSetCurTable:
  if (Zapret = 1) AND 
      (Target = #BaseDoc) AND 
       (CurTable = #SpStep)             //запрет есть, но выходим
    { 
      NeedTotalCount := TRUE;
      Zapret := 0;
      ModifDo;                    //пар-ры не играют значения
    }
 

//******************************************************************************

cmSortMC:
  if (CurTable = #SpStep)
    { 
      var OldZapret: word;  OldZapret := Zapret;

      if (RunDialog(GetZapret, Zapret) <> cmCancel)
        if (OldZapret = 1) AND 
            (Zapret = 0)                //запрет снят
          { 
            NeedTotalCount := TRUE;
            ModifDo;              //пар-ры не играют значения
          }

      if Zapret = 1                    //запрет установлен
        { 
          set BaseDoc.summa := 0;   
          set BaseDoc.sumVal:= 0;
          set BaseDoc.NDS   := 0;   
          set BaseDoc.total := 0;
        }
    }

//******************************************************************************
