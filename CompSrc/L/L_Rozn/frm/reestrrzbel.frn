! ╔═════════════════════════════════════════════════════════════════════════╗
! ║  Разработал:  Лазутин А. В.                                             ║
! ║  Назначение:  Реестр Свободных розничных цен                            ║
! ╚═════════════════════════════════════════════════════════════════════════╝
!
!******************************************************************************
.LinkForm 'REESTRRZ_2M_No_NDS' Prototype is 'ReestrRZ'
.NameInList 'Приложение к накладной без НДС (ДМ-1)'
.p 43
.DEFO LANDSCAPE
.var
  NomPp:Double
  Summa1:Double
  Summa2:Double
  Summa3:Double
  Summa4:Double
  Summa5:Double
  Summa6:Double
  Summa7:Double
  Summa8:Double
  Nrec_KatOrg        : Comp;   // Nrec Организации
  Nrec_KatOrgDescr   : Comp;   // Nrec Иерархия контрагентов
  cGroup_KatOrgDescr : Comp;   // Ссылка на KONTRIER (Описатель иерархии)
  Kod_Post    : String;
  Name_Gruppa : String;
  Prim        : String;
  L           : Integer
  L2          : Integer
  Stroka      : String
    Nrec_RzKutPrih : Comp
    Nrec_SpDocnal  : Comp
.endvar
.Create  view v_KatSopr                         //  Накладная
  as select *
   from KatSopr
          where
            ((
     comp(KatSopr_nRec)  ==  KatSopr.Nrec
            ))
            ;
.Create  view Kod_Post                         //  Код Поставщика
  as select *
   from Katorg
          where
           ((
     Nrec_KatOrg  ==  KatOrg.Nrec
           ))
            ;
.Create  view v_KatOrgDescr                        // Иерархия контрагентов
  as select *
   from
      Katorg,
      KatOrgDescr
         where
           ((
     KatOrgDescr.cRec  ==  KatOrg.Nrec
           ))
   and  Nrec_KatOrg  =  KatOrgDescr.cRec
            ;
.Create  view v_Name_Gruppa                        // Название Группы Поставщика
  as select *
    from
     Kontrier,
     KatOrgDescr
        where
          ((
       Kontrier.cGroup   ==  KatOrgDescr.Nrec
           ))
   and   KatOrgDescr.Nrec = cGroup_KatOrgDescr
   and   Kontrier.cRecds  = Nrec_KatOrgDescr
             ;
.Create view v_Update                                   // Update НДС=0
   as select *
       from
  RzKutPrih (readonly),
  SpDocNal  (readonly)
       where
               ((
       RzKutPrih.NRec   ==  SpDocNal.cSpDoc             and
       word(901)        ==  RzKutPrih.TypePrih          and
       word(900)        ==  SpDocNal.TipDoc
                ))
         and   RzkutPrih.cSopr   = KatSopr_nRec
         and   RzkutPrih.cSpDoc  = SpSoprnRec1
                       ;
.fields
  CommonFormHeader
  Номер_накладной
  if(LongInt(Дата_накладной) <> LongInt(0),     DateToStr(Дата_накладной, 'DD'), '')
  if(LongInt(Дата_накладной) <> LongInt(0),     DateToStr(Дата_накладной, 'mon'), '')
  if(LongInt(Дата_накладной) <> LongInt(0),     DateToStr(Дата_накладной, 'YYYY'), God)
!  if(Номер_договора <> '', Номер_договора, '')
!  if(LongInt(Дата_договора) <> LongInt(0),     DateToStr(Дата_договора, 'DD'), '')
!  if(LongInt(Дата_договора) <> LongInt(0),     DateToStr(Дата_договора, 'mon'), '')
!  if(LongInt(Дата_договора) <> LongInt(0),     DateToStr(Дата_договора, 'YYYY'), God)
  Организация
  Организация_Банк
  Организация_УНН
  Организация_ОКПО
  Дата_оприходования
  Подразделение_получатель
  Поставщик             // Наименование Поставщика
  Поставщик_Банк        // Наименование Банка
  Поставщик_УНН
  Поставщик_ОКПО
  Name_Gruppa
  Kod_Post
  Prim
  NomPp
  Код_группы_МЦ1
  Код_МЦ1
  Название_МЦ1
  ед_измерения1
  Количество_всего_фактическое1
  Round(цена_первая,3)
  Round(оптовая_надбавка)
  цена_первая * Количество_всего_фактическое1
  Round(Ставка_налога_НДС1)
  cумма_вход_НДС1
  Round(((цена_первая * Количество_всего_фактическое1)+cумма_вход_НДС1))
  Round(розничная_надбавка+оптовая_надбавка)
  (цена_первая * Количество_всего_фактическое1) * (розничная_надбавка / 100)
  Round(цена_розничная * Количество_всего_фактическое1, 3)
  cумма_исход_НДС1
  if(Abs(налог_с_продажи) < 0.5, 0.0, Round(налог_с_продажи))
  (цена_розничная * (налог_с_продажи / 100)) * Количество_всего_фактическое1
  Round(цена_продажная)
  Round(цена_продажная * Количество_всего_фактическое1)
  Summa1
  Summa2
  Summa3
  Summa4
  Summa5
  Summa6
  Summa7
  Summa8
  Summa8
.endfields

.begin
          IF (v_KatSopr.GetFirst KatSopr = 0)
              {
       Nrec_KatOrg := v_KatSopr.KatSopr.cOrg;
           L    := Length(v_KatSopr.KatSopr.Name);
           Prim := Substr(v_KatSopr.KatSopr.Name,1,L);
              }

          IF (Kod_Post.GetFirst KatOrg = 0)
              {
       Kod_Post := Kod_Post.KatOrg.Code;
              }

          IF (v_KatOrgDescr.GetFirst KatOrgDescr = 0)
              {
       Nrec_KatOrgDescr    :=  v_KatOrgDescr.KatOrgDescr.Nrec;
       cGroup_KatOrgDescr  :=  v_KatOrgDescr.KatOrgDescr.cGroup;
              }

          IF (v_Name_Gruppa.GetFirst Kontrier = 0)
              {
       Name_Gruppa := v_Name_Gruppa.KatOrgDescr.Name;
              }
end.
.begin
  NomPp := 0
end.
.{
^
 Ш              ПРИЛОЖЕНИЕ  К  НАКЛАДНОЙ № Б ^ Б от Б "@@" @~@@@@@@ @@@@ г. Б   (ПРИХОД  ТОВАРА)

  БПолучатель: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ^   УНН: ^  ОКПО: ^
  БДата оприходования: Б ^           БПодразделение: Б ^
 Поставщик: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ^   УНН: ^  ОКПО: ^
 Группа поставщика: ^   Код поставщика: ^   Примечание: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{
.[H OVERWRITE
 Ш┌───┬──────┬──────────┬───────────────────────────────────────┬───────┬─────────┬─────────────┬────┬───────────┬────┬──────────┬───────────┬────┬──────────┬───────────────┬───────────┬───┬──────────┬───────────┬─────────────┐
│ N°│  Код │Номенкла- │         Наименование товара           │ Ед-ца │ Кол-во  │  Отпускная  │ %  │ Стоимость │ %  │  Сумма   │  Всего по │ %  │  Сумма   │   Розничная   │   Сумма   │ % │  Налог   │   Цена    │    Сумма    │
│п/п│группы│турный но-│                                       │измере-│ товара  │  цена пост. │опт.│ товара по │НДС │вход. НДС │ поставщику│тор.│ надбавки │     цена      │ исходящего│на-│   на     │ розничная │  розничная  │
│   │      │мер товара│                                       │  ния  │         │   без НДС   │надб│ поставщику│    │поставщика│   с НДС   │надб│          │    /Сумма/    │    НДС    │лог│ продажу  │ с налогом │  с налогом  │
├───┼──────┼──────────┼───────────────────────────────────────┼───────┼─────────┼─────────────┼────┼───────────┼────┼──────────┼───────────┼────┼──────────┼───────────────┼───────────┼───┼──────────┼───────────┼─────────────┤ Ш
.]H
.begin
   NomPp :=NomPp + 1;
   Summa1:=Summa1 + (цена_первая * Количество_всего_фактическое1);
   Summa4:=Summa4 + ((цена_первая * Количество_всего_фактическое1) * (розничная_надбавка / 100));
   Summa5:=Summa5 + (цена_розничная * Количество_всего_фактическое1);
   Summa6:=Summa6 + cумма_исход_НДС1;
   Summa7:=Summa7 + (цена_розничная * (налог_с_продажи / 100)*Количество_всего_фактическое1);
   Summa8:=Summa8 + (цена_продажная * Количество_всего_фактическое1);
!----------------UPDATE SpDocnal на Входящий НДС=0--------------------------------------------
   Ставка_налога_НДС1 := 0;
   cумма_вход_НДС1 := 0;
   цена_учетная := цена_первая;
   Summa2:=Summa2 + cумма_вход_НДС1
   Summa3:=Summa3 + ((цена_первая * Количество_всего_фактическое1)+cумма_вход_НДС1)

         IF (v_Update.GetFirst RzKutPrih =0)
                  {
   Nrec_RzKutPrih := v_Update.RzKutPrih.Nrec;
                  }

 update SpDocNal where (SpDocNal.cSpDoc = Nrec_RzKutPrih and SpDocNal.TipDoc = word(900)) set
       cGrNal := 000000000000000Fh,
       Nalog  := 0,
       Summa  := 0,
       SumNal := 0,
       SumVal := 0
       ;
   update RzKutPrih where(RzKutPrih.Nrec = Nrec_RzKutPrih) set
       Price  := цена_учетная,
       VPrice := цена_учетная
       ;
end.
 Ш│&&&│@@@@@@│&&&&&&&&&&│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@│&&&&&.&&&│&&&&&&&&&.&&&│&&&&│&&&&&&&&&&&│&&&&│&&&&&&&&&&│&&&&&&&&&&&│&&&&│&&&&&&&&&&│&&&&&&&&&&&.&&&│&&&&&&&&&&&│&&&│&&&&&&&&&&│&&&&&&&&&&&│&&&&&&&&&&&&&│ Ш
.[F
 Ш└───┴──────┴──────────┴───────────────────────────────────────┴───────┴─────────┴─────────────┴────┴───────────┴────┴──────────┴───────────┴────┴──────────┴───────────────┴───────────┴───┴──────────┴───────────┴─────────────┘ Ш
.]F
.}
 Ш ИТОГО ПО ДОКУМЕНТУ:                                                                                &&&&&&&&&&&      &&&&&&&&&& &&&&&&&&&&&      &&&&&&&&&& &&&&&&&&&&&.&&& &&&&&&&&&&&     &&&&&&&&&&            &&&&&&&&&&&&&&
                                                                                                                                                                                                                  &&&&&&&&&&.&&&

                       ЦЕНЫ ПРОВЕРИЛ:____________________       ТОВАРОВЕД:____________________        ЗАВ. СЕКЦИИ:____________________ Ш
.{
.}
.{
.}
.{
.}

.}
.endform

!******************************************************************************
.LinkForm 'REESTRRZ_2M' Prototype is 'ReestrRZ'
.NameInList 'Приложение к накладной (ДМ-1)'
.p 43
.DEFO LANDSCAPE
.var
  NomPp  :Double;
  Summa1 :Double;
  Summa2 :Double;
  Summa3 :Double;
  Summa4 :Double;
  Summa5 :Double;
  Summa6 :Double;
  Summa7 :Double;
  Summa8 :Double;
  Nrec_KatOrg        : Comp;   // Nrec Организации
  Nrec_KatOrgDescr   : Comp;   // Nrec Иерархия контрагентов
  cGroup_KatOrgDescr : Comp;   // Ссылка на KONTRIER (Описатель иерархии)
  Kod_Post    : String;
  Name_Gruppa : String;
  Prim        : String;
  L           :Integer;
.endvar
.Create  view v_KatSopr                         //  Накладная
  as select *
   from KatSopr
          where
            ((
     comp(KatSopr_nRec)  ==  KatSopr.Nrec
            ))
            ;
.Create  view Kod_Post                         //  Код Поставщика
  as select *
   from Katorg
          where
           ((
     Nrec_KatOrg  ==  KatOrg.Nrec
           ))
            ;
.Create  view v_KatOrgDescr                        // Иерархия контрагентов
  as select *
   from
      Katorg,
      KatOrgDescr
         where
           ((
     KatOrgDescr.cRec  ==  KatOrg.Nrec
           ))
   and  Nrec_KatOrg  =  KatOrgDescr.cRec
            ;
.Create  view v_Name_Gruppa                        // Название Группы Поставщика
  as select *
    from
     Kontrier,
     KatOrgDescr
        where
          ((
       Kontrier.cGroup   ==  KatOrgDescr.Nrec
           ))
   and   KatOrgDescr.Nrec = cGroup_KatOrgDescr
   and   Kontrier.cRecds  = Nrec_KatOrgDescr
             ;
.fields
  CommonFormHeader
  Номер_накладной
  if(LongInt(Дата_накладной) <> LongInt(0),     DateToStr(Дата_накладной, 'DD'), '')
  if(LongInt(Дата_накладной) <> LongInt(0),     DateToStr(Дата_накладной, 'mon'), '')
  if(LongInt(Дата_накладной) <> LongInt(0),     DateToStr(Дата_накладной, 'YYYY'), God)
!  if(Номер_договора <> '', Номер_договора, '')
!  if(LongInt(Дата_договора) <> LongInt(0),     DateToStr(Дата_договора, 'DD'), '')
!  if(LongInt(Дата_договора) <> LongInt(0),     DateToStr(Дата_договора, 'mon'), '')
!  if(LongInt(Дата_договора) <> LongInt(0),     DateToStr(Дата_договора, 'YYYY'), God)
  Организация
  Организация_Банк
  Организация_УНН
  Организация_ОКПО
  Дата_оприходования
  Подразделение_получатель
  Поставщик             // Наименование Поставщика
  Поставщик_Банк        // Наименование Банка
  Поставщик_УНН
  Поставщик_ОКПО
  Name_Gruppa
  Kod_Post
  Prim
  NomPp
  Код_группы_МЦ1
  Код_МЦ1
  Название_МЦ1
  ед_измерения1
  Количество_всего_фактическое1
  Round(цена_первая,3)
  Round(оптовая_надбавка)
  цена_первая * Количество_всего_фактическое1
  Round(Ставка_налога_НДС1)
  cумма_вход_НДС1
  Round(((цена_первая * Количество_всего_фактическое1) + cумма_вход_НДС1))
  Round(розничная_надбавка+оптовая_надбавка)
  (цена_первая * Количество_всего_фактическое1) * (розничная_надбавка / 100)
  Round(цена_розничная * Количество_всего_фактическое1, 3)
  cумма_исход_НДС1
  if(Abs(налог_с_продажи) < 0.5, 0.0, Round(налог_с_продажи))
  (цена_розничная * (налог_с_продажи / 100)) * Количество_всего_фактическое1
  Round(цена_продажная)
  Round(цена_продажная * Количество_всего_фактическое1)
  Summa1
  Summa2
  Summa3
  Summa4
  Summa5
  Summa6
  Summa7
  Summa8
  Summa8
.endfields

.begin
          IF (v_KatSopr.GetFirst KatSopr = 0)
              {
       Nrec_KatOrg := v_KatSopr.KatSopr.cOrg;
           L    := Length(v_KatSopr.KatSopr.Name);
           Prim := Substr(v_KatSopr.KatSopr.Name,1,L);
              }

          IF (Kod_Post.GetFirst KatOrg = 0)
              {
       Kod_Post := Kod_Post.KatOrg.Code;
              }

          IF (v_KatOrgDescr.GetFirst KatOrgDescr = 0)
              {
       Nrec_KatOrgDescr    :=  v_KatOrgDescr.KatOrgDescr.Nrec;
       cGroup_KatOrgDescr  :=  v_KatOrgDescr.KatOrgDescr.cGroup;
              }

          IF (v_Name_Gruppa.GetFirst Kontrier = 0)
              {
       Name_Gruppa := v_Name_Gruppa.KatOrgDescr.Name;
              }
end.
.begin
  NomPp := 0
end.
.{
^
 Ш              ПРИЛОЖЕНИЕ  К  НАКЛАДНОЙ №  Б^ Б от Б "@@" @~@@@@@@ @@@@ г. Б   (ПРИХОД  ТОВАРА)

  БПолучатель:  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ^   УНН: ^  ОКПО: ^
  БДата оприходования:  Б^           БПодразделение:  Б^
 Поставщик: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 ^   УНН: ^  ОКПО: ^
 Группа поставщика: ^   Код поставщика: ^   Примечание: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{
.[H OVERWRITE
 Ш┌───┬──────┬──────────┬───────────────────────────────────────┬───────┬─────────┬─────────────┬────┬───────────┬────┬──────────┬───────────┬────┬──────────┬───────────────┬───────────┬───┬──────────┬───────────┬─────────────┐
│ N°│  Код │Номенкла- │         Наименование товара           │ Ед-ца │ Кол-во  │  Отпускная  │ %  │ Стоимость │ %  │  Сумма   │  Всего по │ %  │  Сумма   │   Розничная   │   Сумма   │ % │  Налог   │   Цена    │    Сумма    │
│п/п│группы│турный но-│                                       │измере-│ товара  │  цена пост. │опт.│ товара по │НДС │вход. НДС │ поставщику│тор.│ надбавки │     цена      │ исходящего│на-│   на     │ розничная │  розничная  │
│   │      │мер товара│                                       │  ния  │         │   без НДС   │надб│ поставщику│    │поставщика│   с НДС   │надб│          │    /Сумма/    │    НДС    │лог│ продажу  │ с налогом │  с налогом  │
├───┼──────┼──────────┼───────────────────────────────────────┼───────┼─────────┼─────────────┼────┼───────────┼────┼──────────┼───────────┼────┼──────────┼───────────────┼───────────┼───┼──────────┼───────────┼─────────────┤ Ш
.]H
.begin
   NomPp :=NomPp + 1
   Summa1:=Summa1 + (цена_первая * Количество_всего_фактическое1)
   Summa2:=Summa2 + cумма_вход_НДС1
   Summa3:=Summa3 + ((цена_первая * Количество_всего_фактическое1)+cумма_вход_НДС1)
   Summa4:=Summa4 + ((цена_первая * Количество_всего_фактическое1) * (розничная_надбавка / 100))
   Summa5:=Summa5 + (цена_розничная * Количество_всего_фактическое1)
   Summa6:=Summa6 + cумма_исход_НДС1
   Summa7:=Summa7 + (цена_розничная * (налог_с_продажи / 100)*Количество_всего_фактическое1)
   Summa8:=Summa8 + (цена_продажная * Количество_всего_фактическое1)
end.
 Ш│&&&│@@@@@@│&&&&&&&&&&│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@│&&&&&.&&&│&&&&&&&&&.&&&│&&&&│&&&&&&&&&&&│&&&&│&&&&&&&&&&│&&&&&&&&&&&│&&&&│&&&&&&&&&&│&&&&&&&&&&&.&&&│&&&&&&&&&&&│&&&│&&&&&&&&&&│&&&&&&&&&&&│&&&&&&&&&&&&&│ Ш
.[F
 Ш└───┴──────┴──────────┴───────────────────────────────────────┴───────┴─────────┴─────────────┴────┴───────────┴────┴──────────┴───────────┴────┴──────────┴───────────────┴───────────┴───┴──────────┴───────────┴─────────────┘ Ш
.]F
.}
 Ш ИТОГО ПО ДОКУМЕНТУ:                                                                                &&&&&&&&&&&      &&&&&&&&&& &&&&&&&&&&&      &&&&&&&&&& &&&&&&&&&&&.&&& &&&&&&&&&&&     &&&&&&&&&&            &&&&&&&&&&&&&&
                                                                                                                                                                                                                  &&&&&&&&&&.&&&

                       ЦЕНЫ ПРОВЕРИЛ:____________________       ТОВАРОВЕД:____________________        ЗАВ. СЕКЦИИ:____________________ Ш
.{
.}
.{
.}
.{
.}

.}
.endform


!******************************************************************************
#doc
Реестр свободных розничных цен (Беларусь)
#end
.LinkForm 'ReestrRZbel' prototype is 'ReestrRZ'
.NameInList '... Реестр свободных розничных цен (Беларусь)'
.defo Portrait
!.p 55
!.O1 8

.create view vSpSopr
from SpSopr (readonly);

.var
   NomPp : double
   dt: date
.endvar
.fields
  CommonFormHeader

  Номер_накладной
  DateToStr(дата_инвентаризации, 'DD mon YYYY г. (day)')

  Организация


!.{
   NomPp

!   vSpSopr.SpSopr.dSopr
   Номер_накладной

   Название_МЦ1

   Количество_всего_фактическое1


   цена_первая
   оптовая_надбавка
   розничная_надбавка + оптовая_надбавка
   цена_розничная
!.}

  DateToStr(дата_инвентаризации, 'DD mon YYYY г. (day)')

.endfields

.p 43
.begin
  NomPp := 0
end.
.{
 Р^
                                                                                                                      ИПриложение 4
                                                                                                                                к Инструкции о порядке
                                                                                                                             формирования и применения
                                                                                                                                      цен и тарифов РБ
                                                                                                                                    от 10.09.2008 №183 Ш
 Б             РЕЕСТР Б  №  ^  Бот Б ^
              Брозничных цен на Б ________________________________________
 Ш                                                                                         (наименование товара) Ш
              Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Ш                                                      (наименование субъекта предпринимательской деятельности) Ш
.{
.[h OverWrite
 Р───┬───────────┬───────────────────────────┬─────────────┬────────────────┬────────────────┬────────┬───────────┬────────────────
 № │   Номер   │  Наименование товара      │ Артикул,    │    Объем       │ Отпускная цена │Оптовая │ Торговая  │Розничная цена
п/п│    ТТН    │                           │ марка, тип  │    партии      │ за ед.измерения│надбавка│ надбавка  │
───┴───────────┴───────────────────────────┴─────────────┴────────────────┴────────────────┴────────┴───────────┴──────────────── Р
.]h
.begin
   NomPp :=NomPp + 1;
   vSpSopr.GetFirst SpSopr where ((SpSoprNrec1 == SpSopr.nRec));
   dt := vSpSopr.SpSopr.dSopr
end.
 Р&&& &&&&&&&&    @@@@@@@@@@@@@@@@@@@@@@@@@@@                 &&&&&&&&&.&&&    &&&&&&&&&&.&&    &&.&& &&&&&&&&&.&& &&&&&&&&&&&&.&& Р
.}


Руководитель субъекта             _____________  _____________________________
предпринимательской деятельности        Р(подпись)                          (И.О.Фамилия) Р

   Д^ Д
          Р(дата) Р
.{
.}
.{
.}
.{
.}

.}
.endform