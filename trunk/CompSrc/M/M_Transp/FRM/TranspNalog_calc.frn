!
! Используется в присоединенных формах по налогу на странспорт
! прототип - TranspNalog
!
.begin
  // количество лет эксплуатации
  YearsOld := Год_Отчета - Year(ОбъектДатаВыпуска) - 1;
  // Код группы (НЕ подгруппы) в виде числа
  KodGrp := Word(Replace(SubStr(ГруппаКод,1,2),'.',''))

/*************************************************************
ОПРЕДЕЛЕНИЕ ПОПРАВОЧНОГО КОЭФФИЦИЕНТА
*************************************************************/

  case KodGrp of
   1:  
       if (ОбъектСтранаПроизводительСНГ='1') // Страна СНГ
         { 
            if YearsOld >= 0  and YearsOld < 6  Kj := 1;
            if YearsOld >= 6  and YearsOld < 15 Kj := 0.3;
            if YearsOld >= 15 and YearsOld < 25 Kj := 0.2;
            if YearsOld >= 25                   Kj := 0.1;
         }
       else // Страна не СНГ
         { 
            if ГруппаКод = '1.1.' Kj := 0.5;
            if ГруппаКод = '1.2.' Kj := 0.5;
            if ГруппаКод = '1.3.' Kj := 0.5;
            if ГруппаКод = '1.4.' Kj := 0.5;
            if ГруппаКод = '1.5.' Kj := 0.5;
            if ГруппаКод = '1.6.' Kj := 0.7;
            if ГруппаКод = '1.7.' Kj := 1.0;
         }
   2:  
       if (ОбъектСтранаПроизводительСНГ='1') // Страна СНГ
         { 
            if YearsOld >= 0  and YearsOld < 7  Kj := 1;
            if YearsOld >= 7  and YearsOld < 14 Kj := 0.5;
            if YearsOld >= 14 and YearsOld < 20 Kj := 0.3;
            if YearsOld >= 20                   Kj := 0.1;
         }
       else // Страна не СНГ
         { 
            Kj := 1;
         }

   3,4,5:  Kj := 1;
   6:
      {
        if YearsOld >= 0  and YearsOld < 5  Kj := 1;
        if YearsOld >= 5  and YearsOld < 10 Kj := 0.5;
        if YearsOld >= 10 and YearsOld < 20 Kj := 0.3;
        if YearsOld >= 20 and YearsOld < 30 Kj := 0.3;
        if YearsOld >= 30                   Kj := 0.1;
      }
   7: 
      {
         if ОбъектДатаПоступления < Date(01,04,1999)
           {
             if YearsOld > 0  and YearsOld <= 5  Kj := 1;
             if YearsOld > 5  and YearsOld <= 15 Kj := 0.5;
             if YearsOld > 15                    Kj := 0.3;
           }
         else
           {
             if YearsOld > 0  and YearsOld <= 5  Kj := 1;
             if YearsOld > 5  and YearsOld <= 15 Kj := 2;
             if YearsOld > 15                    Kj := 3;
           } 
      }
  end; // case

/*************************************************************
РАСЧЕТ СУММ НАЛОГА
*************************************************************/
   S13 := round(ОбъектСтавкаНалога*MRP,0); // Базовая сумма налога
   S14 := If(KodGrp=1,ОбъектТехПоказатель-ОбъектТехПоказательМин,0);  // Превышение только для группы 1-Легковые автомобили
   S15 := If(KodGrp=1,round((ОбъектТехПоказатель-ОбъектТехПоказательМин)*Pr,0),0); // Превышение только для группы 1-Легковые автомобили

   case KodGrp of
   1: {
         Snal:= S15 + S13;
         Ssp := round(Kj*Snal,0);
         Sf  := Ssp;
         if ОбъектПризнакПостановкиНаУчет = 1 // ранее НЕ стояло на учете
            Sf := round(Sf / 12 *  ОбъектКоличествоМесяцев,0);
      }

   2..6:
      {
         Snal:= S13;
         Ssp := round(Kj*Snal,0);
         Sf  := Ssp;
         if ОбъектПризнакПостановкиНаУчет = 1 // ранее НЕ стояло на учете
            Sf := round(Sf / 12 * ОбъектКоличествоМесяцев,0);
      }
   7: {
         Snal:= round(S13*ОбъектТехПоказатель,0);
         Ssp := round(Kj*Snal,0);
         Sf  := Ssp;
      }
   end; // case


/*************************************************************
РАСЧИТЫВАЕМ ИТОГОВЫЕ СТРОК
*************************************************************/

   Total16 := Total16 + Snal;
   Total18 := Total18 + Ssp;
   Total19 := Total19 + Sf;
   Total20 := Total20 + 1; // Количество
   Total21 := Total21 + Sf;
   Total27 := Total27 + Sf;

/*************************************************************
ДЛЯ ПРИЛОЖЕНИЯ
*************************************************************/

   EI1 := '';
   EI2 := '';   
   EI3 := '';
   EI4 := '';
   EI5 := '';
 
   case ОбъектЕдиницаИзмерения of
    'л.с.'      : EI1 := 'Х';
    'кВт'       : EI2 := 'Х';
    'куб.см.'   : EI3 := 'Х';
    'тонн'      : EI4 := 'Х';
    'посад.мест': EI5 := 'Х';
  end ;// case

end. 
