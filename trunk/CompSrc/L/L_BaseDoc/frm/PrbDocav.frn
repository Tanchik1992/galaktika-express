/*
 ╔═══════════════════════════════════════════════════════════════════════════╗
 ║                     (c) 1994,97 корпорация ГАЛАКТИКА                      ║
 ║ Проект        : ГАЛАКТИКА                                                 ║
 ║ Система       : Автотранспорт                                             ║
 ║ Версия        : 5.7                                                       ║
 ║ Назначение    : Счет для оплаты с чужими ТТН                              ║
 ║ Ответственный : Лисица Наталья Михайловна                                 ║
 ╚═══════════════════════════════════════════════════════════════════════════╝
*/
#doc
Счет c информацией по ТТН заказчика
#end
.linkform 'PRBDOCTr' prototype is 'PRBDOC'
.NameInList 'Счет c информацией по ТТН заказчика'
.group 'Продажа'
.var
 Akciz : double
 CenaAk : double
 SumAk  : double
 totSumAk : double
 Nom_Put       : string
 Nom_TTN       : string
 Nom_Katkaz       : string
 Nom_SpSopr       : string
 Nom_Spzakaz      : string
 Nom_Putlst       : string
 Nom_ТC           : string
 Marka_Tc         : string
 Ton_Tc           : double
 Chas_TC          : double
 Km_Tc            : double
 Tkm_Tc           : double
.endvar
.create view AvtoView
from SpSopr, SpZakaz ,Katzak, Putlst, Katsopr, Transp, Marka
;
.FIELDS
 post adpost telpost rspost mpost bpost+if(rspost2<>'', ', К/С '+rspost2, '')
 citypost
 sGetTune('KatOrg.FldView.UNN')
 innpost
 sGetTune('KatOrg.FldView.OKONH')
 okonhpost
 sGetTune('KatOrg.FldView.OKPO')
 OKPOpost
 Grpost gradpost
 grpol gradpol
! Nplras DPlras
 BaseFinNumber BaseFinDate
  nomer ddoc
 pol adpol telpol rspol mpol bpol+if(rspol2<>'', ', К/С '+rspol2, '')
 citypol
 sGetTune('KatOrg.FldView.UNN')
 innpol
 sGetTune('KatOrg.FldView.OKONH')
 okonhpol
 sGetTune('KatOrg.FldView.OKPO')
 OKPOpol
 pname
!  pname1
!  pname2
   Nom_put
   Nom_TTN
   Nom_ТC
   Marka_Tc
   Ton_Tc
   Chas_TC
   Km_Tc
   Tkm_Tc
  mc barkod2 ed kol cenaAk akciz sumAk Ak procnds
  Nds Newsumma

  TotSumAk c2 n2 k1
  Director
  Main_Buh
  page_symb
.ENDFIELDS
.{

 Ш    БПоставщик Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БАдрес Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  БТелефон  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БРасчетный счет № Б @@@@@@@@@@@@@@@@@@@@  ББИК Б @@@@@@@@@@  Бв Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БГород Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БИдентификационный номер поставщика (@@@@@) Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БКод по @@@@@ Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БКод по @@@@@@ Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БГрузоотправитель и его адрес Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БГрузополучатель и его адрес Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БК платежно-расчетному документу
.{ CheckEnter IsBaseFin
        № @@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@
.}
!    @@@@@@@@@ от @@@@@@@@@@@@@@@@

                         БСЧЕТ ЗА АВТОУСЛУГИ № Б @@@@@@@@@  Бот Б @@@@@@@@@@@@@@@@

 Ш    БПокупатель  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БАдрес Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  БТелефон Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БРасчетный счет № Б @@@@@@@@@@@@@@@@@@@@  ББИК Б @@@@@@@@@@  Бв Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БГород Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БИдентификационный номер покупателя (@@@@@) Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БКод по @@@@@ Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БКод по @@@@@@ Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    БДополнение (условия   оплаты   по   договору  (контракту),  способ отправления и т.п.) Б
   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
 Ш   ┌─────────┬─────────┬─────────┬──────────────┬────────┬────────┬────────┬────────┬──────────────────────┬─────────┬────────┬──────────┬─────────────┬──────┬────────────────┬──────┬──────┬─────────────┬────────────────────┐
   │  Номер  │ Номер   │ Номер   │    Марка     │ тонны  │ часы   │расстоя-│        │  Наименование        │ Код по  │Единица │Количество│    Цена     │в т.ч.│     Сумма      │в т.ч.│Ставка│    Сумма    │       Всего        │
   │   П/Л   │  ТТН    │  ТC     │     ТС       │        │        │ние     │  ткм   │    услуги            │  ОКДП   │измерен.│          │             │акциз │                │акциз │ НДС  │     НДС     │       с НДС        │
   └─────────┴─────────┴─────────┴──────────────┴────────┴────────┴────────┴────────┴──────────────────────┴─────────┴────────┴──────────┴─────────────┴──────┴────────────────┴──────┴──────┴─────────────┴────────────────────┘ Ш
.begin
  TotSumAk := 0
 end.
.{
.begin
 Akciz := Ak/kol
 CenaAk := cenabez + AkCiz
 SumAk  := sbez + Ak
 TotSumAk := TotSumAk + SumAk
  Nom_put  :=  '';
  Nom_ТC   :=  '';
  Marka_Tc :=  '';
  Ton_Tc   :=  0;
  Chas_TC  :=  0;
  Km_Tc    :=  0;
  Tkm_Tc   :=  0;
  Nom_TTN := if ( Avtoview.getFirst SpSopr where (( comp(Posnrec) == SpSopr.cSpStep and
                                                  SpSopr.cZakVol == Spzakaz.nrec  and
                                                  SpZakaz.cKatZak  == KatZak.nrec    and
                                                  KatZak.cTTn  == Katsopr.nrec
                      )) = 0 ,
             Avtoview.Katsopr.Nsopr, ' ' );
 If  Avtoview.getFirst SpSopr where (( comp(Posnrec)     == SpSopr.cSpStep and
                                                     SpSopr.cZakVol  == Spzakaz.nrec   and
                                                     SpZakaz.cKatZak == KatZak.nrec    and
                                                     KatZak.cPutlst  == PutLst.nrec    and
                                                     Putlst.cTransp  == Transp.nrec    and
                                                     Transp.cMarka   == Marka.nrec
                                      )) = 0
 {
  Nom_put  :=  Avtoview.Putlst.Npl;
  Nom_ТC   :=  Avtoview.Transp.Nomer;
  Marka_Tc :=  Avtoview.Marka.Nm;
  Ton_Tc   :=  Avtoview.Katzak.fkGruzTn;
  Chas_TC  :=round(_SubDateTime(_datetime1(Avtoview.Katzak.ReturnDn,Avtoview.Katzak.ReturnCh),
                        _datetime1(Avtoview.Katzak.ExitDn,Avtoview.Katzak.ExitCh))/double(360000),2) ;
  Km_Tc    :=  Avtoview.Katzak.ProbegAll;
  Tkm_Tc   :=  Avtoview.Katzak.fkGruzTn * Avtoview.Katzak.ProbegAll;
 }
 end.
  Ш   @@@@@@@@@ @@@@@@@@@ @@@@@@@@@ @@@@@@@@@@@@@@ &'&&&.&& &'&&&.&& &'&&&.&& &'&&&.&& @@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@ @@@@@@@@ &&&&&&&&&& &'&&&&&&&&.&& &'&.&& &'&&&&&&&&&&&.&& &'&&&& &&&&&. &'&&&&&&&&&&& &'&&&&&&&&&&&&&&&&&& Ш
.}

 а  ╕Всего к оплате                                                                                                                                              &'&&&&&&&&&&&.&& &'&&&&        &'&&&&&&&&&&& &'&&&&&&&&&&&&&&&&&& ╕

 С    Руководитель предприятия_____________ ^
    Гл. бухгалтер           _____________ ^

                                                      М.П.

                     ПОЛУЧИЛ                                                     ВЫДАЛ С

.if Delimiter
 Р---------------------------------------------------------------------------------------------------------------------------- Р
.end
^
.}
.endform
!
!===============================================================================
!