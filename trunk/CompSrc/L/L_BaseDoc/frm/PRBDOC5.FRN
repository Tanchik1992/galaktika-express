/*
 ╔════════════════════════════════════════════════════════════════════════════╗
 ║                     (c) Корпорация ГАЛАКТИКА, 1997,98                      ║
 ║ Проект        : ГАЛАКТИКА                                                  ║
 ║ Система       : Оперативный контур                                         ║
 ║ Версия        : 5.70                                                       ║
 ║ Назначение    : Печать ДО на предоплату                                    ║
 ║ Ответственный : Шукан Александр Леонидович (SAL)                           ║
 ╚════════════════════════════════════════════════════════════════════════════╝
*/

#doc
Счет СТАНДАРТНЫЙ - А4
#end
.linkform 'PRBDOC_115_1_1' prototype is 'PRBDOC'
.NameInList 'Счет СТАНДАРТНЫЙ - А4'
.group 'Предоплата продаж'
.var
  INN_KPP_Post, INN_KPP_Pol : String
.endvar
.FIELDS
  mnd nomer ddoc
  post
.ENDFIELDS
.{?Internal;(wCountry=0)
.fields
//  innpost
  INN_KPP_Post
.endfields
.}
.FIELDS
  bpost rspost mfobik mpost rspost2 mfobik mpost2 adpost telpost
  pol
.ENDFIELDS
.{?Internal;(wCountry=0)
.fields
//  innpol
  INN_KPP_Pol
.endfields
.}
.FIELDS
  bpol rspol mfobik mpol rspol2 mfobik mpol2 adpol telpol pname
  np barkod mc ed kol cena summa
  i1 i2
.ENDFIELDS
.{
 Ш^ Ш
                         БСЧЕТ № Б ^   Бот Б  ^
.begin
  INN_KPP_Post := '';
  if ((innpost <> '') or (KodNDS_post_NotSF <> ''))
    INN_KPP_Post := innpost + ' / ' + KodNDS_post_NotSF;

  INN_KPP_Pol := '';
  if ((innpol <> '') or (KodNDS_pol_NotSF <> ''))
    INN_KPP_Pol := innpol + ' / ' + KodNDS_pol_NotSF;
end.

       БПОСТАВЩИК : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry=0)
       БИНН / КПП : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет N Б ^ ^ ^
       БК/С Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


       БПОЛУЧАТЕЛЬ: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry=0)
       БИНН / КПП : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет N Б ^ ^ ^
       БК/С Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

        ^
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
 Р
        ───┬────────────────┬──────────────────────────────┬─────────┬────────────┬─────────────────┬───────────────────────
         БNo Б │  БНоменклатурный Б │                              │  БЕдиница Б │            │                 │
         Бп/п Б│      Бномер Б      │   БНаименование, сорт, размер Б  │ Бизмерения Б│  БКоличество Б │        БЦена Б      │           БСумма Б
        ───┴────────────────┴──────────────────────────────┴─────────┴────────────┴─────────────────┴─────────────────────── Р
.{
 Р        &&& @@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ &#'&&&&&&&&& &#'&&&&&&&&&&&&&& &#'&&&&&&&&&&&&&&&&&.&& Р
.}
 Р        ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.{?Internal;(SumSkidPos>0)
.FIELDS SumSkidPos (i2-SumSkidPos) .ENDFIELDS
 Р                                                             ДСумма скидок к позициям                  &#'&&&&&&&&&&&&&&&&&.&& Ф
 Р                                                             ДИтого с учетом скидок к позициям         &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(op1<>'')
.FIELDS  op1 op2 .ENDFIELDS
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(d2>0)
.FIELDS (d1 + ' ' + StringNLZR(if(d3=' %',d2,SkRub),0,3) + ' %') if(d3=' %',SkRub,d2) .ENDFIELDS
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS  k1 sdoc .ENDFIELDS

 С                                                             ДИТОГО к оплате                           &#'&&&&&&&&&&&&&&&&&.&& Д  И^ Щ
.{?Internal;((n2>0)or(c2>0)or(p2>0))
 Р                                                              в том числе: Р
.}
.{?Internal;(n2>0)
.FIELDS n1 n2 .ENDFIELDS
 Р                                                                     Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(c2>0)
.FIELDS c1 c2 .ENDFIELDS
 Р                                                                     Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(p2>0)
.FIELDS p1 p2 .ENDFIELDS
 Р                                                                     Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS
  k3    // прописью
  k4 k5
  kDay
  TaraVoz
  Director
  Main_Buh
  page_symb
.ENDFIELDS

     БСумма прописью: Б  Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
      ^ ^
     БСчет действителен в течение Б ^  Бдней Б              ^

     БРуководитель          ___________^ Б
     БГл.(старший) бухгалтер___________^ Б
.if Delimiter
 Р---------------------------------------------------------------------------------------------------------------------------- Р
.end
^
.}
.endform

#doc
Счет на предоплату - А4(нефтепродукты)
#end
.linkform 'PRBDOC_115_1' prototype is 'PRBDOC'
.NameInList 'Счет на предоплату - А4(нефтепродукты)'
.group 'Предоплата продаж'
.DEFP PA4
.DEFO LANDSCAPE
.P 55
.var
   TotalKol      : double
   TotalSumma    : double
   TotalSummaBez : double
   TotalGSM      : double
   TotalNDS20    : double
   TotalTU       : double
   TotalTUnds    : double
   TotalTUall    : double
   Dog           : string
   Attr          : string
   TotalSummaStr : string
.endvar
.create view myview
from BaseDoc, Dogovor, AttrVal, AttrNam
where
((
  BaseDoc.cDogovor == Dogovor.nRec
))
;
.FIELDS
  post sGetTune('KatOrg.FldView.UNN') innpost
  if(citypost<>'', 'г.'+citypost+', ', '')+adpost
  'р/с '+rspost+if(mpost<>'', ' БИК '+mpost, '')+if(bpost<>'', ' в '+bpost, '')+if(postbankadr<>'', ', '+postbankadr, '')+if(rspost2<>'', ', к/с '+rspost2, '')
  nomer
  pol sGetTune('KatOrg.FldView.UNN') innpol
  if(citypol<>'', 'г.'+citypol+', ', '')+adpol
  'р/с '+rspol+if(mpol<>'', ' БИК '+mpol, '')+if(bpol<>'', ' в '+bpol, '')+if(polbankadr<>'', ', '+polbankadr, '')+if(rspol2<>'', ', к/с '+rspol2, '')
  ddoc
  np mc kol cena cenaBez sBez GSM Nds20 summa tu tuNDS tuALL
  TotalKol TotalSummaBez TotalGSM TotalNDS20 TotalSumma TotalTU TotalTUnds TotalTUall
!  i1 i2
.ENDFIELDS
.{
 ЩНаименование получателя:          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 Щ@@@@@@@@@@@@:                     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 ШАдрес     :                       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 ШБанковские реквизиты получателя:  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Й                                                                                                                 ┌─────────────────┐
                                                                                                          Счет № │@@@@@@@@@@@@@@@@@│
                                                                                                                 └─────────────────┘ Й
 ЩНаименование плательщика:         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 Щ@@@@@@@@@@@@:                     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 ШАдрес     :                       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 ШБанковские реквизиты плательщика: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Й                                                                                                                    Дата: ^ Й
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
 Ш┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────┐ Ш
 Ш│                                                                         За нефтепродукты                                                                                 │                За транспорт                   │ Ш
 Ш├───┬──────────┬──────────────────────────┬──────────────┬───────────────┬───────────────┬────────────────────────┬───────────────┬───────────────┬────────────────────────┼───────────────┬───────────────┬───────────────┤ Ш
 Ш│ № │   Вид    │Наименование нефтепродукта│  Количество  │   Цена с НДС  │  Цена без НДС │   Сумма без НДС и ГСМ  │      ГСМ      │      НДС      │    Всего сумма с НДС   │ Сумма без НДС │      НДС      │  Всего сумма  │ Ш
 Ш│п/п│  оплаты  │                          │              │     и ГСМ     │     и ГСМ     │                        │               │               │         и ГСМ          │               │               │     с НДС     │ Ш
 Ш├───┼──────────┼──────────────────────────┼──────────────┼───────────────┼───────────────┼────────────────────────┼───────────────┼───────────────┼────────────────────────┼───────────────┼───────────────┼───────────────┤ Ш
.begin
   TotalKol      :=  0;
   TotalSumma    :=  0;
   TotalSummaBez :=  0;
   TotalGSM      :=  0;
   TotalNDS20    :=  0;
   TotalTU       :=  0;
   TotalTUnds    :=  0;
   TotalTUall    :=  0;
 end.
.{
 Ш│&&&│Предоплата│@@@@@@@@@@@@@@@@@@@@@@@@@@│&#'&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│ Ш
.begin
   TotalKol      :=  TotalKol      + kol;
   TotalSumma    :=  TotalSumma    + summa;
   TotalSummaBez :=  TotalSummaBez + sBez;
   TotalGSM      :=  TotalGSM      + GSM;
   TotalNDS20    :=  TotalNDS20    + NDS20;
   TotalTU       :=  TotalTU       + tu;
   TotalTUnds    :=  TotalTUnds    + tuNDS;
   TotalTUall    :=  TotalTUall    + tuALL;
 end.
.}
 Ш╞═══╪══════════╪══════════════════════════╪══════════════╪═══════════════╪═══════════════╪════════════════════════╪═══════════════╪═══════════════╪════════════════════════╪═══════════════╪═══════════════╪═══════════════╡ Ш
 Ш│   │  ИТОГО:  │                          │&#'&&&&&&&.&&&│               │               │&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&.&&│ Ш
 Ш└───┴──────────┴──────────────────────────┴──────────────┴───────────────┴───────────────┴────────────────────────┴───────────────┴───────────────┴────────────────────────┴───────────────┴───────────────┴───────────────┘ Ш
! Ш @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ш
.{?internal;Abs(TotalSumma)>0.0001
.begin
   TotalSummaStr := DoubleToString(BaseDoc.cVal, TotalSumma);
 end.
.FIELDS
!   TotalSumma  k3
   TotalSumma  TotalSummaStr
   TotalGSM    sdoc
   TotalNDS20  sdoc
   TotalTUall  sdoc
   TotalTUnds  sdoc
.ENDFIELDS
 Ш                                         ┌───────────────────────┐  Ш
 Ш Всего к оплате за нефтепродукты:        │ Б&#'&&&&&&&&&&&&&&&&&.&& Б│  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Ш                                         └───────────────────────┘  Ш
 Ш ГСМ(рассчитанный по ставке 25 %):        &#'&&&&&&&&&&&&&&&&&.&& ^ Ш
 Ш НДС(рассчитанный по ставке 20 %):        &#'&&&&&&&&&&&&&&&&&.&& ^ Ш

 Ш                                         ┌───────────────────────┐  Ш
 Ш Всего к возмещению за транспорт:        │&#'&&&&&&&&&&&&&&&&&.&&│ ^  Ш
 Ш                                         └───────────────────────┘  Ш
 Ш НДС:                                     &#'&&&&&&&&&&&&&&&&&.&& ^ Ш
.}
.{?internal;TotalSumma = 0
.begin
   TotalSummaStr := DoubleToString(BaseDoc.cVal, i2);
 end.
.FIELDS
!   i2 k3
   i2 TotalSummaStr
.ENDFIELDS
 Ш                                         ┌───────────────────────┐ Ш
 Ш Всего к оплате за нефтепродукты:        │ Б&#'&&&&&&&&&&&&&&&&&.&& Б│  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Ш                                         └───────────────────────┘ Ш
.{?Internal;((n2>0)or(c2>0)or(p2>0))
 Р                             в том числе: Р
.}
.{?Internal;(n2>0)
.FIELDS n1 n2 .ENDFIELDS
 Ш        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   Б&#'&&&&&&&&&&&&&&&&&.&& Б Ш
.}
.{?Internal;(c2>0)
.FIELDS c1 c2 .ENDFIELDS
 Ш        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   Б&#'&&&&&&&&&&&&&&&&&.&& Б Ш
.}
.{?Internal;(p2>0)
.FIELDS p1 p2 .ENDFIELDS
 Ш        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   Б&#'&&&&&&&&&&&&&&&&&.&& Б Ш
.}
.}

.begin
   Dog := if ( myview.getFirst BaseDoc where (( comp(BaseDocNrec) == BaseDoc.nRec )) = 0,
            myview.Dogovor.NoDoc +
            ' от ' + DateToStr ( myview.Dogovor.dDoc, 'DD/MM/YYYY' ),
            '' );
   Attr := if ( myview.getFirst AttrNam where ((        coBaseDoc  == AttrNam.wTable   and
                                                 'Месяц ресурса'   == AttrNam.Name     and
                                                        coBaseDoc  == AttrVal.wTable   and
                                                 comp(BaseDocNrec) == AttrVal.cRec     and
                                                 AttrNam.NRec      == AttrVal.cAttrNam )) = 0,
            myview.AttrVal.vString, '' );
 end.

.FIELDS
   post
   Dog
   Attr
   page_symb
.ENDFIELDS

 Щ    от ^ Щ
 Ш                                                                                                                                                                            Основание: договор №^
    Руководитель                                                                                                                                                            Месяц ресурса: ^
    предприятия  ____________________________ (Ф.И.О.)
                                                              м.п.
    Гл.бухгалтер ____________________________ (Ф.И.О.)

    Исполнитель  ____________________________ (Ф.И.О.) Ш

.if Delimiter
----------------------------------------------------------------------------------------------------------------------------
.end
^
.}
.endform


#doc
Счет СТАНДАРТНЫЙ - А4
#end
.linkform 'PRBDOC_115_2_1' prototype is 'PRBDOC'
.NameInList 'Счет СТАНДАРТНЫЙ - А4'
.group 'Предоплата закупок'
.var
  INN_KPP_Post, INN_KPP_Pol : String
.endvar
.FIELDS
  mnd nomer ddoc
  post
.ENDFIELDS
.{?Internal;(wCountry=0)
.fields
  INN_KPP_Post
.endfields
.}
.FIELDS
  bpost rspost mfobik mpost adpost telpost
  pol
.ENDFIELDS
.{?Internal;(wCountry=0)
.fields
  INN_KPP_Pol
.endfields
.}
.FIELDS
  bpol rspol mfobik mpol adpol telpol pname
  np barkod mc ed kol cena summa
  i1 i2
.ENDFIELDS
.{
 Ш^ Ш
                  БСЧЕТ на закупку № Б ^   Бот Б  ^
.begin
  INN_KPP_Post := '';
  if ((innpost <> '') or (KodNDS_post_NotSF <> ''))
    INN_KPP_Post := innpost + ' / ' + KodNDS_post_NotSF;

  INN_KPP_Pol := '';
  if ((innpol <> '') or (KodNDS_pol_NotSF <> ''))
    INN_KPP_Pol := innpol + ' / ' + KodNDS_pol_NotSF;
end.
       БПОЛУЧАТЕЛЬ: Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry=0)
       БИНН / КПП : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет N Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


       БПОСТАВЩИК : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.{?Internal;(wCountry=0)
       БИНН / КПП : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
.}
       ББанк      : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       БСчет N Б ^ ^ ^
       БАдрес     : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       Бтел./факс : Б @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

        ^
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
 Р
        ───┬────────────────┬──────────────────────────────┬─────────┬────────────┬─────────────────┬───────────────────────
         БNo Б │  БНоменклатурный Б │                              │  БЕдиница Б │            │                 │
         Бп/п Б│      Бномер Б      │   БНаименование, сорт, размер Б  │ Бизмерения Б│  БКоличество Б │        БЦена Б      │           БСумма Б
        ───┴────────────────┴──────────────────────────────┴─────────┴────────────┴─────────────────┴─────────────────────── Р
.{
 Р        &&& @@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @~@@@@@@@ &#'&&&&&&&&& &#'&&&&&&&&&&&&&& &#'&&&&&&&&&&&&&&&&&.&& Р
.}
 Р        ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.{?Internal;(SumSkidPos>0)
.FIELDS SumSkidPos (i2-SumSkidPos) .ENDFIELDS
 Р                                                             ДСумма скидок к позициям                  &#'&&&&&&&&&&&&&&&&&.&& Ф
 Р                                                             ДИтого с учетом скидок к позициям         &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(op1<>'')
.FIELDS  op1 op2 .ENDFIELDS
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(d2>0)
.FIELDS (d1 + ' ' + StringNLZR(if(d3=' %',d2,SkRub),0,3) + ' %') if(d3=' %',SkRub,d2) .ENDFIELDS
 Р                                                             Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS  k1 sdoc .ENDFIELDS

 С                                                             ДИТОГО к оплате                           &#'&&&&&&&&&&&&&&&&&.&& Д  И^ Щ
.{?Internal;((n2>0)or(c2>0))
 Р                                                              в том числе: Р
.}
.{?Internal;(n2>0)
.FIELDS n1 n2 .ENDFIELDS
 Р                                                                     Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&.&& Ф
.}
.{?Internal;(c2>0)
.FIELDS c1 c2 .ENDFIELDS
 Р                                                                     Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&&.&& Ф
.}
.FIELDS
  k3    // прописью
  k4 k5
  kDay
  page_symb
.ENDFIELDS

        БСумма прописью: Б  Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
         ^ ^
        БСчет действителен в течение Б ^  Бдней Б

        БРуководитель ___________          Гл.(старший) бухгалтер ____________ Б

.if Delimiter
 Р---------------------------------------------------------------------------------------------------------------------------- Р
.end
^
.}
.endform

#doc
Счет на предоплату - А4(нефтепродукты)
#end
.linkform 'PRBDOC_115_2' prototype is 'PRBDOC'
.NameInList 'Счет на предоплату - А4(нефтепродукты)'
.group 'Предоплата закупок'
.DEFP PA4
.DEFO LANDSCAPE
.P 55
.var
   TotalKol      : double
   TotalSumma    : double
   TotalSummaBez : double
   TotalGSM      : double
   TotalNDS20    : double
   TotalTU       : double
   TotalTUnds    : double
   TotalTUall    : double
   Dog           : string
   Attr          : string
.endvar
.create view myview
from BaseDoc, Dogovor, AttrVal, AttrNam
where
((
  BaseDoc.cDogovor == Dogovor.nRec
))
;
.FIELDS
  post sGetTune('KatOrg.FldView.UNN') innpost
  if(citypost<>'', 'г.'+citypost+', ', '')+adpost
  'р/с '+rspost+if(mpost<>'', ' БИК '+mpost, '')+if(bpost<>'', ' в '+bpost, '')+if(postbankadr<>'', ', '+postbankadr, '')+if(rspost2<>'', ', к/с '+rspost2, '')
  nomer
  pol sGetTune('KatOrg.FldView.UNN') innpol
  if(citypol<>'', 'г.'+citypol+', ', '')+adpol
  'р/с '+rspol+if(mpol<>'', ' БИК '+mpol, '')+if(bpol<>'', ' в '+bpol, '')+if(polbankadr<>'', ', '+polbankadr, '')+if(rspol2<>'', ', к/с '+rspol2, '')
  ddoc
  np mc kol cena cenaBez sBez GSM Nds20 summa tu tuNDS tuALL
  TotalKol TotalSummaBez TotalGSM TotalNDS20 TotalSumma TotalTU TotalTUnds TotalTUall
!  i1 i2
.ENDFIELDS
.{
 ЩНаименование плательщика:         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 Щ@@@@@@@@@@@@:                     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 ШАдрес     :                       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 ШБанковские реквизиты плательщика: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Й                                                                                                                 ┌─────────────────┐
                                                                                                          Счет № │@@@@@@@@@@@@@@@@@│
                                                                                                                 └─────────────────┘ Й
 ЩНаименование получателя:          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 Щ@@@@@@@@@@@@:                     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
 ШАдрес     :                       @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 ШБанковские реквизиты получателя:  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Й                                                                                                                    Дата: ^ Й
.{ CheckEnter IsBaseFin
.}
.{ CheckEnter IsExClass
.}
.{ CheckEnter IsGroup
.}
 Ш┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬───────────────────────────────────────────────┐ Ш
 Ш│                                                                         За нефтепродукты                                                                                 │                За транспорт                   │ Ш
 Ш├───┬──────────┬──────────────────────────┬──────────────┬───────────────┬───────────────┬────────────────────────┬───────────────┬───────────────┬────────────────────────┼───────────────┬───────────────┬───────────────┤ Ш
 Ш│ № │   Вид    │Наименование нефтепродукта│  Количество  │   Цена с НДС  │  Цена без НДС │   Сумма без НДС и ГСМ  │      ГСМ      │      НДС      │    Всего сумма с НДС   │ Сумма без НДС │      НДС      │  Всего сумма  │ Ш
 Ш│п/п│  оплаты  │                          │              │     и ГСМ     │     и ГСМ     │                        │               │               │         и ГСМ          │               │               │     с НДС     │ Ш
 Ш├───┼──────────┼──────────────────────────┼──────────────┼───────────────┼───────────────┼────────────────────────┼───────────────┼───────────────┼────────────────────────┼───────────────┼───────────────┼───────────────┤ Ш
.begin
   TotalKol      :=  0;
   TotalSumma    :=  0;
   TotalSummaBez :=  0;
   TotalGSM      :=  0;
   TotalNDS20    :=  0;
   TotalTU       :=  0;
   TotalTUnds    :=  0;
   TotalTUall    :=  0;
 end.
.{
 Ш│&&&│Предоплата│@@@@@@@@@@@@@@@@@@@@@@@@@@│&#'&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│&#'&&&&&&&&&&&&│ Ш
.begin
   TotalKol      :=  TotalKol      + kol;
   TotalSumma    :=  TotalSumma    + summa;
   TotalSummaBez :=  TotalSummaBez + sBez;
   TotalGSM      :=  TotalGSM      + GSM;
   TotalNDS20    :=  TotalNDS20    + NDS20;
   TotalTU       :=  TotalTU       + tu;
   TotalTUnds    :=  TotalTUnds    + tuNDS;
   TotalTUall    :=  TotalTUall    + tuALL;
 end.
.}
 Ш╞═══╪══════════╪══════════════════════════╪══════════════╪═══════════════╪═══════════════╪════════════════════════╪═══════════════╪═══════════════╪════════════════════════╪═══════════════╪═══════════════╪═══════════════╡ Ш
 Ш│   │  ИТОГО:  │                          │&#'&&&&&&&.&&&│               │               │&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&.&&│&#'&&&&&&&&&.&&│ Ш
 Ш└───┴──────────┴──────────────────────────┴──────────────┴───────────────┴───────────────┴────────────────────────┴───────────────┴───────────────┴────────────────────────┴───────────────┴───────────────┴───────────────┘ Ш
! Ш @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &#'&&&&&&&&&&&&&&&&&&.&& Ш
.{?internal; Abs(TotalSumma) > 0.0001
.FIELDS
   TotalSumma  k3
   TotalGSM    sdoc
   TotalNDS20  sdoc
   TotalTUall  sdoc
   TotalTUnds  sdoc
.ENDFIELDS
 Ш                                         ┌───────────────────────┐  Ш
 Ш Всего к оплате за нефтепродукты:        │ Б&#'&&&&&&&&&&&&&&&&&.&& Б│  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Ш                                         └───────────────────────┘  Ш
 Ш ГСМ(рассчитанный по ставке 25 %):        &#'&&&&&&&&&&&&&&&&&.&& ^ Ш
 Ш НДС(рассчитанный по ставке 20 %):        &#'&&&&&&&&&&&&&&&&&.&& ^ Ш

 Ш                                         ┌───────────────────────┐  Ш
 Ш Всего к возмещению за транспорт:        │&#'&&&&&&&&&&&&&&&&&.&&│ ^  Ш
 Ш                                         └───────────────────────┘  Ш
 Ш НДС:                                     &#'&&&&&&&&&&&&&&&&&&.&& ^ Ш
.}
.{?internal;TotalSumma = 0
.FIELDS
   i2 k3
.ENDFIELDS
 Ш                                         ┌───────────────────────┐  Ш
 Ш Всего к оплате за нефтепродукты:        │ Б&#'&&&&&&&&&&&&&&&&&.&& Б│  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
 Ш                                         └───────────────────────┘  Ш
.{?Internal;((n2>0)or(c2>0)or(p2>0))
 Р                             в том числе: Р
.}
.{?Internal;(n2>0)
.FIELDS n1 n2 .ENDFIELDS
 Ш        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   Б&#'&&&&&&&&&&&&&&&&&.&& Б Ш
.}
.{?Internal;(c2>0)
.FIELDS c1 c2 .ENDFIELDS
 Ш        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   Б&#'&&&&&&&&&&&&&&&&&.&& Б Ш
.}
.{?Internal;(p2>0)
.FIELDS p1 p2 .ENDFIELDS
 Ш        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   Б&#'&&&&&&&&&&&&&&&&&.&& Б Ш
.}
.}

.begin
   Dog := if ( myview.getFirst BaseDoc where (( comp(BaseDocNrec) == BaseDoc.nRec )) = 0,
            myview.Dogovor.NoDoc +
            ' от ' + DateToStr ( myview.Dogovor.dDoc, 'DD/MM/YYYY' ),
            '' );
   Attr := if ( myview.getFirst AttrNam where ((        coBaseDoc  == AttrNam.wTable   and
                                                 'Месяц ресурса'   == AttrNam.Name     and
                                                        coBaseDoc  == AttrVal.wTable   and
                                                 comp(BaseDocNrec) == AttrVal.cRec     and
                                                 AttrNam.NRec      == AttrVal.cAttrNam )) = 0,
            myview.AttrVal.vString, '' );
 end.

.FIELDS
   post
   Dog
   Attr
   page_symb
.ENDFIELDS

 Щ    от ^ Щ
 Ш                                                                                                                                                                            Основание: договор №^
    Руководитель                                                                                                                                                            Месяц ресурса: ^
    предприятия  ____________________________ (Ф.И.О.)
                                                              м.п.
    Гл.бухгалтер ____________________________ (Ф.И.О.)

    Исполнитель  ____________________________ (Ф.И.О.) Ш

.if Delimiter
----------------------------------------------------------------------------------------------------------------------------
.end
^
.}
.endform
