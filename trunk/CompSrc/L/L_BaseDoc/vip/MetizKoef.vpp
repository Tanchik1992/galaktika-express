//******************************************************************************
// å•‚®ß

Create view VTMETIZ
  from
  SpecMTR
, SaldTune
, KatOtpEd
, SpOtpEd
, SpStep
, KatMC
  ;


//******************************************************************************

Function GetKoefOtpEdT (_cKoef : comp; _spstep : comp) : double;
{
  GetKoefOtpEdT := 1.0;

  if (VTMETIZ.GetFirst KatOtpEd where ((_cKoef == KatOtpEd.NRec)) = tsOk)
    GetKoefOtpEdT := VTMETIZ.KatOtpEd.Koef;
#ifdef __vschet__

  if (NOT ExistTune('Doc.ChTaraVolume.Koef'))
    Exit;

  if (wGetTune('Doc.ChTaraVolume.Koef') = 1)
    {
      var dKofOtp : double; dKofOtp := 1.0;
      var dKofUch : double; dKofUch := 1.0;

      if (VTMETIZ.GetFirst SpStep where ((_spstep == SpStep.nRec)) = tsOk)
        if (VTMETIZ.GetFirst SpecMTR where ((coSpStep            == SpecMTR.coTable
                                        and  VTMETIZ.SpStep.NRec == SpecMTR.cSpec)) = tsOk)
          if (VTMETIZ.GetFirst SaldTune where ((VTMETIZ.SpecMTR.cSaldTune == SaldTune.nRec)) = tsOk)
            if (UpCase(Trim(VTMETIZ.SaldTune.Name)) = 'íÄêÄ')
              if (VTMETIZ.SpStep.PrMC = 1)
                if (VTMETIZ.GetFirst KatMC where ((VTMETIZ.SpStep.cMcUsl == KatMC.NRec)) = tsOk)
                  {
                    if (VTMETIZ.GetFirst SpOtpEd where ((VTMETIZ.KatOtpEd.NRec  == SpOtpEd.cOtpEd
                                                     AND VTMETIZ.SpecMTR.cObj   == SpOtpEd.cMCTara)) = tsOk)
                      dKofOtp := VTMETIZ.SpOtpEd.Koef;

                    if (VTMETIZ.GetFirst KatOtpEd where ((word(1)             ==  KatOtpEd.PrMC
                                                     AND  VTMETIZ.KatMC.NRec  ==  KatOtpEd.cMCUsl
                                                     AND  VTMETIZ.KatMC.cEd   ==  KatOtpEd.cKatEd)) = tsOk)
                      if (VTMETIZ.GetFirst SpOtpEd where ((VTMETIZ.KatOtpEd.NRec == SpOtpEd.cOtpEd
                                                       AND VTMETIZ.SpecMTR.cObj  == SpOtpEd.cMCTara)) = tsOk)
                        dKofUch := VTMETIZ.SpOtpEd.Koef;

                    GetKoefOtpEdT := dKofUch/dKofOtp;
                  }
    }
#end
}
