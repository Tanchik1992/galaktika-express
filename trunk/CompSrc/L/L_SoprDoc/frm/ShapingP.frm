!╔════════════════════════════════════════════════════════════════════════════╗
!║                     (c) Корпорация ГАЛАКТИКА, 2002                         ║
!║ Проект        : ГАЛАКТИКА                                                  ║
!║ Система       : Оперативный контур: Управление снабжением                  ║
!║ Версия        : 5.8                                                        ║
!║ Назначение    : Протокол формирования цены                                 ║
!║ Разработал    : Макс Голдин                                                ║
!╚════════════════════════════════════════════════════════════════════════════╝

#doc
Протокол формирования цены
#end
.Set Name = 'ShapingPrice'
.Hide
#include format2.frn
.fields
  KatSopr_nRec :Comp

  номер_накладной
  дата_накладной :Date

  организация
  организация_УНН
  организация_ОКПО
  организация_ОКДП
  организация_Банк
  Наименование_организации

  Валюта
  СимВалюты

!.{
   наименование_мц
   баркод

   Единица_измерения

   количество_фактическое :Double

   Цена_за_единицу_МЦ :Double
   Стоимость_МЦ_Без_Налогов: Double

!!.{
    наименование_орг_налога_позиции_спецификации
    наименование_налога_позиции_спецификации
    Сумма_налога_позиции_спецификации :Double
!!.}

!!.{
    наименование_контрагента
    наименование_услуги
    Сумма_услуги :Double
    наименование_налога
    Сумма_налога :Double
!!.}

   Сопутствующие_услуги_основного_контрагента :Double
   Налоги_СУ_основного_контрагента :Double

   Сопутствующие_услуги_другого_контрагента :Double
   Налоги_СУ_другого_контрагента :Double

   НДС :Double
   Акциз :Double
   Нолог_с_продажи :Double
   Таможенные_пошлины :Double
   Остальные_налоги :Double
!.}
.endfields
KatSopr_nRec ^

номер_накладной  ^
дата_накладной   ^

организация               ^
организация_УНН           ^
организация_ОКПО          ^
организация_ОКДП          ^
организация_Банк          ^
Наименование_организации  ^

Валюта                    ^
СимВалюты                 ^

.{
-------------------------------------------------------------------------------
   наименование_мц    ^
   баркод             ^

   Единица_измерения  ^

   количество_фактическое                   &#'&&&&&&&&&&.&&&&&&&&&
   Цена_за_единицу_МЦ                       &#'&&&&&&&&&&.&&&&&&&&&
   Стоимость_МЦ_Без_Налогов                 &#'&&&&&&&&&&.&&&&&&&&&

.{
  +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  наименование_орг_налога_позиции_спецификации ^
  наименование_налога_позиции_спецификации  ^
  Сумма_налога_позиции_спецификации         &#'&&&&&&&&&&.&&&&&&&&&
  +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
.}

.{
    ===========================================================================
    наименование_контрагента  ^
    наименование_услуги       ^
    Сумма_услуги              &#'&&&&&&&&&&.&&&&&&&&&
    наименование_налога       ^
    Сумма_налога              &#'&&&&&&&&&&.&&&&&&&&&
    ===========================================================================
.}

   Сопутствующие_услуги_основного_контрагента  &#'&&&&&&&&&&.&&&&&&&&&
   Налоги_СУ_основного_контрагента             &#'&&&&&&&&&&.&&&&&&&&&

   Сопутствующие_услуги_другого_контрагента    &#'&&&&&&&&&&.&&&&&&&&&
   Налоги_СУ_другого_контрагента               &#'&&&&&&&&&&.&&&&&&&&&

   НДС                                         &#'&&&&&&&&&&.&&&&&&&&&
   Акциз                                       &#'&&&&&&&&&&.&&&&&&&&&
   Нолог_с_продажи                             &#'&&&&&&&&&&.&&&&&&&&&
   Таможенные_пошлины                          &#'&&&&&&&&&&.&&&&&&&&&
   Остальные_налоги                            &#'&&&&&&&&&&.&&&&&&&&&
.}
.endform



#doc
Обобщенный протокол формирования цены
#end
.LinkForm 'ShapingPrice_N1' prototype is 'ShapingPrice'
.NameInlist '1. Обобщенный протокол формирования цены'
.DEFO LANDSCAPE
.p 55
.Set Filler ='-'
.fields
  CommonFormHeader
.endfields
^
.var
  Nom :Word;
  lItog7, lItog8, lItog9, lItog10, lItog11, lItog12, lItog13, lItog14, lItog15 :Double;
  aItog7, aItog8, aItog9, aItog10, aItog11, aItog12, aItog13, aItog14, aItog15 :Double;
.endvar
.begin
  Nom := 0
end.
.fields
  'ПРОТОКОЛ ФОРМИРОВАНИЯ ЦЕН'
  'по спецификации накладной № ' +
   номер_накладной + ' от ' +
   DateToStr(дата_накладной, 'DD mon YYYY')

  организация
.endfields


 Щ@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@



Организация: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
.begin
  lItog7  := 0.0;
  lItog8  := 0.0;
  lItog9  := 0.0;
  lItog10 := 0.0;
  lItog11 := 0.0;
  lItog12 := 0.0;
  lItog13 := 0.0;
  lItog14 := 0.0;
  lItog15 := 0.0;

  aItog7  := 0.0;
  aItog8  := 0.0;
  aItog9  := 0.0;
  aItog10 := 0.0;
  aItog11 := 0.0;
  aItog12 := 0.0;
  aItog13 := 0.0;
  aItog14 := 0.0;
  aItog15 := 0.0;
end.
.{
.[h
.begin
  lItog7  := 0.0;
  lItog8  := 0.0;
  lItog9  := 0.0;
  lItog10 := 0.0;
  lItog11 := 0.0;
  lItog12 := 0.0;
  lItog13 := 0.0;
  lItog14 := 0.0;
  lItog15 := 0.0;
end.
.fields
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
.endfields
 Ш┌───┬──────────────────────────────────────────────────────┬─────────┬──────────┬──────────┬──────────────┬───────────────────────────────────────────────┬────────────────────────────────────────────────────────┐
│   │                       Товар                          │         │          │          │              │       Сопутствующие услуги, @~@@@@@@@@@       │                     Налоги по МЦ                       │
│ N°├────────────────────────────────────────┬─────────────┤ Единица │          │          │              ├───────────────────────┬───────────────────────┼──────────┬──────────┬──────────┬──────────┬────────────┤
│п/п│             Наименование               │     Код     │имерения │Количество│   Цена,  │    Сумма,    │ основного контрагента │  другого контрагента  │   НДС,   │  Акциз,  │   Налог  │Остальные │    Итого,  │
│   │                                        │             │         │          │@~@@@@@@@@│@~@@@@@@@@@@@@├────────────┬──────────┼────────────┬──────────┤@~@@@@@@@@│@~@@@@@@@@│ c продаж,│  налоги, │@~@@@@@@@@@@│
│   │                                        │             │         │          │          │              │   Сумма    │  Налоги  │   Сумма    │  Налоги  │          │          │@~@@@@@@@@│@~@@@@@@@@│            │
├───┼────────────────────────────────────────┼─────────────┼─────────┼──────────┼──────────┼──────────────┼────────────┼──────────┼────────────┼──────────┼──────────┼──────────┼──────────┼──────────┼────────────┤
│ 1 │                   2                    │      3      │    4    │    5     │    6     │      7       │     8      │     9    │     10     │   11     │    12    │    13    │    14    │    15    │     16     │
├───┼────────────────────────────────────────┼─────────────┼─────────┼──────────┼──────────┼──────────────┼────────────┼──────────┼────────────┼──────────┼──────────┼──────────┼──────────┼──────────┼────────────┤ Ш
.]h
.{
.}
.{
.}
.begin
  Nom := Nom + 1;

  lItog7  := lItog7  + Стоимость_МЦ_Без_Налогов;
  lItog8  := lItog8  + Round(Сопутствующие_услуги_основного_контрагента, wCena_Pr);
  lItog9  := lItog9  + Round(Налоги_СУ_основного_контрагента, wCena_Pr);
  lItog10 := lItog10 + Round(Сопутствующие_услуги_другого_контрагента, wCena_Pr);
  lItog11 := lItog11 + Round(Налоги_СУ_другого_контрагента, wCena_Pr);
  lItog12 := lItog12 + Round(НДС, wCena_Pr);
  lItog13 := lItog13 + Round(Акциз, wCena_Pr);
  lItog14 := lItog14 + Round(Нолог_с_продажи, wCena_Pr);
  lItog15 := lItog15 + Round(Остальные_налоги, wCena_Pr);

  aItog7  := aItog7  + Стоимость_МЦ_Без_Налогов;
  aItog8  := aItog8  + Round(Сопутствующие_услуги_основного_контрагента, wCena_Pr);
  aItog9  := aItog9  + Round(Налоги_СУ_основного_контрагента, wCena_Pr);
  aItog10 := aItog10 + Round(Сопутствующие_услуги_другого_контрагента, wCena_Pr);
  aItog11 := aItog11 + Round(Налоги_СУ_другого_контрагента, wCena_Pr);
  aItog12 := aItog12 + Round(НДС, wCena_Pr);
  aItog13 := aItog13 + Round(Акциз, wCena_Pr);
  aItog14 := aItog14 + Round(Нолог_с_продажи, wCena_Pr);
  aItog15 := aItog15 + Round(Остальные_налоги, wCena_Pr);
end.
.fields
  Nom

  наименование_мц
  баркод

  Единица_измерения

  DoubleToStr(количество_фактическое, Kol_Pr)
  DoubleToStr(Цена_за_единицу_МЦ, Cena_Pr)
  DoubleToStr(Стоимость_МЦ_Без_Налогов, Cena_Pr)

  DoubleToStr(Сопутствующие_услуги_основного_контрагента, Cena_Pr)
  DoubleToStr(Налоги_СУ_основного_контрагента, Cena_Pr)

  DoubleToStr(Сопутствующие_услуги_другого_контрагента, Cena_Pr)
  DoubleToStr(Налоги_СУ_другого_контрагента, Cena_Pr)

  DoubleToStr(НДС, Cena_Pr)
  DoubleToStr(Акциз, Cena_Pr)
  DoubleToStr(Нолог_с_продажи, Cena_Pr)
  DoubleToStr(Остальные_налоги, Cena_Pr)

  DoubleToStr(Round(НДС, wCena_Pr) +
              Round(Акциз, wCena_Pr) +
              Round(Нолог_с_продажи, wCena_Pr) +
              Round(Остальные_налоги, wCena_Pr)
              , Cena_Pr)
.endfields
 Ш│&&&│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│&&&&&&&&&&&&&│@~@@@@@@@│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│ Ш
.[f
.fields
  DoubleToStr(lItog7,  Cena_Pr)
  DoubleToStr(lItog8,  Cena_Pr)
  DoubleToStr(lItog9,  Cena_Pr)
  DoubleToStr(lItog10, Cena_Pr)
  DoubleToStr(lItog11, Cena_Pr)
  DoubleToStr(lItog12, Cena_Pr)
  DoubleToStr(lItog13, Cena_Pr)
  DoubleToStr(lItog14, Cena_Pr)
  DoubleToStr(lItog15, Cena_Pr)

  DoubleToStr(lItog12 +
              lItog13 +
              lItog14 +
              lItog15, Cena_Pr)
.endfields
 Ш└───┴────────────────────────────────────────┴─────────────┴─────────┴──────────┴──────────┼──────────────┼────────────┼──────────┼────────────┼──────────┼──────────┼──────────┼──────────┼──────────┼────────────┤ Ш
 Ш                                                                                           │&#'&&&&&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│ Ш
 Ш                                                                                           └──────────────┴────────────┴──────────┴────────────┴──────────┴──────────┴──────────┴──────────┴──────────┴────────────┘ Ш
.]f
.}
.fields
  DoubleToStr(aItog7,  Cena_Pr)
  DoubleToStr(aItog8,  Cena_Pr)
  DoubleToStr(aItog9,  Cena_Pr)
  DoubleToStr(aItog10, Cena_Pr)
  DoubleToStr(aItog11, Cena_Pr)
  DoubleToStr(aItog12, Cena_Pr)
  DoubleToStr(aItog13, Cena_Pr)
  DoubleToStr(aItog14, Cena_Pr)
  DoubleToStr(aItog15, Cena_Pr)

  DoubleToStr(aItog12 +
              aItog13 +
              aItog14 +
              aItog15, Cena_Pr)
  //DoubleToStr(aItog7  +
  //            aItog8  +
  //            aItog9  +
  //            aItog10 +
  //            aItog11 +
  //            aItog12 +
  //            aItog13 +
  //            aItog14 +
  //            aItog15, Cena_Pr)
.endfields
 Ш                                                                                           ┌──────────────┬────────────┬──────────┬────────────┬──────────┬──────────┬──────────┬──────────┬──────────┬────────────┐ Ш
 Ш                                                                                           │&#'&&&&&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│ Ш
 Ш                                                                                           └──────────────┴────────────┴──────────┴────────────┴──────────┴──────────┴──────────┴──────────┴──────────┴────────────┘ Ш
.endform



#doc
Обобщенный протокол формирования цены (с суммами)
#end
.LinkForm 'ShapingPrice_N1_1' prototype is 'ShapingPrice'
.NameInlist '1a. Обобщенный протокол формирования цены (с суммами)'
.DEFO LANDSCAPE
.p 55
.Set Filler ='-'
.fields
  CommonFormHeader
.endfields
^
.var
  Nom :Word;
  lItog7, lItog8, lItog9, lItog10, lItog11, lItog12, lItog13, lItog14, lItog15 :Double;
  aItog7, aItog8, aItog9, aItog10, aItog11, aItog12, aItog13, aItog14, aItog15 :Double;
.endvar
.begin
  Nom := 0
end.
.fields
  'ПРОТОКОЛ ФОРМИРОВАНИЯ ЦЕН'
  'по спецификации накладной № ' +
   номер_накладной + ' от ' +
   DateToStr(дата_накладной, 'DD mon YYYY')

  организация
.endfields


 Щ@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@



Организация: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
.begin
  lItog7  := 0.0;
  lItog8  := 0.0;
  lItog9  := 0.0;
  lItog10 := 0.0;
  lItog11 := 0.0;
  lItog12 := 0.0;
  lItog13 := 0.0;
  lItog14 := 0.0;
  lItog15 := 0.0;

  aItog7  := 0.0;
  aItog8  := 0.0;
  aItog9  := 0.0;
  aItog10 := 0.0;
  aItog11 := 0.0;
  aItog12 := 0.0;
  aItog13 := 0.0;
  aItog14 := 0.0;
  aItog15 := 0.0;
end.
.{
.[h
.begin
  lItog7  := 0.0;
  lItog8  := 0.0;
  lItog9  := 0.0;
  lItog10 := 0.0;
  lItog11 := 0.0;
  lItog12 := 0.0;
  lItog13 := 0.0;
  lItog14 := 0.0;
  lItog15 := 0.0;
end.
.fields
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
  СимВалюты
.endfields
 Ш┌───┬──────────────────────────────────────────────────────┬─────────┬──────────┬──────────┬──────────────┬───────────────────────────────────────────────┬────────────────────────────────────────────────────────┬──────────────┐
│   │                       Товар                          │         │          │          │              │       Сопутствующие услуги, @~@@@@@@@@@       │                     Налоги по МЦ                       │              │
│ N°├────────────────────────────────────────┬─────────────┤ Единица │          │          │              ├───────────────────────┬───────────────────────┼──────────┬──────────┬──────────┬──────────┬────────────┤              │
│п/п│             Наименование               │     Код     │имерения │Количество│   Цена,  │    Сумма,    │ основного контрагента │  другого контрагента  │   НДС,   │  Акциз,  │   Налог  │Остальные │    Итого,  │    Сумма,    │
│   │                                        │             │         │          │@~@@@@@@@@│@~@@@@@@@@@@@@├────────────┬──────────┼────────────┬──────────┤@~@@@@@@@@│@~@@@@@@@@│ c продаж,│  налоги, │@~@@@@@@@@@@│@~@@@@@@@@@@@@│
│   │                                        │             │         │          │          │              │   Сумма    │  Налоги  │   Сумма    │  Налоги  │          │          │@~@@@@@@@@│@~@@@@@@@@│            │              │
├───┼────────────────────────────────────────┼─────────────┼─────────┼──────────┼──────────┼──────────────┼────────────┼──────────┼────────────┼──────────┼──────────┼──────────┼──────────┼──────────┼────────────┼──────────────┤
│ 1 │                   2                    │      3      │    4    │    5     │    6     │      7       │     8      │     9    │     10     │   11     │    12    │    13    │    14    │    15    │     16     │      17      │
├───┼────────────────────────────────────────┼─────────────┼─────────┼──────────┼──────────┼──────────────┼────────────┼──────────┼────────────┼──────────┼──────────┼──────────┼──────────┼──────────┼────────────┼──────────────┤ Ш
.]h
.{
.}
.{
.}
.begin
  Nom := Nom + 1;

  lItog7  := lItog7  + Стоимость_МЦ_Без_Налогов;
  lItog8  := lItog8  + Round(Сопутствующие_услуги_основного_контрагента, wCena_Pr);
  lItog9  := lItog9  + Round(Налоги_СУ_основного_контрагента, wCena_Pr);
  lItog10 := lItog10 + Round(Сопутствующие_услуги_другого_контрагента, wCena_Pr);
  lItog11 := lItog11 + Round(Налоги_СУ_другого_контрагента, wCena_Pr);
  lItog12 := lItog12 + Round(НДС, wCena_Pr);
  lItog13 := lItog13 + Round(Акциз, wCena_Pr);
  lItog14 := lItog14 + Round(Нолог_с_продажи, wCena_Pr);
  lItog15 := lItog15 + Round(Остальные_налоги, wCena_Pr);

  aItog7  := aItog7  + Стоимость_МЦ_Без_Налогов;
  aItog8  := aItog8  + Round(Сопутствующие_услуги_основного_контрагента, wCena_Pr);
  aItog9  := aItog9  + Round(Налоги_СУ_основного_контрагента, wCena_Pr);
  aItog10 := aItog10 + Round(Сопутствующие_услуги_другого_контрагента, wCena_Pr);
  aItog11 := aItog11 + Round(Налоги_СУ_другого_контрагента, wCena_Pr);
  aItog12 := aItog12 + Round(НДС, wCena_Pr);
  aItog13 := aItog13 + Round(Акциз, wCena_Pr);
  aItog14 := aItog14 + Round(Нолог_с_продажи, wCena_Pr);
  aItog15 := aItog15 + Round(Остальные_налоги, wCena_Pr);
end.
.fields
  Nom

  наименование_мц
  баркод

  Единица_измерения

  DoubleToStr(количество_фактическое, Kol_Pr)
  DoubleToStr(Цена_за_единицу_МЦ, Cena_Pr)
  DoubleToStr(Стоимость_МЦ_Без_Налогов, Cena_Pr)

  DoubleToStr(Сопутствующие_услуги_основного_контрагента, Cena_Pr)
  DoubleToStr(Налоги_СУ_основного_контрагента, Cena_Pr)

  DoubleToStr(Сопутствующие_услуги_другого_контрагента, Cena_Pr)
  DoubleToStr(Налоги_СУ_другого_контрагента, Cena_Pr)

  DoubleToStr(НДС, Cena_Pr)
  DoubleToStr(Акциз, Cena_Pr)
  DoubleToStr(Нолог_с_продажи, Cena_Pr)
  DoubleToStr(Остальные_налоги, Cena_Pr)

  DoubleToStr(Round(НДС, wCena_Pr) +
              Round(Акциз, wCena_Pr) +
              Round(Нолог_с_продажи, wCena_Pr) +
              Round(Остальные_налоги, wCena_Pr)
              , Cena_Pr)
  DoubleToStr(Стоимость_МЦ_Без_Налогов +
              Round(НДС, wCena_Pr) +
              Round(Акциз, wCena_Pr) +
              Round(Нолог_с_продажи, wCena_Pr) +
              Round(Остальные_налоги, wCena_Pr) +
              Round(Сопутствующие_услуги_основного_контрагента, wCena_Pr) +
              Round(Налоги_СУ_основного_контрагента, wCena_Pr) +
              Round(Сопутствующие_услуги_другого_контрагента, wCena_Pr) +
              Round(Налоги_СУ_другого_контрагента, wCena_Pr)
              , Cena_Pr)
.endfields
 Ш│&&&│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│&&&&&&&&&&&&&│@~@@@@@@@│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&&&&&│ Ш
.[f
.fields
  DoubleToStr(lItog7,  Cena_Pr)
  DoubleToStr(lItog8,  Cena_Pr)
  DoubleToStr(lItog9,  Cena_Pr)
  DoubleToStr(lItog10, Cena_Pr)
  DoubleToStr(lItog11, Cena_Pr)
  DoubleToStr(lItog12, Cena_Pr)
  DoubleToStr(lItog13, Cena_Pr)
  DoubleToStr(lItog14, Cena_Pr)
  DoubleToStr(lItog15, Cena_Pr)

  DoubleToStr(lItog12 +
              lItog13 +
              lItog14 +
              lItog15, Cena_Pr)
  DoubleToStr(lItog7  +
              lItog8  +
              lItog9  +
              lItog10 +
              lItog11 +
              lItog12 +
              lItog13 +
              lItog14 +
              lItog15, Cena_Pr)
.endfields
 Ш└───┴────────────────────────────────────────┴─────────────┴─────────┴──────────┴──────────┼──────────────┼────────────┼──────────┼────────────┼──────────┼──────────┼──────────┼──────────┼──────────┼────────────┼──────────────│ Ш
 Ш                                                                                           │&#'&&&&&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&&&&&│ Ш
 Ш                                                                                           └──────────────┴────────────┴──────────┴────────────┴──────────┴──────────┴──────────┴──────────┴──────────┴────────────┴──────────────┘ Ш
.]f
.}
.fields
  DoubleToStr(aItog7,  Cena_Pr)
  DoubleToStr(aItog8,  Cena_Pr)
  DoubleToStr(aItog9,  Cena_Pr)
  DoubleToStr(aItog10, Cena_Pr)
  DoubleToStr(aItog11, Cena_Pr)
  DoubleToStr(aItog12, Cena_Pr)
  DoubleToStr(aItog13, Cena_Pr)
  DoubleToStr(aItog14, Cena_Pr)
  DoubleToStr(aItog15, Cena_Pr)

  DoubleToStr(aItog12 +
              aItog13 +
              aItog14 +
              aItog15, Cena_Pr)
  DoubleToStr(aItog7  +
              aItog8  +
              aItog9  +
              aItog10 +
              aItog11 +
              aItog12 +
              aItog13 +
              aItog14 +
              aItog15, Cena_Pr)
.endfields
 Ш                                                                                           ┌──────────────┬────────────┬──────────┬────────────┬──────────┬──────────┬──────────┬──────────┬──────────┬────────────┬──────────────┐ Ш
 Ш                                                                                           │&#'&&&&&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&│&#'&&&&&&&&&│&#'&&&&&&&&&&&│ Ш
 Ш                                                                                           └──────────────┴────────────┴──────────┴────────────┴──────────┴──────────┴──────────┴──────────┴──────────┴────────────┴──────────────┘ Ш
.endform



#doc
Подробный протокол формирования цены
#end
.LinkForm 'ShapingPrice_N2' prototype is 'ShapingPrice'
.NameInlist '2. Подробный протокол формирования цены'
.DEFO LANDSCAPE
.p 55
.Set Filler ='-'
.fields
  CommonFormHeader
.endfields
^
.var
  Nom :Word;
  ItogoNalogMC,
  ItogoSumUslOrg,
  ItogoNalogUslOrg :Double;
  NameOrg :String;
.endvar
.fields
  'ПРОТОКОЛ ФОРМИРОВАНИЯ ЦЕН'
  'по спецификации накладной № ' +
   номер_накладной + ' от ' +
   DateToStr(дата_накладной, 'DD mon YYYY')

  организация

  //шапка
  СимВалюты
  СимВалюты

!.{
   Nom

   наименование_мц
   баркод

   Единица_измерения

   DoubleToStr(количество_фактическое, Kol_Pr)
   DoubleToStr(Цена_за_единицу_МЦ, Cena_Pr)
   DoubleToStr(Стоимость_МЦ_Без_Налогов, Cena_Pr)
.endfields


 Щ@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@~@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@



Организация: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Щ
.begin
  Nom     := 0;
  NameOrg := '';
end.
.{
.[h
 Ш┌───┬───────────────────────────────────────────────┬─────────┬──────────┬──────────┬──────────────┬───────────────────────────────────┬─────────────────────────────────────────┬─────────────────────────────────┐ Ш
 Ш│ N°│                    Товар                      │ Единица │          │          │              │                                   │                 Услуга                  │             Налог               │ Ш
 Ш│п/п├─────────────────────────────────┬─────────────┤имерения │Количество│   Цена,  │    Сумма,    │            Контрагент             ├────────────────────────────┬────────────┼────────────────────┬────────────┤ Ш
 Ш│   │         Наименование            │     Код     │         │          │@~@@@@@@@@│@~@@@@@@@@@@@@│                                   │        Наименование        │   Сумма    │    Наименование    │   Сумма    │ Ш
 Ш├───┼─────────────────────────────────┼─────────────┼─────────┼──────────┼──────────┼──────────────┼───────────────────────────────────┼────────────────────────────┼────────────┼────────────────────┼────────────┤ Ш
 Ш│ 1 │               2                 │      3      │    4    │    5     │    6     │      7       │                8                  │             9              │     10     │         11         │     12     │ Ш
 Ш└───┴─────────────────────────────────┴─────────────┴─────────┴──────────┴──────────┴──────────────┴───────────────────────────────────┴────────────────────────────┴────────────┴────────────────────┴────────────┘ Ш
.]h
.begin
  Nom := Nom + 1;

  ItogoNalogMC := 0.0;
end.
 Ш &&& @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &&&&&&&&&&&&& @~@@@@@@@ &'&&&&&&&& &'&&&&&&&& &'&&&&&&&&&&&& Ш
!------------------------------------------------------------------------------
!---------------------------- Цикл по налогам МЦ ------------------------------
!------------------------------------------------------------------------------
.{
.{?Internal; (NameOrg <> наименование_орг_налога_позиции_спецификации) and (NameOrg <> '')
.{?Internal; (ItogoNalogMC > 0.00001)
.fields
  DoubleToStr(ItogoNalogMC, Cena_Pr)
.endfields
 Ш                                                                                 БИтого налогов по МЦ                                                                                                 &'&&&&&&&&&&&&& Б Ш
.}
.begin
  NameOrg := наименование_орг_налога_позиции_спецификации;
  ItogoNalogMC   := 0.0;
end.
.}
.{?Internal; (Сумма_налога_позиции_спецификации > 0.00001)
.fields
  наименование_орг_налога_позиции_спецификации

  наименование_налога_позиции_спецификации
  DoubleToStr(Сумма_налога_позиции_спецификации, Cena_Pr)
.endfields
.begin
  NameOrg := наименование_орг_налога_позиции_спецификации;
  ItogoNalogMC := ItogoNalogMC + Round(Сумма_налога_позиции_спецификации, wCena_Pr);
end.
 Ш                                                                                                    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                           @@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&& Ш
.}
.}
 Ш!------------------------------------------------------------------------------
!--------------------------- Итого налогов по МЦ ------------------------------
!------------------------------------------------------------------------------ Ш
.{?Internal; (ItogoNalogMC > 0.00001)
.fields
  DoubleToStr(ItogoNalogMC, Cena_Pr)
.endfields
 Ш                                                                                 БИтого налогов по МЦ                                                                                                 &'&&&&&&&&&&&&& Б Ш
.}
.begin
  ItogoSumUslOrg   := 0.0;
  ItogoNalogUslOrg := 0.0;
  NameOrg := '';
end.
 Ш!------------------------------------------------------------------------------
!------------------------- Цикл по СУ и их налогам ----------------------------
!------------------------------------------------------------------------------ Ш
.{
 Ш!..............................................................................
!................. Итого услуг и их налогов по Контрагенту ....................
!.............................................................................. Ш
.{?Internal; (NameOrg <> наименование_контрагента) and (NameOrg <> '')
.{?Internal; (ItogoSumUslOrg > 0.00001) or (ItogoNalogUslOrg > 0.00001)
.fields
  NameOrg

  DoubleToStr(ItogoSumUslOrg,   Cena_Pr)
  DoubleToStr(ItogoNalogUslOrg, Cena_Pr)
.endfields
 Ш                                                                            БИтого услуг и налогов по @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                       &'&&&&&&&&&&&&&&&&&                 &'&&&&&&&&&&&&&&& Б Ш
.}
.begin
  NameOrg          := наименование_контрагента;

  ItogoSumUslOrg   := 0.0;
  ItogoNalogUslOrg := 0.0;
end.
.}
!..............................................................................
.begin
  if NameOrg = ''
   {
    NameOrg          := наименование_контрагента;

    ItogoSumUslOrg   := 0.0;
    ItogoNalogUslOrg := 0.0;
   }

  ItogoSumUslOrg   := ItogoSumUslOrg   +
                      if(наименование_налога <> '',
                         0.0,
                         Round(Сумма_услуги, wCena_Pr));
  ItogoNalogUslOrg := ItogoNalogUslOrg +
                      if(Сумма_налога < 0.00001,
                         0.0,
                         Round(Сумма_налога, wCena_Pr));
end.
.fields
  наименование_контрагента
  наименование_услуги
  if(наименование_налога <> '', '', DoubleToStr(Сумма_услуги, Cena_Pr))

  наименование_налога
  if(Сумма_налога < 0.00001,    '', DoubleToStr(Сумма_налога, Cena_Pr))
.endfields
 Ш                                                                                                    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&& @@@@@@@@@@@@@@@@@@@@ &'&&&&&&&&&& Ш
.}
 Ш!------------------------------------------------------------------------------
!------------------------------------------------------------------------------
!..............................................................................
!................. Итого услуг и их налогов по Контрагенту ....................
!.............................................................................. Ш
.{?Internal; ((ItogoSumUslOrg > 0.00001) or (ItogoNalogUslOrg > 0.00001))
.fields
  NameOrg

  DoubleToStr(ItogoSumUslOrg,   Cena_Pr)
  DoubleToStr(ItogoNalogUslOrg, Cena_Pr)
.endfields
 Ш                                                                            БИтого услуг и налогов по @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                       &'&&&&&&&&&&&&&&&&&                 &'&&&&&&&&&&&&&&& Б Ш
.begin
  NameOrg := '';

  ItogoSumUslOrg   := 0.0;
  ItogoNalogUslOrg := 0.0;
end.
.}
 Ш!.............................................................................. Ш
.}
.endform
