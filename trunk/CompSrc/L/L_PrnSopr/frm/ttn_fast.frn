.begin
  if (NOT isTTN_Fast)
    Exit;

  var koef, sNDS : double;

  if FASTREPORT.getfirst SpSopr where ((спецификацияМЦ_нрек == SpSopr.Nrec)) <> tsOk
    Exit;

  if (FASTREPORT.SpSopr.PrMc = 1)
  {
    if FASTREPORT.getfirst KatMC  where ((FASTREPORT.SpSopr.cMCUSL == KatMC.Nrec )) <> tsOK
      Exit;
  }
  else
    if FASTREPORT.getfirst KatUsl where ((FASTREPORT.SpSopr.cMCUSL == KatUsl.Nrec )) <> tsOK
      Exit;

  if Define_TTN_2001F or Define_TTN_2009F
  {
    Дополнительная_информация := MCDopInfo [FASTREPORT.SpSopr.Npp];
  #ifdef _TTN_ALC_
    страна_ввоза              := MCStrana  [FASTREPORT.SpSopr.Npp];
  #end
  }

  Название    :=  if (FASTREPORT.SpSopr.PrMc = 1, FASTREPORT.KatMC.Name, FASTREPORT.KatUsl.Name);
  КолФ        :=  FASTREPORT.SpSopr.KolFact;
  КолОпл      :=  FASTREPORT.SpSopr.KolOpl;

  if (FASTREPORT.SpSopr.PrMc = 1)
    case KatSoprVidSopr of
      521,522,523,600..606,106,206:
      {
         МассаМц     :=  FASTREPORT.KatMc.Massa;
         МассаТарыМц :=  FASTREPORT.KatMc.MTara;
      }
      else
      {
        МассаМц     :=  FASTREPORT.SpSopr.Netto;
        МассаТарыМц :=  FASTREPORT.SpSopr.MTara;
      }
    end;

 #ifdef _IN_VAL_DOC_
  if Валюта_нрек <> comp(0)
    СтНак := FASTREPORT.SpSopr.VPrice * КолФ
  else
    СтНак := FASTREPORT.SpSopr.Price * КолФ;
 #else
  СтНац := FASTREPORT.SpSopr.Price * КолФ;
 #end

  if FASTREPORT.getfirst KatOtpEd where ((FASTREPORT.SpSopr.cOtpEd == KatOtpEd.NRec)) = tsOK
  {
    koef  := if (FASTREPORT.KatOtpEd.koef = 0, 1, FASTREPORT.KatOtpEd.koef);
    ОтпЕд := FASTREPORT.KatOtpEd.Name
  }
  else
    koef := 1;

  КолВес := КолФ * Koef * (FASTREPORT.KatMC.Massa + FASTREPORT.KatMC.mTara)

  if FASTREPORT.getfirst KatEd where (( if (FASTREPORT.SpSOpr.PrMc = 1,
                                            FASTREPORT.KatMC.cEd,
                                            FASTREPORT.KatUsl.cEd) == KatEd.NRec )) = tsOK
    УчЕд := FASTREPORT.KatEd.Name;

  if (Define_Torg12_F or Define_TTN_2001F or Define_TTN_2009F)
  {
    sNDS := 0;

    if FASTREPORT.GetFirst SpDocNal where (( спецификацияМЦ_нрек == SpDocNal.cSpDoc   and
                                             KatSoprVidSopr      == SpDocNal.TipDoc )) = tsOk
      do
      {
        if FASTREPORT.SpDocNal.cNalog = NalogNDS //эту переменную нужно определить и вычислить в форме
        {
          ставка_первого_налога := FASTREPORT.SpDocNal.Nalog;
         #ifdef _IN_VAL_DOC_
          if Валюта_нрек <> comp(0)
            sNDS := sNDS + FASTREPORT.SpDocNal.SumVal
          else
            sNDS := sNDS + FASTREPORT.SpDocNal.Summa;
         #else
          sNDS := sNDS + FASTREPORT.SpDocNal.Summa;
         #end
        }
      }
      while FASTREPORT.GetNext SpDocNal where ((спецификацияМЦ_нрек == SpDocNal.cSpDoc  and
                                                KatSoprVidSopr      == SpDocNal.TipDoc )) = tsOk

     #ifdef _IN_VAL_DOC_
      if Валюта_нрек <> comp(0)
        СтНДСНак := sNDS
      else
        СтНДСНак := sNDS
     #else
      СтНДСНац0 := sNDS
     #end
  }//endif define

  КодМЦ :=  if (FASTREPORT.SpSOpr.PrMc = 1, FASTREPORT.KatMC.BarKod, FASTREPORT.KatUsl.Kod);
  КолУч :=  КолФ * koef;

 #ifdef _IN_VAL_DOC_
  if Валюта_нрек <> comp(0)
  {
    ЦНакБНУч   :=  FASTREPORT.SpSopr.VPrice / koef;
    СтНакСН    :=  FASTREPORT.SpSopr.VPrice * КолФ
  }
  else
  {
    ЦНакБНУч   :=  FASTREPORT.SpSopr.Price / koef;
    СтНакСН    :=  FASTREPORT.SpSopr.Price * КолФ;
  }
 #else
  ЦНацБНУч   :=  FASTREPORT.SpSopr.Price / koef;
  СтНацСН0   :=  FASTREPORT.SpSopr.Price * КолФ;
 #end

  if (Define_Torg12_F or Define_TTN_2001F or Define_TTN_2009F)
   #ifdef _IN_VAL_DOC_
    if Валюта_нрек <> comp(0)
      СтНакБН    :=  FASTREPORT.SpSopr.VPrice * КолФ
    else
      СтНакБН    :=  FASTREPORT.SpSopr.Price * КолФ;
   #else
    СтНацБН0   :=  FASTREPORT.SpSopr.Price * КолФ;
   #end

  if (КолФ <> 0)
    if (KatSoprVhodNal = 1) //эту переменную нужно определить и вычислить в форме
    {
     #ifdef _IN_VAL_DOC_
      if Валюта_нрек <> comp(0)
        ЦНакБНУч := FRoundVal2 ((FASTREPORT.SpSopr.VPrice -
                                 FASTREPORT.SpSopr.SumVNDS/КолФ)/koef);
      else
        ЦНакБНУч := FRoundRub2 ((FASTREPORT.SpSopr.Price -
                                 FASTREPORT.SpSopr.SumNDS/КолФ)/koef);

     #else
      {
        ЦНацБНУч := FRoundRub2 ((FASTREPORT.SpSopr.Price -
                                 FASTREPORT.SpSopr.SumNDS/КолФ)/koef);
        ЦНацСН := FASTREPORT.SpSopr.Price;
      }
     #end

      if (Define_Torg12_F or Define_TTN_2001F or Define_TTN_2009F)
     #ifdef _IN_VAL_DOC_
        if Валюта_нрек <> comp(0)
          СтНакБН  := FRoundVal2 (СтНакБН - FASTREPORT.SpSopr.SumVNDS);
        else
          СтНакБН  := FRoundRub2 (СтНакБН - FASTREPORT.SpSopr.SumNDS);
     #else
        СтНацБН0 := FRoundRub2 (СтНацБН0 - FASTREPORT.SpSopr.SumNDS);
     #end
    }
    else
    {
     #ifdef _IN_VAL_DOC_
      if Валюта_нрек <> comp(0)
        СтНакСН  := FRoundVal2 (СтНакСН + FASTREPORT.SpSopr.SumVNDS);
      else
        СтНакСН  := FRoundRub2 (СтНакСН + FASTREPORT.SpSopr.SumNDS);
     #else
      СтНацСН0 := FRoundRub2 (СтНацСН0 + FASTREPORT.SpSopr.SumNDS);
      ЦНацСН := FASTREPORT.SpSopr.Price + FASTREPORT.SpSopr.SumNDS/КолФ;
     #end
    }

  if (Define_TTN_2001F or Define_TTN_2009F)
  {
    КОЛ_ГРУЗОВЫХ_МЕСТ := FASTREPORT.SpSopr.KolGrM;

    if FASTREPORT.getfirst KatOtpEd where ((FASTREPORT.SpSopr.cOtpEdGRM == KatOtpEd.NRec)) = tsOK
      ЕД_ИЗМЕРЕНИЯ_ГРУЗОВЫХ_МЕСТ := FASTREPORT.KatOtpEd.Name;

    if FASTREPORT.getfirst KatParty where ((FASTREPORT.SpSopr.cParty == KatParty.NRec)) = tsOK
      Номер_сертификата := FASTREPORT.KatParty.NSertif
  }

end.
