/*
╔═══════════════════════════════════════════════════════════════════════════╗
║                     (c) 1994,2000 корпорация ГАЛАКТИКА                    ║
║ Проект        : ГАЛАКТИКА                                                 ║
║ Система       : Оперативный контур                                        ║
║ Версия        : 5.73                                                      ║
║ Назначение    : Печать счетов-фактур (бланки СФ, с 01.01.2001)            ║
║ Ответственный : Полежай Алексей Геннадьевич                               ║
║ Параметры     : нет                                                       ║
╚═══════════════════════════════════════════════════════════════════════════╝
*/
#doc
Счет-фактура (формат A4, стандарт1)
#end
.linkform 'Schfrees_41' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4, стандарт1)'
.Group 'Бланки счетов-фактур (c 01.01.2001)'
!-------------------------------------------------------------------
.create view vSpSchf
from
  SpSchf  ,
  KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  StrPrim1, StrPrim2 : String;
.endvar
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1, MyOrgName, OrgName)
  If (Direct = 1, MyOrgAddr, OrgAddr)
  If (Direct = 1 ,MyOrgINN, OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat) <> 0, DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1, MyOrgName, OrgName)
  if (Direct <> 1, MyOrgAddr, OrgAddr)
  if (Direct <> 1, MyOrgINN, OrgINN)
.endfields

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер продавца (ИНН)    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
 И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌─────────────────────┬────────┬──────────┬────────────┬─────────────┬───────────┬──────┬────────────┬─────────────┬─────────────┬──────────┬────────┐ Ш
 Ш│ Наименование товара │Единица │Количество│   Цена     │  Стоимость  │В том числе│Нало- │Сумма налога│  Стоимость  │Сумма налога │  Страна  │ Номер  │ Ш
 Ш│(описание выполненных│измере- │          │ (тариф) за │товаров (ра- │   акциз   │говая │            │товаров (ра- │  с продаж   │ происхож-│грузовой│ Ш
 Ш│ работ, оказанных    │  ния   │          │ единицу из-│бот, услуг), │           │ставка│            │бот, услуг), │             │   дения  │таможен-│ Ш
 Ш│ услуг)              │        │          │ мерения    │ всего без   │           │      │            │всего с уче- │             │          │ной дек-│ Ш
 Ш│                     │        │          │            │  налога     │           │      │            │ том налога  │             │          │ларации │ Ш
 Ш├─────────────────────┼────────┼──────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼─────────────┼──────────┼────────┤ Ш
 Ш│          1          │    2   │     3    │      4     │      5      │     6     │   7  │      8     │      9      │      10     │     11   │   12   │ Ш
 Ш├─────────────────────┼────────┼──────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼─────────────┼──────────┼────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{table 'vSpSchf.SpSchf'
.fields
  SpName
  if (SpPrMC = 3, '', SpOtpEd)
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '')
  SpNDS
  SpSumma
  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&&&.&&│@@@@@@@@@@│@~@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ', '') + PlatNazn
  s1
  SAkciz
  if (abs(s3) >= 0.01, string(Stav1, 3, 0) + ' %', '')
  s2
  s3
  dblSaleTax
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│        │          │            │&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&&&.&&│          │        │ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  s4
  string(Stav2, 3, 0) + ' %'
  s5
  s6
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│             │          │        │ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  s23
  string(Stav3, 3, 0) + ' %'
  s8
  s9
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│             │          │        │ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  s7
  s7
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │      │            │&#&&&&&&&&.&&│             │          │        │ Ш
.}
.fields
  if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7)
  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
.endfields
 Ш├─────────────────────┴────────┴──────────┴────────────┴─────────────┴───────────┴──────┼────────────┼─────────────┼─────────────┴──────────┴────────┘ Ш
 Ш│  Всего к оплате                                       &#&&&&&&&&.&& &#&&&&&&.&&       │&#&&&&&&&.&&│&#&&&&&&&&.&&│                                   Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────┴────────────┴─────────────┘                                   Ш
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Главный бухгалтер                                               ^

       М.П.


       Выдал
       (подпись ответственного лица от продавца)
        Ш
.begin
  // Для России
  if (wCountry = 0)
  {
    StrPrim1 := ' ';
    StrPrim2 := 'Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
  else
  {
    StrPrim1 := '1. Без печати недействителен.';
    StrPrim2 := '2. Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
end.
.fields
   StrPrim1
   StrPrim2
.endfields
        БПримечания. Б ^
       ^

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------

#doc
Счет-фактура (формат A3)
#end
.linkform 'Schfrees_42' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A3)'
.Group 'Бланки счетов-фактур (c 01.01.2001)'
!-------------------------------------------------------------------
.create view vSpSchf
from
 SpSchf  ,
 KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  StrPrim1, StrPrim2 : String;
.endvar
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact) <> 0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1, MyOrgName, OrgName)
  if (Direct = 1, MyOrgAddr, OrgAddr)
  if (Direct = 1, MyOrgINN, OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat) <> 0, DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1, MyOrgName, OrgName)
  if (Direct <> 1, MyOrgAddr, OrgAddr)
  if (Direct <> 1, MyOrgINN, OrgINN)
.endfields

                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д

 Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Идентификационный номер продавца (ИНН)    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
 Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Р┌────────────────────────┬──────────┬────────────┬───────────────┬─────────────────┬─────────────┬──────┬───────────────┬─────────────────┬───────────────┬─────────────┬────────┐ Р
 Р│  Наименование товара   │ Единица  │ Количество │     Цена      │    Стоимость    │ В том числе │Нало- │  Сумма налога │    Стоимость    │  Сумма налога │   Страна    │ Номер  │ Р
 Р│ (описание выполненных  │измерения │            │   (тариф) за  │ товаров (работ, │    акциз    │говая │               │ товаров (работ, │   с продаж    │происхождения│грузовой│ Р
 Р│  работ, оказанных      │          │            │  единицу из-  │ услуг), всего   │             │ставка│               │ услуг), всего   │               │             │таможен-│ Р
 Р│  услуг)                │          │            │    мерения    │   без налога    │             │      │               │ с учетом налога │               │             │ной дек-│ Р
 Р│                        │          │            │               │                 │             │      │               │                 │               │             │ларации │ Р
 Р├────────────────────────┼──────────┼────────────┼───────────────┼─────────────────┼─────────────┼──────┼───────────────┼─────────────────┼───────────────┼─────────────┼────────┤ Р
 Р│           1            │     2    │      3     │        4      │        5        │      6      │   7  │        8      │         9       │       10      │      11     │   12   │ Р
 Р├────────────────────────┼──────────┼────────────┼───────────────┼─────────────────┼─────────────┼──────┼───────────────┼─────────────────┼───────────────┼─────────────┼────────┤ Р
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{ table 'vSpSchf.SpSchf'
.fields
  SpName
  if (SpPrMC = 3, '', SpOtpEd)
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '')
  SpNDS
  SpSumma
  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Р│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@@│@#@@@@@@@@@@│&#&&&&&&&&&&.&&│&#&&&&&&&&&&&&.&&│&#&&&&&&&&.&&│@~#@@@│&#&&&&&&&&&&.&&│&#&&&&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@@@@@@@@@@@@@│@~@@@@@@│ Р
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ', '') + PlatNazn
  s1
  SAkciz
  if (abs(s3) >= 0.01, string(Stav1, 3, 0) + ' %', '')
  s2
  s3
  dblSaleTax
.endfields
 Р│@@@@@@@@@@@@@@@@@@@@@@@@│          │            │               │&#&&&&&&&&&&&&.&&│&#&&&&&&&&.&&│@~#@@@│&#&&&&&&&&&&.&&│&#&&&&&&&&&&&&.&&│&#&&&&&&&&&&.&&│             │        │ Р
.}
.{?internal; ( (Abs(S6) > 0.01) and (SubTip >= 16) )
.fields
  s4
  string(Stav2, 3, 0) + ' %'
  s5
  s6
.endfields
 Р│                        │          │            │               │&#&&&&&&&&&&&&.&&│             │@~#@@@│&#&&&&&&&&&&.&&│&#&&&&&&&&&&&&.&&│               │             │        │ Р
.}
.{?internal; ( (Abs(S9) > 0.01) and (SubTip >= 16) )
.fields
  s23
  string(Stav3, 3, 0) + ' %'
  s8
  s9
.endfields
 Р│                        │          │            │               │&#&&&&&&&&&&&&.&&│             │@~#@@@│&#&&&&&&&&&&.&&│&#&&&&&&&&&&&&.&&│               │             │        │ Р
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  s7
  s7
.endfields
 Р│                        │          │            │               │&#&&&&&&&&&&&&.&&│             │      │               │&#&&&&&&&&&&&&.&&│               │             │        │ Р
.}
.fields
   if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7)
   if (bSumEqual, rAkcis, SAkciz)
   if (bSumEqual, rNDS, S2+S5)
   if (bSumEqual, rSumma, S)
//   if (bSumEqual, rSaleTax, dblSaleTax)
.endfields
 Р├────────────────────────┴──────────┴────────────┴───────────────┴─────────────────┴─────────────┴──────┼───────────────┼─────────────────┼───────────────┴─────────────┴────────┘ Р
 Р│  Всего к оплате                                                 &#&&&&&&&&&&&&.&& &#&&&&&&&&.&&       │&#&&&&&&&&&&.&&│&#&&&&&&&&&&&&.&&│                                        Р
 Р└───────────────────────────────────────────────────────────────────────────────────────────────────────┴───────────────┴─────────────────┘                                        Р
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Главный бухгалтер                                               ^

       М.П.


       Выдал
       (подпись ответственного лица от продавца)
        Ш
.begin
  // Для России
  if (wCountry = 0)
  {
    StrPrim1 := ' ';
    StrPrim2 := 'Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
  else
  {
    StrPrim1 := '1. Без печати недействителен.';
    StrPrim2 := '2. Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
end.
.fields
   StrPrim1
   StrPrim2
.endfields
        БПримечания. Б ^
       ^

.} // Schf
.endform

!-------------------------------------------------------------------------------------

#doc
Счет-фактура с номерами вагонов (формат A4)
#end
.linkform 'Schfrees_43' prototype is 'Schfrees'
.NameInList 'Счет-фактура с номерами вагонов (формат A4)'
.Group 'Бланки счетов-фактур (c 01.01.2001)'
!-------------------------------------------------------------------
.create view vSpSchf
var
  SchFactNRec : comp;
as select
  SpSchf.*
from
  SpSchf  ,
  KatParty
 where
((
      SchFactNRec == SpSchf.cSchFact
))
;
!-------------------------------------------------------------------
.var
  NumVagon: array[1..3] of string;
  sNumVagon : string;
  i, k, j : integer;
  rNDS, rSumNoNDS, rSaleTax,
  rAkcis, rSumma: double;
  StrPrim1, StrPrim2 : String;
.endvar
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  i := 1;
  NumVagon[1] := '';
  vSpSchf.SchFactNRec := nSchFact;
  if (vSpSchf.GetFirst SpSchf = 0)
    do
    {
      if (Length(NumVagon[i])+Length(vSpSchf.SpSchf.ss[2])) > 255
      {
        i := i + 1;
        NumVagon[i] := '';
      };
      if (InStr(vSpSchf.SpSchf.ss[2], NumVagon[i]) > 0) then
         sNumVagon := NumVagon[i];
      else
        if (i > 1) then
          for(j := i - 1; j >= i - 1; j := j - 1)
            {
              if (InStr(vSpSchf.SpSchf.ss[2], NumVagon[j]) > 0) then
                 sNumVagon := NumVagon[j];
            }
        else
          sNumVagon := NumVagon[i] + vSpSchf.SpSchf.ss[2] + ' ';
      NumVagon[i] := sNumVagon;
//      NumVagon[i] := NumVagon[i] + vSpSchf.SpSchf.ss[2] + ' ';
    } while (vSpSchf.GetNext SpSchf = 0 and i<=3)
  if (vSpSchf.GetFirst SpSchf = 0 ) {};
end.
.fields
  NSF
  if (longint(dFact) <> 0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1, MyOrgName, OrgName)
  if (Direct = 1, MyOrgAddr, OrgAddr)
//  if (Direct = 1, MyOrgTel, OrgTel)
  if (Direct = 1, MyOrgINN, OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat) <> 0, DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1, MyOrgName, OrgName)
  if (Direct <> 1, MyOrgAddr, OrgAddr)
//  if (Direct <> 1, MyOrgTel, OrgTel)
  if (Direct <> 1, MyOrgINN, OrgINN)
.endfields

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер продавца (ИНН)    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
 И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.end
.fields
  'Номера вагонов, учтенных в данной СФ'
  NumVagon[1] NumVagon[2] NumVagon[3]
.endfields
 И @@@@@@@@@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И                          Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И                          Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌─────────────────────┬────────┬──────────┬────────────┬─────────────┬───────────┬──────┬────────────┬─────────────┬─────────────┬──────────┬────────┐ Ш
 Ш│ Наименование товара │Единица │Количество│   Цена     │  Стоимость  │В том числе│Нало- │Сумма налога│  Стоимость  │Сумма налога │  Страна  │ Номер  │ Ш
 Ш│(описание выполненных│измере- │          │ (тариф) за │товаров (ра- │   акциз   │говая │            │товаров (ра- │  с продаж   │ происхож-│грузовой│ Ш
 Ш│ работ, оказанных    │  ния   │          │ единицу из-│бот, услуг), │           │ставка│            │бот, услуг), │             │   дения  │таможен-│ Ш
 Ш│ услуг)              │        │          │ мерения    │ всего без   │           │      │            │всего с уче- │             │          │ной дек-│ Ш
 Ш│                     │        │          │            │  налога     │           │      │            │ том налога  │             │          │ларации │ Ш
 Ш├─────────────────────┼────────┼──────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼─────────────┼──────────┼────────┤ Ш
 Ш│          1          │    2   │     3    │      4     │      5      │     6     │   7  │      8     │      9      │      10     │     11   │   12   │ Ш
 Ш├─────────────────────┼────────┼──────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼─────────────┼──────────┼────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.fields
  SpName
  if (SpPrMC = 3, '', SpOtpEd)
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '')
  SpNDS
  SpSumma
  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&&&.&&│@@@@@@@@@@│@~@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ', '') + PlatNazn
  s1
  SAkciz
  if (abs(s3) >= 0.01, string(Stav1, 3, 0) + ' %', '')
  s2
  s3
  dblSaleTax
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│        │          │            │&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&&&.&&│          │        │ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  s4
  string(Stav2, 3, 0) + ' %'
  s5
  s6
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│             │          │        │ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  s23
  string(Stav3, 3, 0) + ' %'
  s8
  s9
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│             │          │        │ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  s7
  s7
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │      │            │&#&&&&&&&&.&&│             │          │        │ Ш
.}
.fields
  if (bSumEqual, rSumNoNDS, S1 + S4 +S23 + S7)
  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
//  if (bSumEqual, rSaleTax, dblSaleTax)
.endfields
 Ш├─────────────────────┴────────┴──────────┴────────────┴─────────────┴───────────┴──────┼────────────┼─────────────┼─────────────┴──────────┴────────┘ Ш
 Ш│  Всего к оплате                                       &#&&&&&&&&.&& &#&&&&&&.&&       │&#&&&&&&&.&&│&#&&&&&&&&.&&│                                   Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────┴────────────┴─────────────┘                                   Ш
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Главный бухгалтер                                               ^

       М.П.


       Выдал
       (подпись ответственного лица от продавца)
        Ш
.begin
  // Для России
  if (wCountry = 0)
  {
    StrPrim1 := ' ';
    StrPrim2 := 'Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
  else
  {
    StrPrim1 := '1. Без печати недействителен.';
    StrPrim2 := '2. Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
end.
.fields
   StrPrim1
   StrPrim2
.endfields
        БПримечания. Б ^
       ^

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------

#doc
Счет-фактура (с дополнительным налогом) (формат A4)
#end
.linkform 'Schfrees_44' prototype is 'Schfrees'
.NameInList 'Счет-фактура (с дополнительным налогом) (формат A4)'
.Group 'Бланки счетов-фактур (c 01.01.2001)'
.p 80
.defo portrait
!-------------------------------------------------------------------
.create view vSpSchf
from
 SpSchf  ,
 KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rAkcis, rDrNal: double;
  rSumNoNDS, rSaleTax: double
  rSumma: double
  Nalog2_1: string
  Nalog2_2: string
  Nalog2_Len: longint
  StrPrim1, StrPrim2 : String;
.endvar
.begin
  var i: longint;
  Nalog2_Len := 11;
  i := Pos( ' ', trim(Nalog2) );
  if (i > 0 and i <= Nalog2_Len)
  {
    Nalog2_1 := SubStr(trim(Nalog2), 1, i - 1);
    Nalog2_2 := SubStr(trim(Nalog2), i + 1, 255);
  } else {
    Nalog2_1 := SubStr(trim(Nalog2), 1, Nalog2_Len);
    Nalog2_2 := ltrim(SubStr(trim(Nalog2), Nalog2_Len + 1, 255));
  };
end.
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact) <> 0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1, MyOrgName, OrgName)
  if (Direct = 1, MyOrgAddr, OrgAddr)
!  if (Direct = 1, MyOrgTel, OrgTel)
  if (Direct = 1, MyOrgINN, OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat) <> 0, DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1, MyOrgName, OrgName)
  if (Direct <> 1, MyOrgAddr, OrgAddr)
!  if (Direct <> 1, MyOrgTel, OrgTel)
  if (Direct <> 1, MyOrgINN, OrgINN)
.endfields

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер продавца (ИНН)    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И Телефон  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
 И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.fields
  Nalog2_1
  Nalog2_2
.endfields

 Ш┌──────────────┬───────┬─────────┬────────────┬─────────────┬───────────┬──────┬────────────┬─────────────┬──────────┬────────────┬─────────┬────────┐ Ш
 Ш│ Наименование │Единица│ Коли-   │   Цена     │  Стоимость  │В том числе│Нало- │Сумма налога│  Стоимость  │@~@@@@@@@@│Сумма налога│ Страна  │ Номер  │ Ш
 Ш│товара (описа-│измере-│ чество  │ (тариф) за │товаров (ра- │   акциз   │говая │            │товаров (ра- │@~@@@@@@@@│  с продаж  │происхож-│грузовой│ Ш
 Ш│ние выполнен- │  ния  │         │ единицу из-│бот, услуг), │           │ставка│            │бот, услуг), │          │            │  дения  │таможен-│ Ш
 Ш│ных работ,ока-│       │         │ мерения    │ всего без   │           │      │            │всего с уче- │          │            │         │ной дек-│ Ш
 Ш│занных услуг) │       │         │            │  налога     │           │      │            │ том налога  │          │            │         │ларации │ Ш
 Ш├──────────────┼───────┼─────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼──────────┼────────────┼─────────┼────────┤ Ш
 Ш│       1      │    2  │     3   │      4     │      5      │     6     │   7  │      8     │      9      │    9a    │      10    │    11   │   12   │ Ш
 Ш├──────────────┼───────┼─────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼──────────┼────────────┼─────────┼────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
  rDrNal := 0;
end.
.{CheckEnter SpSchf
.{ table 'vSpSchf.SpSchf'
.fields
  SpName
  if (SpPrMC = 3, '', SpOtpEd)
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '')
  SpNDS
  SpSumma
  SpDrNal
  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@│@~@@@@@│@#@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&.&&│&#&&&&&&&.&&│@@@@@@@@@│@~@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} //table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ', '') + PlatNazn
  s1
  SAkciz
  if (abs(s3) >= 0.01, string(Stav1, 3, 0) + ' %', '')
  s2
  s3
  s10
  dblSaleTax
.endfields
 Ш│@@@@@@@@@@@@@@│       │         │            │&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&.&&│&#&&&&&&&.&&│         │        │ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  s4
  string(Stav2, 3, 0) + ' %'
  s5
  s6
.endfields
 Ш│              │       │         │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│          │            │         │        │ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  s23
  string(Stav3, 3, 0) + ' %'
  s8
  s9
.endfields
 Ш│              │       │         │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│          │            │         │        │ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  s7
  s7
.endfields
 Ш│              │       │         │            │&#&&&&&&&&.&&│           │      │            │&#&&&&&&&&.&&│          │            │         │        │ Ш
.}
.fields
  if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7)
  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
  if (bSumEqual, rDrNal, S10)
//  if (bSumEqual, rSaleTax, dblSaleTax)
.endfields
 Ш├──────────────┴───────┴─────────┴────────────┴─────────────┴───────────┴──────┼────────────┼─────────────┼──────────┼────────────┴─────────┴────────┘ Ш
 Ш│  Всего к оплате                              &#&&&&&&&&.&& &#&&&&&&.&&       │&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&.&&│                                 Ш
 Ш└──────────────────────────────────────────────────────────────────────────────┴────────────┴─────────────┴──────────┘                                 Ш
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Главный бухгалтер                                               ^

       М.П.


       Выдал
       (подпись ответственного лица от продавца)
        Ш
.begin
  // Для России
  if (wCountry = 0)
  {
    StrPrim1 := ' ';
    StrPrim2 := 'Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
  else
  {
    StrPrim1 := '1. Без печати недействителен.';
    StrPrim2 := '2. Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
end.
.fields
   StrPrim1
   StrPrim2
.endfields
        БПримечания. Б ^
       ^

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------
#doc
Счет-фактура (формат A4, стандарт2)
#end
.linkform 'Schfrees_47' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4, стандарт2)'
.Group 'Бланки счетов-фактур (c 01.01.2001)'
!-------------------------------------------------------------------
.create view vSpSchf
from
  SpSchf  ,
  KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  StrPrim1, StrPrim2 : String;
.endvar
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1, MyOrgName, OrgName)
  If (Direct = 1, MyOrgAddr, OrgAddr)
  If (Direct = 1 ,MyOrgINN, OrgINN)
  GruzFrom
  GruzTo
  PlatNo
  if (longint(PlatDat) <> 0, DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1, MyOrgName, OrgName)
  if (Direct <> 1, MyOrgAddr, OrgAddr)
  if (Direct <> 1, MyOrgINN, OrgINN)
.endfields

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер продавца (ИНН)    Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Идентификационный номер покупателя (ИНН)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.end
! И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
! И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И

.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌─────────────────────┬────────┬──────────┬────────────┬─────────────┬───────────┬──────┬────────────┬─────────────┬─────────────┬──────────┬────────┐ Ш
 Ш│ Наименование товара │Единица │Количество│   Цена     │  Стоимость  │В том числе│Нало- │Сумма налога│  Стоимость  │Сумма налога │  Страна  │ Номер  │ Ш
 Ш│(описание выполненных│измере- │          │ (тариф) за │товаров (ра- │   акциз   │говая │            │товаров (ра- │  с продаж   │ происхож-│грузовой│ Ш
 Ш│ работ, оказанных    │  ния   │          │ единицу из-│бот, услуг), │           │ставка│            │бот, услуг), │             │   дения  │таможен-│ Ш
 Ш│ услуг)              │        │          │ мерения    │ всего без   │           │      │            │всего с уче- │             │          │ной дек-│ Ш
 Ш│                     │        │          │            │  налога     │           │      │            │ том налога  │             │          │ларации │ Ш
 Ш├─────────────────────┼────────┼──────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼─────────────┼──────────┼────────┤ Ш
 Ш│          1          │    2   │     3    │      4     │      5      │     6     │   7  │      8     │      9      │      10     │     11   │   12   │ Ш
 Ш├─────────────────────┼────────┼──────────┼────────────┼─────────────┼───────────┼──────┼────────────┼─────────────┼─────────────┼──────────┼────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{table 'vSpSchf.SpSchf'
.fields
  SpName
  if (SpPrMC = 3, '', SpOtpEd)
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '')
  SpNDS
  SpSumma
  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&&&.&&│@@@@@@@@@@│@~@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ', '') + PlatNazn
  s1
  SAkciz
  if (abs(s3) >= 0.01, string(Stav1, 3, 0) + ' %', '')
  s2
  s3
  dblSaleTax
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│        │          │            │&#&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│&#&&&&&&&&.&&│          │        │ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  s4
  string(Stav2, 3, 0) + ' %'
  s5
  s6
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│             │          │        │ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  s23
  string(Stav3, 3, 0) + ' %'
  s8
  s9
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │@~#@@@│&#&&&&&&&.&&│&#&&&&&&&&.&&│             │          │        │ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  s7
  s7
.endfields
 Ш│                     │        │          │            │&#&&&&&&&&.&&│           │      │            │&#&&&&&&&&.&&│             │          │        │ Ш
.}
.fields
  if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7)
  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
.endfields
 Ш├─────────────────────┴────────┴──────────┴────────────┴─────────────┴───────────┴──────┼────────────┼─────────────┼─────────────┴──────────┴────────┘ Ш
 Ш│  Всего к оплате                                       &#&&&&&&&&.&& &#&&&&&&.&&       │&#&&&&&&&.&&│&#&&&&&&&&.&&│                                   Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────┴────────────┴─────────────┘                                   Ш
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации (предприятия)                          ^

       Главный бухгалтер                                               ^

       М.П.


       Выдал
       (подпись ответственного лица от продавца)
        Ш
.begin
  // Для России
  if (wCountry = 0)
  {
    StrPrim1 := ' ';
    StrPrim2 := 'Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
  else
  {
    StrPrim1 := '1. Без печати недействителен.';
    StrPrim2 := '2. Первый экземпляр - покупателю, второй экземпляр - продавцу.';
  }
end.
.fields
   StrPrim1
   StrPrim2
.endfields
        БПримечания. Б ^
       ^

.} // Schf
.endform

#declare SpName
if (SpPrMC >= 100, SpName, if (SpExistNDS or Abs(SpPerc) >= 0.01, SpName, SpName + ' (без налога(НДС))'))
#end

#declare s_(Stav_)
if(wCountry=0,
   if(((SubTip=16) or (SubTip=23)), string(#Stav_,2,0)+'/'+string(100+#Stav_,3,0),
                                    string(#Stav_,3,0)+' %'),
   string(#Stav_,3,0)+' %')
#end
!--------------------------------------------------------------------------------------------------------------------
#doc
Счет-фактура (формат A4)
#end
.linkform 'Schfrees_48' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4)'
.Group 'Бланки счетов-фактур (c 15.03.2001)'
.set filler '-'
!-------------------------------------------------------------------
.create view vSpSchf
from
  SpSchf  ,
  KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  StrPrim1, StrPrim2 : String;
  is2004 : boolean;
  EmptyField : string;
.endvar
.begin
  is2004 := (ppPrintParam and 128) <> 0;
  EmptyField := if(wCountry=0,'-','');
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct = 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП продавца', 'ИНН продавца')
  if (Direct = 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
  #f_(GruzFrom)
  #f_(GruzTo)
  #f_(if(InStr('N',PlatNo)<>0,PlatNo,if(Trim(PlatNo)<>'','N '+PlatNo,'')))+
  if (longint(PlatDat) <> 0, ' от '+DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct <> 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )

  if (is2004, 'ИНН/КПП покупателя', 'ИНН покупателя')
  if (Direct <> 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
.endfields
.{?internal; is2004
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                            к Правилам ведения журналов учета полученных и выставленных счетов-фактур, Ш
 Ш                                                                           книг покупок и книг продаж при расчетах по налогу на добавленную стоимость, Ш
 Ш                                                             утвержденным постановлением Правительства Российской Федерации от 2 декабря 2000 г. № 914 Ш
 Ш                                                                  (в ред. постановления Правительства Российской Федерации от 16 февраля 2004 г. № 84) Ш
.}

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.end
! И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
! И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И

.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
 Ш┌────────────────────────┬─────────┬──────────┬────────────┬───────────────┬───────────┬──────┬──────────────┬───────────────┬─────────────┬─────────┐ Ш
 Ш│ Наименование товара    │ Единица │Количество│   Цена     │   Стоимость   │В том числе│Нало- │ Сумма налога │   Стоимость   │   Страна    │  Номер  │ Ш
 Ш│(описание выполненных   │ измере- │          │ (тариф) за │ товаров (ра-  │   акциз   │говая │              │ товаров (ра-  │происхождения│ грузовой│ Ш
 Ш│ работ, оказанных       │   ния   │          │ единицу из-│ бот, услуг),  │           │ставка│              │ бот, услуг),  │             │ таможен-│ Ш
 Ш│ услуг)                 │         │          │ мерения    │  всего без    │           │      │              │ всего с уче-  │             │ ной дек-│ Ш
 Ш│                        │         │          │            │   налога      │           │      │              │  том налога   │             │ ларации │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
 Ш│          1             │     2   │     3    │      4     │       5       │     6     │   7  │       8      │       9       │      10     │    11   │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{table 'vSpSchf.SpSchf'
.fields
  #f_(#SpName)
  #f_(if (SpPrMC = 3, '', SpOtpEd))
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '-')
  SpNDS
  SpSumma
!  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ',
  if (SubTip = 23, 'Суммовая разница', '')) + PlatNazn
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s1)
  SAkciz
  if(abs(s3) >= 0.01, #s_(Stav1),'-')
  s2
  s3
!  dblSaleTax
  EmptyField
  EmptyField
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s4)
  EmptyField
  #s_(Stav2)
  s5
  s6
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s23)
  EmptyField
  #s_(Stav3)
  s8
  s9
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s7)
  EmptyField
  EmptyField
  EmptyField
  s7
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.fields
 if (((Direct=1) and (SubTip=16) and (wCountry=0)),'',
  if ((ppPrintParam and 64) <> 0
  , if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7), ''))
!  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
.endfields
 Ш├────────────────────────┴─────────┴──────────┴────────────┴───────────────┴───────────┴──────┼──────────────┼───────────────┼─────────────┴─────────┘ Ш
 Ш│  Всего к оплате                                           &#&&&&&&&&&&.&&                   │&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│                         Ш
 Ш└─────────────────────────────────────────────────────────────────────────────────────────────┴──────────────┴───────────────┘                         Ш
.{?internal; not is2004
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
       (индивидуальный предприниматель)                                        (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)

       М.П.


       Выдал                                                                    (подпись ответственного лица от продавца)

       Примечания.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}
.{?internal; is2004
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
                                      (подпись)              (Ф.И.О.)                              (подпись)              (Ф.И.О.)

       Индивидуальный предприниматель
                                      (подпись)              (Ф.И.О.)          (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)
       Примечание.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------
#doc
Счет-фактура (формат A4, с дополнением)
#end
.linkform 'Schfrees_49' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4, с дополнением)'
.Group 'Бланки счетов-фактур (c 15.03.2001)'
.set filler '-'
!-------------------------------------------------------------------
.create view vSpSchf
from
  SpSchf  ,
  KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  StrPrim1, StrPrim2 : String;
  is2004 : boolean;
  EmptyField : string;
.endvar
.begin
  is2004 := (ppPrintParam and 128) <> 0;
  EmptyField :=if(wCountry=0,'-','');
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct = 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП продавца', 'ИНН продавца')
  if (Direct = 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
  #f_(GruzFrom)
  #f_(GruzTo)
  #f_(if(InStr('N',PlatNo)<>0,PlatNo,if(Trim(PlatNo)<>'','N '+PlatNo,'')))+
  if (longint(PlatDat) <> 0, ' от '+DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct <> 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП покупателя', 'ИНН покупателя')
  if (Direct <> 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
.endfields
.{?internal; is2004
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                            к Правилам ведения журналов учета полученных и выставленных счетов-фактур, Ш
 Ш                                                                           книг покупок и книг продаж при расчетах по налогу на добавленную стоимость, Ш
 Ш                                                             утвержденным постановлением Правительства Российской Федерации от 2 декабря 2000 г. № 914 Ш
 Ш                                                                  (в ред. постановления Правительства Российской Федерации от 16 февраля 2004 г. № 84) Ш
.}

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.fields
  Nazn
  Dollarah
.endfields
 И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
 И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌────────────────────────┬─────────┬──────────┬────────────┬───────────────┬───────────┬──────┬──────────────┬───────────────┬─────────────┬─────────┐ Ш
 Ш│ Наименование товара    │ Единица │Количество│   Цена     │   Стоимость   │В том числе│Нало- │ Сумма налога │   Стоимость   │   Страна    │  Номер  │ Ш
 Ш│(описание выполненных   │ измере- │          │ (тариф) за │ товаров (ра-  │   акциз   │говая │              │ товаров (ра-  │происхождения│ грузовой│ Ш
 Ш│ работ, оказанных       │   ния   │          │ единицу из-│ бот, услуг),  │           │ставка│              │ бот, услуг),  │             │ таможен-│ Ш
 Ш│ услуг)                 │         │          │ мерения    │  всего без    │           │      │              │ всего с уче-  │             │ ной дек-│ Ш
 Ш│                        │         │          │            │   налога      │           │      │              │  том налога   │             │ ларации │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
 Ш│          1             │     2   │     3    │      4     │       5       │     6     │   7  │       8      │       9       │      10     │    11   │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{table 'vSpSchf.SpSchf'
.fields
  #f_(#SpName)
  #f_(if (SpPrMC = 3, '', SpOtpEd))
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '-')
  SpNDS
  SpSumma
!  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ',
  if (SubTip = 23, 'Суммовая разница', '')) + PlatNazn
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s1)
  SAkciz
  if (abs(s3) >= 0.01, #s_(Stav1), '-')
  s2
  s3
!  dblSaleTax
  EmptyField
  EmptyField
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s4)
  EmptyField
  #s_(Stav2)
  s5
  s6
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s23)
  EmptyField
  #s_(Stav3)
  s8
  s9
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s7)
  EmptyField
  EmptyField
  EmptyField
  s7
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.fields
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),'',
   if ((ppPrintParam and 64) <> 0
   , if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7), ''))
!  if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7)
!  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
.endfields
 Ш├────────────────────────┴─────────┴──────────┴────────────┴───────────────┴───────────┴──────┼──────────────┼───────────────┼─────────────┴─────────┘ Ш
 Ш│  Всего к оплате                                           &#&&&&&&&&&&.&&                   │&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│                         Ш
 Ш└─────────────────────────────────────────────────────────────────────────────────────────────┴──────────────┴───────────────┘                         Ш
.{?internal; not is2004
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
       (индивидуальный предприниматель)                                        (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)

       М.П.


       Выдал                                                                     (подпись ответственного лица от продавца)

       Примечания.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}
.{?internal; is2004
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
                                      (подпись)              (Ф.И.О.)                             (подпись)              (Ф.И.О.)

       Индивидуальный предприниматель
                                      (подпись)              (Ф.И.О.)          (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)
       Примечание.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------
#ifdef __CentrOtv__
!--------------------------------------------------------------------------------------------------------------------
#doc
Счет-фактура (формат A4, с учетом подразделений)
#end
.linkform 'Schfrees_410' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4, с учетом подразделений)'
.Group 'Бланки счетов-фактур (c 15.03.2001)'
.set filler '-'
!-------------------------------------------------------------------
.create view vSpSchf
from
  SpSchf  ,
  KatParty,
  KatPodr
where
((
      cSpSchf          == SpSchf.nRec
  and SpSchf.cParty    == KatParty.nRec
  and nSchFact         == SchFact.nRec
  and SchFact.cOtvPodr == KatPodr.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  strGruzFrom, strGruzTo: string;
  strDirector, strMain_Buh, strPodr: string;
  StrPrim1, StrPrim2 : String;
  EmptyField : string;
  is2004 : boolean;
.endvar
.begin
  is2004 := (ppPrintParam and 128) <> 0;
  EmptyField := if(wCountry=0,'-','');
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  if (vSpSchf.GetFirst SchFact = 0) {};
  if (vSpSchf.GetFirst KatPodr = 0) {
    strGruzFrom := if (Direct = 1, vSpSchf.KatPodr.Name + ' ' +
                                   vSpSchf.KatPodr.Addr, GruzFrom
                   );
    strGruzTo := if (Direct = 2, vSpSchf.KatPodr.Name + ' ' +
                                 vSpSchf.KatPodr.Addr, GruzTo
                 );
    strDirector := if (Direct = 1, vSpSchf.KatPodr.FIO, '');
    strMain_Buh := if (Direct = 1, vSpSchf.KatPodr.FIO_GB, '');
    strPodr := if (Direct = 1, vSpSchf.KatPodr.Name, '');
  } else {
    strGruzFrom := GruzFrom;
    strGruzTo := GruzTo;
    strDirector := Director;
    strMain_Buh := Main_Buh;
    strPodr := '';
  }
end.
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct = 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП продавца', 'ИНН продавца')
  if (Direct = 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
  #f_(strGruzFrom)
  #f_(strGruzTo)
  #f_(if(InStr('N',PlatNo)<>0,PlatNo,if(Trim(PlatNo)<>'','N '+PlatNo,'')))+
  if (longint(PlatDat) <> 0, ' от '+DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct <> 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП покупателя', 'ИНН покупателя')
  if (Direct <> 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
.endfields
.{?internal; is2004
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                            к Правилам ведения журналов учета полученных и выставленных счетов-фактур, Ш
 Ш                                                                           книг покупок и книг продаж при расчетах по налогу на добавленную стоимость, Ш
 Ш                                                             утвержденным постановлением Правительства Российской Федерации от 2 декабря 2000 г. № 914 Ш
 Ш                                                                  (в ред. постановления Правительства Российской Федерации от 16 февраля 2004 г. № 84) Ш
.}

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.end
! И Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.) И
! И  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌────────────────────────┬─────────┬──────────┬────────────┬───────────────┬───────────┬──────┬──────────────┬───────────────┬─────────────┬─────────┐ Ш
 Ш│ Наименование товара    │ Единица │Количество│   Цена     │   Стоимость   │В том числе│Нало- │ Сумма налога │   Стоимость   │   Страна    │  Номер  │ Ш
 Ш│(описание выполненных   │ измере- │          │ (тариф) за │ товаров (ра-  │   акциз   │говая │              │ товаров (ра-  │происхождения│ грузовой│ Ш
 Ш│ работ, оказанных       │   ния   │          │ единицу из-│ бот, услуг),  │           │ставка│              │ бот, услуг),  │             │ таможен-│ Ш
 Ш│ услуг)                 │         │          │ мерения    │  всего без    │           │      │              │ всего с уче-  │             │ ной дек-│ Ш
 Ш│                        │         │          │            │   налога      │           │      │              │  том налога   │             │ ларации │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
 Ш│          1             │     2   │     3    │      4     │       5       │     6     │   7  │       8      │       9       │      10     │    11   │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{table 'vSpSchf.SpSchf'
.fields
  #f_(#SpName)
  #f_(if (SpPrMC = 3, '', SpOtpEd))
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '-')
  SpNDS
  SpSumma
!  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ',
  if (SubTip = 23, 'Суммовая разница', '')) + PlatNazn
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s1)
  SAkciz
  if (abs(s3) >= 0.01, #s_(Stav1), '-')
  s2
  s3
!  dblSaleTax
  EmptyField
  EmptyField
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s4)
  EmptyField
  #s_(Stav2)
  s5
  s6
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s23)
  EmptyField
  #s_(Stav3)
  s8
  s9
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s7)
  EmptyField
  EmptyField
  EmptyField
  s7
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.fields
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),'',
   if ((ppPrintParam and 64) <> 0
   , if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7), ''))
!  if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7)
!  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
.endfields
 Ш├────────────────────────┴─────────┴──────────┴────────────┴───────────────┴───────────┴──────┼──────────────┼───────────────┼─────────────┴─────────┘ Ш
 Ш│  Всего к оплате                                           &#&&&&&&&&&&.&&                   │&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│                         Ш
 Ш└─────────────────────────────────────────────────────────────────────────────────────────────┴──────────────┴───────────────┘                         Ш
.{?internal; not is2004
.fields
  strPodr
  strPodr
  strDirector
  strMain_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
       (индивидуальный предприниматель)             @@@@@@@@@@@@@@@@@@@@@@@@@@ (реквизиты свидетельства о        ^
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)

       М.П.


       Выдал                                                                    (подпись ответственного лица от продавца)

       Примечания.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}
.{?internal; is2004
.fields
  strPodr
  strPodr
  strDirector
  strMain_Buh
.endfields
 Ш
                                                    @@@@@@@@@@@@@@@@@@@@@@@@@@                                   ^
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
                                      (подпись)              (Ф.И.О.)                              (подпись)              (Ф.И.О.)

       Индивидуальный предприниматель
                                      (подпись)              (Ф.И.О.)          (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)
       Примечание.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------
#end
!--------------------------------------------------------------------------------------------------------------------
#doc
Счет-фактура (с информацией о платеже)
#end
.linkform 'Schfrees_411' prototype is 'Schfrees'
.NameInList 'Счет-фактура (с информацией о платеже)'
.Group 'Бланки счетов-фактур (c 15.03.2001)'
.set filler '-'
!-------------------------------------------------------------------
.create view vSpSchf
from
  SpSchf  ,
  KatParty,
  SchFact,
  BookPrZk
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.create view vSchf
from
  SchFact
, BookPrZk
, SchFact SchFactPlat
, SoprHoz
, KatParty
, SpSopHoz
, SpSopr
where
((
    nSchFact             == SchFact.nRec and (SchFact.SubTip = 0)
and SchFact.nRec         == BookPrZk.cSchFact and
((BookPrZk.SubTip = 4) or (BookPrZk.SubTip = 20))
and BookPrZk.cSchFactS   == SchFactPlat.nRec
and SchFactPlat.cSoprHoz == SoprHoz.nRec

and SoprHoz.nRec         == SpSopHoz.cSoprHoz
and SpSopHoz.cSpSopr     == SpSopr.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  StrPrim1, StrPrim2 : String;
  plat_No, plat_Date : string;
  platNo_Date        : string;
  EmptyField         : string;
  is2004 : boolean;
.endvar
.begin
  is2004 := (ppPrintParam and 128) <> 0;
  EmptyField :=if(wCountry=0,'-','')
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  plat_No := '';
  plat_Date := '';
  platNo_Date := '';

  if (vSchf.GetFirst SchFact = 0)
  {
    vSchf._loop BookPrZk
    {
      if (vSchf.GetFirst SchFactPlat = 0)
      {
        if ((vSchf.SchFactPlat.SubTip <> 16) and
            (vSchf.SchFactPlat.SubTip <> 17))
            continue;
        if (vSchf.GetFirst SoprHoz = 0)
        {
          plat_No := plat_No + if (trim(plat_No) <> '', ', ', '') + vSchf.SoprHoz.NoDoc;
          plat_Date := plat_Date + if (trim(plat_Date) <> '', ', ', '') +
            if (longint(vSchf.SoprHoz.DatOb) <> 0,
            DateToStr(vSchf.SoprHoz.DatOb, '"DD" Mon YYYY г.'), '');
          if (vSchf.SchFactPlat.SubTip = 17)
           { // Платеж по счет-фактуре
            if (vSchf.GetFirst fastfirstrow SpSopHoz =0)
             do
              {
               if (vSchf.GetFirst fastfirstrow SpSopr =0)
                if (longint(vSchf.SoprHoz.DatOb) < longint(vSchf.SpSopr.dSopr))
                 {
                  platNo_Date := platNo_Date + 'N '+vSchf.SoprHoz.NoDoc +
                                 if(longint(vSchf.SoprHoz.DatOb) <> 0,
                                    ' от '+DateToStr(vSchf.SoprHoz.DatOb,'"DD" Mon YYYY г.'),'')+ ', ';
                  break
                 }
              }
             while (vSchf.GetNext SpSopHoz =0)
           }
          else
            platNo_Date := platNo_Date + 'N '+vSchf.SoprHoz.NoDoc +
                           if(longint(vSchf.SoprHoz.DatOb) <> 0,
                              ' от '+DateToStr(vSchf.SoprHoz.DatOb,'"DD" Mon YYYY г.'),'')+ ', ';
        }
      }
    }
    if (platNo_Date <> '')
      platNo_Date := SubStr(platNo_Date,1,Length(platNo_Date)-2)
  }
  if (trim(plat_No) = '')
  {
    plat_No := PlatNo;
    plat_Date := if (longint(PlatDat) <> 0, DateToStr(PlatDat, '"DD" Mon YYYY г.'), '');
  }
  if (trim(platNo_Date) = '')
  {
    if ((PlatNo <> '') or (longint(PlatDat) <> 0))
     {
       if (InStr('N',PlatNo)=0)
         platNo_Date := 'N ';
       platNo_Date := platNo_Date+PlatNo+' от '+if(longint(PlatDat) <> 0, DateToStr(PlatDat, '"DD" Mon YYYY г.'), '');
     }
  }
end.
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct = 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП продавца', 'ИНН продавца')
  if (Direct = 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
  #f_(GruzFrom)
  #f_(GruzTo)

!  #f_(plat_No)
!  plat_Date
  #f_(platNo_Date)

  if (Direct <> 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct <> 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП покупателя', 'ИНН покупателя')
  if (Direct <> 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
.endfields
.{?internal; is2004
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                            к Правилам ведения журналов учета полученных и выставленных счетов-фактур, Ш
 Ш                                                                           книг покупок и книг продаж при расчетах по налогу на добавленную стоимость, Ш
 Ш                                                             утвержденным постановлением Правительства Российской Федерации от 2 декабря 2000 г. № 914 Ш
 Ш                                                                  (в ред. постановления Правительства Российской Федерации от 16 февраля 2004 г. № 84) Ш
.}

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌────────────────────────┬─────────┬──────────┬────────────┬───────────────┬───────────┬──────┬──────────────┬───────────────┬─────────────┬─────────┐ Ш
 Ш│ Наименование товара    │ Единица │Количество│   Цена     │   Стоимость   │В том числе│Нало- │ Сумма налога │   Стоимость   │   Страна    │  Номер  │ Ш
 Ш│(описание выполненных   │ измере- │          │ (тариф) за │ товаров (ра-  │   акциз   │говая │              │ товаров (ра-  │происхождения│ грузовой│ Ш
 Ш│ работ, оказанных       │   ния   │          │ единицу из-│ бот, услуг),  │           │ставка│              │ бот, услуг),  │             │ таможен-│ Ш
 Ш│ услуг)                 │         │          │ мерения    │  всего без    │           │      │              │ всего с уче-  │             │ ной дек-│ Ш
 Ш│                        │         │          │            │   налога      │           │      │              │  том налога   │             │ ларации │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
 Ш│          1             │     2   │     3    │      4     │       5       │     6     │   7  │       8      │       9       │      10     │    11   │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{table 'vSpSchf.SpSchf'
.fields
  #f_(#SpName)
  #f_(if (SpPrMC = 3, '', SpOtpEd))
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
  if (SpExistNDS or SpPerc <> 0, string(SpPerc, 3, 0) + ' %', '-')
  SpNDS
  SpSumma
!  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ',
  if (SubTip = 23, 'Суммовая разница', '')) + PlatNazn
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s1)
  SAkciz
  if (abs(s3) >= 0.01, #s_(Stav1), '-')
  s2
  s3
!  dblSaleTax
  EmptyField
  EmptyField
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s4)
  EmptyField
  #s_(Stav2)
  s5
  s6
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s23)
  EmptyField
  #s_(Stav3)
  s8
  s9
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s7)
  EmptyField
  EmptyField
  EmptyField
  s7
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.fields
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),'',
   if ((ppPrintParam and 64) <> 0
   , if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7), ''))
!  if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7)
!  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
.endfields
 Ш├────────────────────────┴─────────┴──────────┴────────────┴───────────────┴───────────┴──────┼──────────────┼───────────────┼─────────────┴─────────┘ Ш
 Ш│  Всего к оплате                                           &#&&&&&&&&&&.&&                   │&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│                         Ш
 Ш└─────────────────────────────────────────────────────────────────────────────────────────────┴──────────────┴───────────────┘                         Ш
.{?internal; not is2004
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
       (индивидуальный предприниматель)                                        (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)

       М.П.


       Выдал                                                                    (подпись ответственного лица от продавца)

       Примечания.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}
.{?internal; is2004
.fields
   Director
   Main_Buh
.endfields

 Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
                                      (подпись)              (Ф.И.О.)                             (подпись)              (Ф.И.О.)

       Индивидуальный предприниматель
                                      (подпись)              (Ф.И.О.)          (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)
       Примечание.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
 Ш
.}

.} // Schf
.endform
!--------------------------------------------------------------------------------------------------------------------

#declare sRasch_(Stav_)
string(#Stav_,2,0)+'/'+string(100+#Stav_,3,0)
#end
!--------------------------------------------------------------------------------------------------------------------
#doc
Счет-фактура (расчетная ставка)
#end
.linkform 'Schfrees_412' prototype is 'Schfrees'
.NameInList 'Счет-фактура (расчетная ставка)'
.Group 'Бланки счетов-фактур (c 15.03.2001)'
.set filler '-'
!-------------------------------------------------------------------
.create view vSpSchf
from
  SpSchf  ,
  KatParty
where
((
         cSpSchf == SpSchf.nRec and
   SpSchf.cParty == KatParty.nRec
));
!-------------------------------------------------------------------
.var
  rNDS, rSumNoNDS,
  rAkcis, rSaleTax, rSumma: double;
  StrPrim1, StrPrim2 : String;
  is2004 : boolean;
  EmptyField : string;
.endvar
.begin
  is2004 := (ppPrintParam and 128) <> 0;
  EmptyField := if(wCountry=0,'-','');
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct = 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )
  if (is2004, 'ИНН/КПП продавца', 'ИНН продавца')
  if (Direct = 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
  #f_(GruzFrom)
  #f_(GruzTo)
  #f_(if(InStr('N',PlatNo)<>0,PlatNo,if(Trim(PlatNo)<>'','N '+PlatNo,'')))+
  if (longint(PlatDat) <> 0, ' от '+DateToStr(PlatDat, '"DD" Mon YYYY г.'), '')

  if (Direct <> 1,
    #f_(MyOrgName),
    #f_(OrgName)
  )
  if (Direct <> 1,
    #f_(MyOrgAddr),
    #f_(OrgAddr)
  )

  if (is2004, 'ИНН/КПП покупателя', 'ИНН покупателя')
  if (Direct <> 1,
    #f_(MyOrgINN + if (is2004 and (trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, '')),
    #f_(OrgINN + if (is2004 and (trim(OrgKPP) <> ''), ' / ' + OrgKPP, ''))
  )
.endfields
.{?internal; is2004
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                            к Правилам ведения журналов учета полученных и выставленных счетов-фактур, Ш
 Ш                                                                           книг покупок и книг продаж при расчетах по налогу на добавленную стоимость, Ш
 Ш                                                             утвержденным постановлением Правительства Российской Федерации от 2 декабря 2000 г. № 914 Ш
 Ш                                                                  (в ред. постановления Правительства Российской Федерации от 16 февраля 2004 г. № 84) Ш
.}

 И                 Счет-фактура №  Д@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Продавец   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузоотправитель и его адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Грузополучатель и его адрес   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
! И К платежно-расчетному документу №  Д@@@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И К платежно-расчетному документу  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Адрес  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И @@@@@@@@@@@@@@@@@@  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
.if Dopol
.end
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌────────────────────────┬─────────┬──────────┬────────────┬───────────────┬───────────┬──────┬──────────────┬───────────────┬─────────────┬─────────┐ Ш
 Ш│ Наименование товара    │ Единица │Количество│   Цена     │   Стоимость   │В том числе│Нало- │ Сумма налога │   Стоимость   │   Страна    │  Номер  │ Ш
 Ш│(описание выполненных   │ измере- │          │ (тариф) за │ товаров (ра-  │   акциз   │говая │              │ товаров (ра-  │происхождения│ грузовой│ Ш
 Ш│ работ, оказанных       │   ния   │          │ единицу из-│ бот, услуг),  │           │ставка│              │ бот, услуг),  │             │ таможен-│ Ш
 Ш│ услуг)                 │         │          │ мерения    │  всего без    │           │      │              │ всего с уче-  │             │ ной дек-│ Ш
 Ш│                        │         │          │            │   налога      │           │      │              │  том налога   │             │ ларации │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
 Ш│          1             │     2   │     3    │      4     │       5       │     6     │   7  │       8      │       9       │      10     │    11   │ Ш
 Ш├────────────────────────┼─────────┼──────────┼────────────┼───────────────┼───────────┼──────┼──────────────┼───────────────┼─────────────┼─────────┤ Ш
.begin
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSaleTax := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.{table 'vSpSchf.SpSchf'
.fields
  #f_(#SpName)
  #f_(if (SpPrMC = 3, '', SpOtpEd))
  if (SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr))
#ifdef _RoundInDoc_
  if (SpPrMC = 3, 0.0, SpPrNoNds)
#else
  if (SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
#end
  SpSumNoNDS
  SpAkciz
if (SpExistNDS or SpPerc <> 0, string(SpPerc,  2, 0)  + '/' + String(100 + SpPerc, 3, 0), '-')
  SpNDS
  SpSumma
!  SpSaleTax //налог с продаж
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│@#@@@@@@@@│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.begin
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSaleTax := rSaleTax + round(SpSaleTax, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // table vSpSchf
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.{?internal; (SubTip >= 16)
.fields
  if (SubTip = 16, 'Аванс ',
  if (SubTip = 23, 'Суммовая разница', '')) + PlatNazn
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s1)
  SAkciz
  if(abs(s3) >= 0.01, #sRasch_(Stav1),'-')
  s2
  s3
!  dblSaleTax
  EmptyField
  EmptyField
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@@@│@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S6) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s4)
  EmptyField
  #sRasch_(Stav2)
  s5
  s6
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S9) > 0.01 ) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s23)
  EmptyField
  #sRasch_(Stav3)
  s8
  s9
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.{?internal; ( (Abs(S7) > 0.01) and (SubTip >= 16) )
.fields
  EmptyField
  EmptyField
  EmptyField
  if (((Direct=1) and (SubTip=16) and (wCountry=0)),0,s7)
  EmptyField
  EmptyField
  EmptyField
  s7
  EmptyField
  EmptyField
.endfields
 Ш│                        │@~@@@@@@@│&#&&&&.&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&&.&&│@~#@@@│&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@@@@@@@@│@~@@@@@@@│ Ш
.}
.fields
 if (((Direct=1) and (SubTip=16) and (wCountry=0)),'',
  if ((ppPrintParam and 64) <> 0
  , if (bSumEqual, rSumNoNDS, S1 + S4 + S23 + S7), ''))
!  if (bSumEqual, rAkcis, SAkciz)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
.endfields
 Ш├────────────────────────┴─────────┴──────────┴────────────┴───────────────┴───────────┴──────┼──────────────┼───────────────┼─────────────┴─────────┘ Ш
 Ш│  Всего к оплате                                           &#&&&&&&&&&&.&&                   │&#&&&&&&&&&.&&│&#&&&&&&&&&&.&&│                         Ш
 Ш└─────────────────────────────────────────────────────────────────────────────────────────────┴──────────────┴───────────────┘                         Ш
.{?internal; not is2004
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
       (индивидуальный предприниматель)                                        (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)

       М.П.


       Выдал                                                                    (подпись ответственного лица от продавца)

       Примечания.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}
.{?internal; is2004
.fields
   Director
   Main_Buh
.endfields

        Ш
       Руководитель организации                     @@@@@@@@@@@@@@@@@@@@@@@@@@ Главный бухгалтер                 ^
                                      (подпись)              (Ф.И.О.)                              (подпись)              (Ф.И.О.)

       Индивидуальный предприниматель
                                      (подпись)              (Ф.И.О.)          (реквизиты свидетельства о
                                                                                государственной регистрации
                                                                                индивидуального предпринимателя)
       Примечание.
       Первый экземпляр - покупателю, второй экземпляр - продавцу.
        Ш
.}

.} // Schf
.endform
!--------------------------------------------------------------------------------------------------------------------
