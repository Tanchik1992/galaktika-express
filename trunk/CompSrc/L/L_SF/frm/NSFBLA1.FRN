/*
╔═══════════════════════════════════════════════════════════════════════════╗
║                     (c) 1994,99 корпорация ГАЛАКТИКА                      ║
║ Проект        : ГАЛАКТИКА                                                 ║
║ Система       : Оперативный контур                                        ║
║ Версия        : 5.70                                                      ║
║ Назначение    : Печать налоговых счетов-фактур (бланки НСФ для Казахстана)║
║ Ответственный : Зайцев С.В.                                               ║
║ Параметры     : нет                                                       ║
╚═══════════════════════════════════════════════════════════════════════════╝
*/
! Для тех кому нужны платежные реквизиты
! Поставщик -
!  If (Direct=1,MyOrgSchet,OrgSchet)
!  If (Direct=1,MyOrgBank+ if (MyOrgBankMFO='','',' БИК:'+MyOrgBankMFO)+
!                          if (MyOrgBankSchRKC='','',' к/с:'+MyOrgBankSchRKC)
!              ,OrgBank +  if (OrgBankMFO='','',' БИК:'+OrgBankMFO)+
!                          if (OrgBankSchRKC='','',' к/с:'+OrgBankSchRKC)
!     )
!  If (Direct=1,MyOrgBankAddr,OrgBankAddr)
! Расчетный счет N @@@@@@@@@@@@@@@@@@@@@ в @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
! Город @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
!   Коды ОКОНХ и ОКПО
!  If (Direct=1,MyOrgOKONH,OrgOKONH)
!  If (Direct=1,MyOrgOKPO,OrgOKPO)
! Код по ОКОНХ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
! Код по ОКПО @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
! Получатель -
!  If (Direct<>1,MyOrgSchet,OrgSchet)
!  If (Direct<>1,MyOrgBank+ if (MyOrgBankMFO='','',' БИК:'+MyOrgBankMFO)+
!                          if (MyOrgBankSchRKC='','',' к/с:'+MyOrgBankSchRKC),
!               OrgBank +  if (OrgBankMFO='','',' БИК:'+OrgBankMFO)+
!                          if (OrgBankSchRKC='','',' к/с:'+OrgBankSchRKC)
!     )
!  If (Direct<>1,MyOrgBankAddr,OrgBankAddr)
! Расчетный счет N @@@@@@@@@@@@@@@@@@@@@ в @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
! Город @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
!  If (Direct<>1,MyOrgOKONH,OrgOKONH)
!  If (Direct<>1,MyOrgOKPO,OrgOKPO)
! Код по ОКОНХ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
! Код по ОКПО @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
! Сумма прописью -
!  '('+doubleToString(comp(0),S)+')'
! ^
!--------------------------------------------------------------------------------------------------------------------

#doc
Налоговый счет-фактура (формат A4)
#end
.linkform 'Schfrees_50' prototype is 'Schfrees'
.NameInList 'Налоговый счет-фактура (формат A4)'
.Group 'Бланки счетов-фактур (Казахстан)'
.var
  NPP: longint
  LastSpGrPrMC: longint
  ChapterTxt: string
  IS1_3: double
  IS1_5: double
  IS1_6: double
  IS2_3: double
  IS2_6: double
.endvar
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.fields
  NSF
  if (longint(dFact)<>0, DateToStr(dFact,'"DD" Mon YYYY г.'), '')

  NSopr if (longint(DSopr)<>0, DateToStr(DSopr,'"DD" Mon YYYY г.'), '')

  if (Direct=1,MyOrgINN,OrgINN)+', '+if (Direct=1,MyOrgName,OrgName)
  if (Direct<>1,MyOrgINN,OrgINN)+', '+if (Direct<>1,MyOrgName,OrgName)
  GruzTo
  Dollarah
.endfields

 И                              Налоговый счет-фактура N  Д@@@@@@@@@@@@ Д И
 И                                   от  Д@@@@@@@@@@@@@@@@@@@@@@ Д И

 И Оформлен на основании счета-фактуры N Д              Д от Д                                   Д И
 И отгрузочных документов (накладных, актов выполненных работ и т.д.) И
.if Dopol
.end
.{CheckEnter SchfKatSopr
 И   N  Д@@@@@@@@@@@@@ Д от  Д@@@@@@@@@@@@@@@@@@@@@@@ Д И
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
 И Продавец РНН N  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Покупатель РНН N  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Пункт назначения  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д И

 Ш┌───┬──────────────────────────────────────────────────────────────────────────┬───────────────────┬─────────────────────────────┬───────────────────┐ Ш
 Ш│ N │                                                                          │   Стоимость без   │             НДС             │    Всего с НДС    │ Ш
 Ш│п/п│                 Наименование товара (работ, услуг)                       │     учета НДС     ├─────────┬───────────────────┤     к оплате      │ Ш
 Ш│   │                                                                          │                   │ Ставка  │       Сумма       │                   │ Ш
 Ш├───┼──────────────────────────────────────────────────────────────────────────┼───────────────────┼─────────┼───────────────────┼───────────────────┤ Ш
 Ш│ 1 │                                   2                                      │         3         │    4    │         5         │         6         │ Ш
 Ш├───┼──────────────────────────────────────────────────────────────────────────┼───────────────────┼─────────┼───────────────────┼───────────────────┤ Ш
.begin
  NPP := 0;
  LastSpGrPrMC := -1;
  ChapterTxt := '';
  IS1_3 := 0.0;
  IS1_5 := 0.0;
  IS1_6 := 0.0;
  IS2_3 := 0.0;
  IS2_6 := 0.0;
end.
.{CheckEnter SpSchf
.begin
  NPP := NPP + 1;
  case SpGrPrMC of
    1*256+0:
      {
        ChapterTxt := 'Товары, облагаемые НДС';
        IS1_3 := IS1_3 + SpSumNoNDS;
        IS1_5 := IS1_5 + SpNDS;
        IS1_6 := IS1_6 + SpSumma;
      };
    1*256+1:
      {
        ChapterTxt := 'Товары, не облагаемые НДС';
        IS2_3 := IS2_3 + SpSumNoNDS;
        IS2_6 := IS2_6 + SpSumma;
      };
    2*256+0:
      {
        ChapterTxt := 'Работы и оказанные услуги, облагаемые НДС';
        IS1_3 := IS1_3 + SpSumNoNDS;
        IS1_5 := IS1_5 + SpNDS;
        IS1_6 := IS1_6 + SpSumma;
      };
    2*256+1:
      {
        ChapterTxt := 'Работы и оказанные услуги, не облагаемые НДС';
        IS2_3 := IS2_3 + SpSumNoNDS;
        IS2_6 := IS2_6 + SpSumma;
      };
   else ChapterTxt := '';
  end; // case
end.
.{?Internal;(LastSpGrPrMC <> SpGrPrMC and LastSpGrPrMC <> -1)
 Ш├───┼──────────────────────────────────────────────────────────────────────────┼───────────────────┼─────────┼───────────────────┼───────────────────┤ Ш
.}
.{?Internal;(LastSpGrPrMC <> SpGrPrMC)
.fields
  ChapterTxt
.endfields
 Ш│   │ Г@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Г│                   │         │                   │                   │ Ш
.}
.fields
  NPP SpName  SpSumNoNDS SpPerc SpNDS SpSumma
.endfields
 Ш│&~&│@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│&#&&&&&&&&&&&&&&.&&│&#&&&&.&&│&#&&&&&&&&&&&&&&.&&│&#&&&&&&&&&&&&&&.&&│ Ш
.begin
  LastSpGrPrMC := SpGrPrMC;
end.
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
   IS1_3 IS1_5 IS1_6
   IS2_3       IS2_6
   DateToStr(Cur_Date,'"DD" Mon YYYY г.')
.endfields
 Щ├───┼──────────────────────────────────────────────────────────────────────────┼───────────────────┼─────────┼───────────────────┼───────────────────┤ Щ
 Щ│   │ Итого по облагаемым оборотам                                             │&#&&&&&&&&&&&&&&.&&│    X    │&#&&&&&&&&&&&&&&.&&│&#&&&&&&&&&&&&&&.&&│ Щ
 Щ├───┼──────────────────────────────────────────────────────────────────────────┼───────────────────┼─────────┼───────────────────┼───────────────────┤ Щ
 Щ│   │ Итого по необлагаемым оборотам                                           │&#&&&&&&&&&&&&&&.&&│    X    │         X         │&#&&&&&&&&&&&&&&.&&│ Щ
 Щ└───┴──────────────────────────────────────────────────────────────────────────┴───────────────────┴─────────┴───────────────────┴───────────────────┘ Щ
 И    @@@@@@@@@@@@@@@@@@@@@@@@@ И
 И  ____________________________________________                        ___________________ И
 Ш                                Ф.И.О. исполнителя                                               М.П.                            подпись Ш

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------
#doc
Налоговый счет-фактура (с 14.07.2000, формат A4)
#end
.linkform 'Schfrees_51' prototype is 'Schfrees'
.NameInList 'Налоговый счет-фактура (с 14.07.2000, формат A4)'
.Group 'Бланки счетов-фактур (Казахстан)'
.create view vKazSopr
var
  nRecKatSopr: comp;
  nPunktWas: comp;
  nWayWas: comp;
from      
  KatSopr ,
  MarPunkt,
  TTNDoc  ,
  WayMove ,
  Shipment,
  SchFact,
  KatOrg 
where
((
  nRecKatSopr       == KatSopr.nRec  and
  coKatSopr         == TTNDoc.wTable and
  KatSopr.nRec      == TTNDoc.cDoc   and
  TTNDoc.cPunktR    == MarPunkt.nRec and
  TTNDoc.cShipment  == Shipment.nRec and
  Shipment.cWayMove == WayMove.nRec
))
;
.create view vKazSF
var
  nRecSchFact: comp;
  nRecSpSchf: comp;
from
  SchFact   ,
  KatOrg    ,
  KatState  ,
  KatCity   ,
  KatPayment
where
((
      nRecSpSchf       == SpSchf.nRec
  and nRecSchFact      == SchFact.nRec
  and SchFact.cGruzTo  == KatOrg.nRec
  and KatOrg.cCity     == KatCity.nRec
  and KatOrg.cState    == KatState.nRec
))
;
.var
  npp: longint
  rNDS, rSumNoNDS,
  rAkcis, rSumma: double;
  strTTN: string;
  strDov: string;
  strWay: string;
  strPay: string;
  strPunkt: string;
  dblPercAkc: double; 
.endvar
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  strTTN := '';
  strDov := '';
  strWay := ''
  strPay := ''
  strPunkt := ''
  vKazSopr.nPunktWas := 0;
  vKazSopr.nWayWas := 0;
end.
.if Dopol
.end
.{CheckEnter SchfKatSopr
.begin
  strTTN := strTTN + if (trim(strTTN) <> '', ', ', '') + 
            nSopr + ' от ' + 
            if (longint(dSopr) <> 0, DateToStr(dSopr, '"DD" Mon YYYY г.'), '')
  vKazSopr.nRecKatSopr := cSopr;
  // накладные
  if (vKazSopr.GetFirst KatSopr = 0)
  {
    strDov := strDov + if (trim(strDov) <> '', ', ', '') + 
              if (trim(vKazSopr.KatSopr.nDover) <> '',
                    vKazSopr.KatSopr.nDover + ' от ', ''
                 ) + 
              if (longint(vKazSopr.KatSopr.dDover) <> 0,
                    DateToStr(vKazSopr.KatSopr.dDover, '"DD" Mon YYYY г.'), '');
  }
  // пункты разгрузки
  if ( (vKazSopr.GetFirst MarPunkt = 0) and
       (vKazSopr.nPunktWas <> vKazSopr.MarPunkt.nRec)
     )
  {
    strPunkt := if(vKazSopr.nPunktWas = 0, vKazSopr.MarPunkt.Name, '');
    vKazSopr.nPunktWas := vKazSopr.MarPunkt.nRec;
  }

  // способы транспортировки
  if ( (vKazSopr.GetFirst WayMove = 0) and
       (vKazSopr.nWayWas <> vKazSopr.WayMove.nRec)
     )
  {
    strWay := if (vKazSopr.nWayWas = 0, vKazSopr.WayMove.Name, '');
    vKazSopr.nWayWas := vKazSopr.WayMove.nRec;
  }
  strPay := if ((Payment and 1) <> 0, 'Наличный', 'Безналичный');
end.
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.begin
  if (trim(strPunkt) = '')
  {
    vKazSF.nRecSchFact := nSchFact;
    if (vKazSF.GetFirst SchFact = 0) {}
    if (vKazSF.GetFirst KatState = 0)
      strPunkt := strPunkt + vKazSF.KatState.Name;
    if (vKazSF.GetFirst KatCity = 0)
      strPunkt := strPunkt + if (trim(strPunkt) <> '', ', ', '') +
                  vKazSF.KatCity.Name;
  }
end.
.fields
  NSF
  if (longint(dFact) <> 0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1, MyOrgName, OrgName)
  if (Direct = 1, MyOrgINN, OrgINN)+', '+
    if (Direct = 1, MyOrgAddr, OrgAddr)
  if (Direct = 1, MyOrgSchet, OrgSchet)
  if (Direct = 1, MyOrgBank + if (MyOrgBankMFO = '', '', ' БИК:' + MyOrgBankMFO) +
                              if (MyOrgBankSchRKC = '', '', ' к/с:' + MyOrgBankSchRKC)
                , OrgBank   + if (OrgBankMFO = '', '', ' БИК:' + OrgBankMFO) +
                              if (OrgBankSchRKC = '', '', ' к/с:' + OrgBankSchRKC)
     )

  DogovorDO_NoDoc
  DogovorDO_dDoc

  if (Subtip = if (Direct = 1, 16, 17), 'Авансовый ' + strPay,
       if (Subtip = 32, 'Дополнительный ' + strPay, strPay)
     )
 
  strPunkt
  strDov
  strWay
  strTTN

  GruzFrom
  GruzTo

  if (Direct <> 1, MyOrgName, OrgName)
  if (Direct <> 1, MyOrgINN, OrgINN)+', '+
    if (Direct <> 1, MyOrgAddr, OrgAddr)
  if (Direct <> 1, MyOrgSchet, OrgSchet)
  if (Direct <> 1, MyOrgBank + if (MyOrgBankMFO = '', '', ' БИК:' + MyOrgBankMFO) +
                               if (MyOrgBankSchRKC = '', '', ' к/с:' + MyOrgBankSchRKC)
                , OrgBank    + if (OrgBankMFO = '', '', ' БИК:' + OrgBankMFO) +
                               if (OrgBankSchRKC = '', '', ' к/с:' + OrgBankSchRKC)
     )

  Dollarah
.endfields

 И                 Счет-фактура N  Д@@@@@@@@@@@@@@@@@@@   Д от  Д@@@@@@@@@@@@@@@@@@@@@@   Д  И

 И Поставщик       Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И РНН и адрес поставщика  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Расчетный счет поставщика N Д@@@@@@@@@@@@@ в @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Договор(контракт) на поставку товаров(работ, услуг) N Д@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@ М
 И Условия оплаты по договору(контракту)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Пункт назначения поставляемых товаров(работ, услуг)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И                                                     Ш(государство, регион, область, город, район) Ш И
 И Поставка товаров осуществлена по доверенности N Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Способ отправления  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Товарно-транспортная накладная N Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Грузоотправитель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И                                    Ш(РНН, наименование и адрес) Ш  И
 И Грузополучатель   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И                                    Ш(РНН, наименование и адрес) Ш  И
 И Покупатель        Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И РНН и адрес покупателя  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Расчетный счет покупателя N Д@@@@@@@@@@@@@ в @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@                                                         М

 Ш┌───┬──────────────────────┬──────┬───────────┬─────────────┬──────────────────┬─────────────────────────┬──────────────────┬────────────────────────┐ Ш
 Ш│ N │ Наименование товаров │ Ед.  │Количество │             │Стоимость товаров │          НДС            │ Всего стоимость  │        Акциз           │ Ш
 Ш│п/п│    (работ, услуг)    │ изм. │ (объем)   │    Цена     │  (работ, услуг)  ├──────┬──────────────────┤   реализации     ├──────┬─────────────────┤ Ш
 Ш│   │                      │      │           │             │     без НДС      │Ставка│       Сумма      │                  │Ставка│      Сумма      │ Ш
 Ш├───┼──────────────────────┼──────┼───────────┼─────────────┼──────────────────┼──────┼──────────────────┼──────────────────┼──────┼─────────────────┤ Ш
 Ш│ 1 │          2           │   3  │     4     │      5      │         6        │   7  │         8        │       9          │  10  │        11       │ Ш
 Ш├───┼──────────────────────┼──────┼───────────┼─────────────┼──────────────────┼──────┼──────────────────┼──────────────────┼──────┼─────────────────┤ Ш
.begin
  npp := 0;
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.begin
  dblPercAkc := 0;
  vKazSF.nRecSpSchf := cSpSchf;
  if (vKazSF.GetFirst SpSchf = 0)
    dblPercAkc := vKazSF.SpSchf.fs[9];
  npp := npp + 1;
end.
.fields
  npp SpName
  if(SpPrMC = 3, '', SpOtpEd) if(SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr)) if(SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
  SpSumNoNDS //- SpAkciz
  SpPerc SpNDS
  SpSumma
  dblPercAkc SpAkciz
.endfields
 Ш│&~&│@@@@@@@@@@@@@@@@@@@@@@│@~@@@@│@#@@@@@@@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&&&&.&&│&#&.&&│&#&&&&&&&&&&&&&.&&│&#&&&&&&&&&&&&&.&&│&#&.&&│&#&&&&&&&&&&&&.&&│ Ш
.begin                                                                                                                                                 
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
  if (bSumEqual, rSumNoNds, S1 + S4 + S7)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
  if (bSumEqual, rAkcis, SAkciz)
  if (Direct = 1, Director, '')
  if (Direct = 1, Main_Buh, '')
.endfields
 Щ├───┴──────────────────────┴──────┴───────────┴─────────────┼──────────────────┼──────┼──────────────────┼──────────────────┼──────┼─────────────────┤ Щ
 Щ│ Всего по счету:                                           │&#&&&&&&&&&&&&&.&&│   X  │&#&&&&&&&&&&&&&.&&│&#&&&&&&&&&&&&&.&&│   X  │&#&&&&&&&&&&&&.&&│ Щ
 Щ└───────────────────────────────────────────────────────────┴──────────────────┴──────┴──────────────────┴──────────────────┴──────┴─────────────────┘ Щ
 Ш  Руководитель организации                                           Выдал (ответственное лицо поставщика)    Ш
 Ш  ^ Ш
 Ш  ____________________________________________                        ________________________________ Ш
 Ш               (Ф.И.О., подпись)                                                 (должность)  Ш
 И                                    М.П. И
 Ш                                                                      ________________________________ Ш
 Ш                                                                               (Ф.И.О., подпись)       Ш
 Ш  Главный бухгалтер организации Ш
 Ш  ^ Ш
 Ш  ____________________________________________  Ш
 Ш               (Ф.И.О., подпись)  Ш
 Ш
  Примечание. Без печати недействительно.
  Оригинал (первый экземпляр) - покупателю.
  Копия (второй экземпляр) - поставщику.
 Ш

.} // Schf
.endform

!--------------------------------------------------------------------------------------------------------------------
#doc
Налоговый счет-фактура (со свидетельством)
#end
.linkform 'Schfrees_61' prototype is 'Schfrees'
.NameInList 'Налоговый счет-фактура (со свидетельством)'
.Group 'Бланки счетов-фактур (Казахстан)'
.create view vKazSopr
var
  nRecKatSopr: comp;
  nPunktWas: comp;
  nWayWas: comp;
from      
  KatSopr ,
  MarPunkt,
  TTNDoc  ,
  WayMove ,
  Shipment,
  SchFact,
  KatOrg
where
((
  nRecKatSopr       == KatSopr.nRec  and
  coKatSopr         == TTNDoc.wTable and
  KatSopr.nRec      == TTNDoc.cDoc   and
  TTNDoc.cPunktR    == MarPunkt.nRec and
  TTNDoc.cShipment  == Shipment.nRec and
  Shipment.cWayMove == WayMove.nRec
))
;
.create view vKazSF
var
  nRecSchFact: comp;
  nRecSpSchf: comp;
from
  SchFact   ,
  KatOrg    ,
  KatState  ,
  KatCity   ,
  KatPayment
where
((
      nRecSpSchf       == SpSchf.nRec
  and nRecSchFact      == SchFact.nRec
  and SchFact.cGruzTo  == KatOrg.nRec
  and KatOrg.cCity     == KatCity.nRec
  and KatOrg.cState    == KatState.nRec
))
;
.var
  npp: longint
  rNDS, rSumNoNDS,
  rAkcis, rSumma: double;
  strTTN: string;
  strDov: string;
  strWay: string;
  strPay: string;
  strPunkt: string;
  dblPercAkc: double;
.endvar
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  strTTN := '';
  strDov := '';
  strWay := ''
  strPay := ''
  strPunkt := ''
  vKazSopr.nPunktWas := 0;
  vKazSopr.nWayWas := 0;
end.
.if Dopol
.end
.{CheckEnter SchfKatSopr
.begin
  strTTN := strTTN + if (trim(strTTN) <> '', ', ', '') + 
            nSopr + ' от ' + 
            if (longint(dSopr) <> 0, DateToStr(dSopr, '"DD" Mon YYYY г.'), '')
  vKazSopr.nRecKatSopr := cSopr;
  // накладные
  if (vKazSopr.GetFirst KatSopr = 0)
  {
    strDov := strDov + if (trim(strDov) <> '', ', ', '') + 
              if (trim(vKazSopr.KatSopr.nDover) <> '',
                    vKazSopr.KatSopr.nDover + ' от ', ''
                 ) + 
              if (longint(vKazSopr.KatSopr.dDover) <> 0,
                    DateToStr(vKazSopr.KatSopr.dDover, '"DD" Mon YYYY г.'), '');
  }
  // пункты разгрузки
  if ( (vKazSopr.GetFirst MarPunkt = 0) and
       (vKazSopr.nPunktWas <> vKazSopr.MarPunkt.nRec)
     )
  {
    strPunkt := if(vKazSopr.nPunktWas = 0, vKazSopr.MarPunkt.Name, '');
    vKazSopr.nPunktWas := vKazSopr.MarPunkt.nRec;
  }

  // способы транспортировки
  if ( (vKazSopr.GetFirst WayMove = 0) and
       (vKazSopr.nWayWas <> vKazSopr.WayMove.nRec)
     )
  {
    strWay := if (vKazSopr.nWayWas = 0, vKazSopr.WayMove.Name, '');
    vKazSopr.nWayWas := vKazSopr.WayMove.nRec;
  }
  strPay := if ((Payment and 1) <> 0, 'Наличный', 'Безналичный');
end.
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr
.begin
  vKazSF.nRecSchFact := nSchFact;
  if (vKazSF.GetFirst SchFact = 0) {}
  if (trim(strPunkt) = '')
  {
    if (vKazSF.GetFirst KatState = 0)
      strPunkt := strPunkt + vKazSF.KatState.Name;
    if (vKazSF.GetFirst KatCity = 0)
      strPunkt := strPunkt + if (trim(strPunkt) <> '', ', ', '') +
                  vKazSF.KatCity.Name;
  }
end.
.fields
  NSF
  if (longint(dFact) <> 0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')

  if (Direct = 1, MyOrgName, OrgName)
  if (Direct = 1, MyOrgINN, OrgINN)+', '+
    if (Direct = 1, MyOrgAddr, OrgAddr)
  sertNumber + ' серия ' + sertSerial + ' от ' + string(sertDate)
  if (Direct = 1, MyOrgSchet, OrgSchet)
  if (Direct = 1, MyOrgBank + if (MyOrgBankMFO = '', '', ' БИК:' + MyOrgBankMFO) +
                              if (MyOrgBankSchRKC = '', '', ' к/с:' + MyOrgBankSchRKC)
                , OrgBank   + if (OrgBankMFO = '', '', ' БИК:' + OrgBankMFO) +
                              if (OrgBankSchRKC = '', '', ' к/с:' + OrgBankSchRKC)
     )

  DogovorDO_NoDoc
  DogovorDO_dDoc

  if (Subtip = if (Direct = 1, 16, 17), 'Авансовый ' + strPay,
       if (Subtip = 32, 'Дополнительный ' + strPay, strPay)
     )
 
  strPunkt
  strDov
  strWay
  strTTN

  GruzFrom
  GruzTo

  if (Direct <> 1, MyOrgName, OrgName)
  if (Direct <> 1, MyOrgINN, OrgINN)+', '+
    if (Direct <> 1, MyOrgAddr, OrgAddr)
  if (Direct <> 1, MyOrgSchet, OrgSchet)
  if (Direct <> 1, MyOrgBank + if (MyOrgBankMFO = '', '', ' БИК:' + MyOrgBankMFO) +
                               if (MyOrgBankSchRKC = '', '', ' к/с:' + MyOrgBankSchRKC)
                , OrgBank    + if (OrgBankMFO = '', '', ' БИК:' + OrgBankMFO) +
                               if (OrgBankSchRKC = '', '', ' к/с:' + OrgBankSchRKC)
     )

  Dollarah
.endfields

 И                 Счет-фактура N  Д@@@@@@@@@@@@@@@@@@@   Д от  Д@@@@@@@@@@@@@@@@@@@@@@   Д  И

 И Поставщик       Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И РНН и адрес поставщика  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Свидетельство о постановке на учет по НДС N Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Расчетный счет поставщика N Д@@@@@@@@@@@@@ в @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Договор(контракт) на поставку товаров(работ, услуг) N Д@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@ М
 И Условия оплаты по договору(контракту)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Пункт назначения поставляемых товаров(работ, услуг)  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И                                                     Ш(государство, регион, область, город, район) Ш И
 И Поставка товаров осуществлена по доверенности N Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Способ отправления  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Товарно-транспортная накладная N Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Грузоотправитель  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И                                    Ш(РНН, наименование и адрес) Ш  И
 И Грузополучатель   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И                                    Ш(РНН, наименование и адрес) Ш  И
 И Покупатель        Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И РНН и адрес покупателя  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Расчетный счет покупателя N Д@@@@@@@@@@@@@ в @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ М
 И Составлен в  Д@@@@@@@@@@@@@@@@@@@                                                         М

 Ш┌───┬──────────────────────┬──────┬───────────┬─────────────┬──────────────────┬─────────────────────────┬──────────────────┬────────────────────────┐ Ш
 Ш│ N │ Наименование товаров │ Ед.  │Количество │             │Стоимость товаров │          НДС            │ Всего стоимость  │        Акциз           │ Ш
 Ш│п/п│    (работ, услуг)    │ изм. │ (объем)   │    Цена     │  (работ, услуг)  ├──────┬──────────────────┤   реализации     ├──────┬─────────────────┤ Ш
 Ш│   │                      │      │           │             │     без НДС      │Ставка│       Сумма      │                  │Ставка│      Сумма      │ Ш
 Ш├───┼──────────────────────┼──────┼───────────┼─────────────┼──────────────────┼──────┼──────────────────┼──────────────────┼──────┼─────────────────┤ Ш
 Ш│ 1 │          2           │   3  │     4     │      5      │         6        │   7  │         8        │       9          │  10  │        11       │ Ш
 Ш├───┼──────────────────────┼──────┼───────────┼─────────────┼──────────────────┼──────┼──────────────────┼──────────────────┼──────┼─────────────────┤ Ш
.begin
  npp := 0;
  rNDS := 0;
  rSumNoNDS := 0;
  rAkcis := 0;
  rSumma := 0;
end.
.{CheckEnter SpSchf
.begin
  dblPercAkc := 0;
  vKazSF.nRecSpSchf := cSpSchf;
  if (vKazSF.GetFirst SpSchf = 0)
    dblPercAkc := vKazSF.SpSchf.fs[9];
  npp := npp + 1;
end.
.fields
  npp SpName
  if(SpPrMC = 3, '', SpOtpEd) if(SpPrMC = 3, '0.0', string(SpKol, 0, Kol_Pr)) if(SpPrMC = 3, 0.0, SpSumNoNDS / SpKol)
  SpSumNoNDS //- SpAkciz
  SpPerc SpNDS
  SpSumma
  dblPercAkc SpAkciz
.endfields
 Ш│&~&│@@@@@@@@@@@@@@@@@@@@@@│@~@@@@│@#@@@@@@@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&&&&.&&│&#&.&&│&#&&&&&&&&&&&&&.&&│&#&&&&&&&&&&&&&.&&│&#&.&&│&#&&&&&&&&&&&&.&&│ Ш
.begin                                                                                                                                                 
  rNDS := rNDS + round(SpNDS, 2);
  rSumNoNDS := rSumNoNDS + round(SpSumNoNDS, 2);
  rAkcis := rAkcis + round(SpAkciz, 2);
  rSumma := rSumma + round(SpSumma, 2);
end.
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
  if (bSumEqual, rSumNoNds, S1 + S4 + S7)
  if (bSumEqual, rNDS, S2 + S5)
  if (bSumEqual, rSumma, S)
  if (bSumEqual, rAkcis, SAkciz)
  if (Direct = 1, Director, '')
  if (Direct = 1, Main_Buh, '')
.endfields
 Щ├───┴──────────────────────┴──────┴───────────┴─────────────┼──────────────────┼──────┼──────────────────┼──────────────────┼──────┼─────────────────┤ Щ
 Щ│ Всего по счету:                                           │&#&&&&&&&&&&&&&.&&│   X  │&#&&&&&&&&&&&&&.&&│&#&&&&&&&&&&&&&.&&│   X  │&#&&&&&&&&&&&&.&&│ Щ
 Щ└───────────────────────────────────────────────────────────┴──────────────────┴──────┴──────────────────┴──────────────────┴──────┴─────────────────┘ Щ
 Ш  Руководитель организации                                           Выдал (ответственное лицо поставщика)    Ш
 Ш  ^ Ш
 Ш  ____________________________________________                        ________________________________ Ш
 Ш               (Ф.И.О., подпись)                                                 (должность)  Ш
 И                                    М.П. И
 Ш                                                                      ________________________________ Ш
 Ш                                                                               (Ф.И.О., подпись)       Ш
 Ш  Главный бухгалтер организации Ш
 Ш  ^ Ш
 Ш  ____________________________________________  Ш
 Ш               (Ф.И.О., подпись)  Ш
 Ш
  Примечание. Без печати недействительно.
  Оригинал (первый экземпляр) - покупателю.
  Копия (второй экземпляр) - поставщику.
 Ш

.} // Schf
.endform