/*
 ╔═══════════════════════════════════════════════════════════════════════════╗
 ║                     (c) 1987,98 корпорация ГАЛАКТИКА                      ║
 ║ Проект        : ГАЛАКТИКА                                                 ║
 ║ Система       : Оперативный контур                                        ║
 ║ Версия        : 5.70                                                      ║
 ║ Назначение    : Сервисные функции для наряд-заказов                       ║
 ║ Ответственный : Сидоров Владимир Гегннадьевич (VOLOD)                     ║
 ║ Параметры     : нет                                                       ║
 ╚═══════════════════════════════════════════════════════════════════════════╝
*/


function CheckNZakaz2Instead:word;
var ErrNum : word;
    ret : word;
{
  ErrNum := 0;
!  PushPos(#NZakazDown);
  ret := GetFirst NZakazDown where ((NZakaz.cInstead == NZakazDown.NRec));
!  PopPos(#NZakazDown);
  if (ret = tsOk)
    {
      if (NZakazDown.Status <> 3) //-- заменяемый наряд-заказ должен быть отменен
        { ErrNum := 1; CheckNZakaz2Instead := ErrNum; exit;}
      if (NZakaz.cOwner <> NZakazDown.cOwner)
        { ErrNum := 2; CheckNZakaz2Instead := ErrNum; exit;}
    }
  CheckNZakaz2Instead := ErrNum;
}

function CheckNZTypeDoc(oldType:word):boolean;
var curType : word;
    curNRec : Comp;
    ret     : word;
{
  CheckNZTypeDoc := false;
  curType := NZakaz.TypeDoc;
//-- проверка типа документа по тому есть ли владелец у НЗ
  if (NZakaz.cOwner = 0)
    {
      if (curType = 2)
        exit;
    }
  else  //-- проверка типа документа по типу владельца  НЗ
    case (NZakazUp.TypeDoc) of
      0: exit;
      1: if ((curType <> 1) and (curType <> 2)) exit;
      2: exit;
    end;
//--------------------------------------------------------

  curNRec := NZakaz.NRec;
  PushPos(#NZakaz);
  ret := GetFirst NZakaz where((curNRec==NZakaz.cOwner));
  PopPos(#NZakaz);
  if (ret= tsOk )
    {
      if (((oldType=2) and (curType=1)) or (oldType = curType)) {}
      else  exit;
    }
  CheckNZTypeDoc := true;
}

//-- сравнить поля двух наряд-заказов
function CompFldsNZakaz(secNRec:comp):word;
var ret : word;
{
  CompFldsNZakaz := 0;
!  PushPos(#NZakazUp);
  ret := GetFirst NZakazUp where ((secNRec == NZakazUp.NRec));
  if (ret = tsOk)
    {
      if (NZakaz.cDogovor <> NZakazUp.cDogovor) {CompFldsNZakaz:=1;exit;}
      if (NZakaz.cAppDogovor <> NZakazUp.cAppDogovor) {CompFldsNZakaz:=2;exit;}
      if (NZakaz.cCalPlan <> NZakazUp.cCalPlan) {CompFldsNZakaz:=3;exit;}
      if (NZakaz.cOrg <> NZakazUp.cOrg) {CompFldsNZakaz:=4;exit;}
      if (NZakaz.cContrib <> NZakazUp.cContrib) {CompFldsNZakaz:=5;exit;}
      if (NZakaz.cGrOtp <> NZakazUp.cGrOtp) {CompFldsNZakaz:=6;exit;}
      if (NZakaz.cPunktR <> NZakazUp.cPunktR) {CompFldsNZakaz:=7;exit;}
      if (NZakaz.cShipment <> NZakazUp.cShipment) {CompFldsNZakaz:=8;exit;}
      if (NZakaz.cTipOtg <> NZakazUp.cTipOtg) {CompFldsNZakaz:=9;exit;};
      if (NZakaz.cWaymove <> NZakazUp.cWaymove) {CompFldsNZakaz:=10;exit;}
      if (NZakaz.cPodrForm <> NZakazUp.cPodrForm) {CompFldsNZakaz:=11;exit;}
      if (NZakaz.cGrPol <> NZakazUp.cGrPol) {CompFldsNZakaz:=12;exit;}
      if (NZakaz.cPunktR <> NZakazUp.cPunktR) {CompFldsNZakaz:=13;exit;}
    }
!  PopPos(#NZakazUp);
}

